<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>6E Synthetic Control | ProTools ER1</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Crimson+Pro:ital,wght@0,400;0,600;0,700;1,400&family=Fira+Code:wght@400;500&family=Source+Sans+Pro:ital,wght@0,400;0,600;0,700;1,400&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="../css/style.css">
  <style>
    .protected-content { -webkit-user-select: none; -moz-user-select: none; -ms-user-select: none; user-select: none; }
    .protected-content pre, .protected-content code, .protected-content .code-block, .protected-content .code-tabs { -webkit-user-select: text; -moz-user-select: text; -ms-user-select: text; user-select: text; }
    .code-tooltip { position: relative; cursor: help; border-bottom: 1px dotted #888; text-decoration: none; }
    .tooltip-popup { position: fixed; background: #1f2937; color: white; padding: 0.5rem 0.75rem; border-radius: 6px; font-size: 0.75rem; white-space: normal; max-width: 300px; opacity: 0; pointer-events: none; transition: opacity 0.15s ease-in-out; z-index: 10000; }
    .tooltip-popup.visible { opacity: 1; }
  </style>
</head>
<body>
    <div id="password-overlay" class="password-overlay">
    <div class="password-modal">
      <h2>ProTools ER1</h2>
      <p>Programming Tools for Empirical Research</p>

      <div class="course-description">
        <h3>Course Modules</h3>
        <ul class="module-list">
          <li><strong>Module 0:</strong> Languages & Platforms ‚Äî Python, Stata, R setup; IDEs (RStudio, VS Code, Jupyter)</li>
          <li><strong>Module 1:</strong> Getting Started ‚Äî Installation, basic syntax, packages</li>
          <li><strong>Module 2:</strong> Data Harnessing ‚Äî File import, APIs, web scraping</li>
          <li><strong>Module 3:</strong> Data Exploration ‚Äî Inspection, summary statistics, visualization</li>
          <li><strong>Module 4:</strong> Data Cleaning ‚Äî Data quality, transformation, validation</li>
          <li><strong>Module 5:</strong> Data Analysis ‚Äî Statistical analysis, simulation, experimental design</li>
          <li><strong>Module 6:</strong> Causal Inference ‚Äî Matching, DiD, RDD, IV, Synthetic Control</li>
          <li><strong>Module 7:</strong> Estimation Methods ‚Äî Standard errors, panel data, MLE/GMM</li>
          <li><strong>Module 8:</strong> Replicability ‚Äî Project organization, documentation, replication packages</li>
          <li><strong>Module 9:</strong> Git & GitHub ‚Äî Version control, collaboration, branching</li>
          <li><strong>Module 10:</strong> History of NLP ‚Äî From ELIZA to Transformers</li>
          <li><strong>Module 11:</strong> Machine Learning ‚Äî Prediction, regularization, neural networks</li>
          <li><strong>Module 12:</strong> Large Language Models ‚Äî How LLMs work, prompting, APIs</li>
        </ul>
      </div>

      <div class="access-note">
        This course is currently open to <strong>students at Sciences Po</strong>. If you are not a Sciences Po student but would like access, please <a href="mailto:giulia.caprini@sciencespo.fr">email me</a> to request an invite token.
      </div>

      <div class="password-form">
        <input type="password" id="password-input" placeholder="Enter password" autocomplete="off">
        <button id="password-submit">Access Course</button>
        <p id="password-error" style="color: #e53e3e; font-size: 0.85rem; margin-top: 1rem; display: none;">Incorrect password. Please try again.</p>
      </div>
    </div>
  </div>

  <div class="page-wrapper protected-content">
    <aside class="sidebar">
      <a href="../index.html" class="sidebar-logo">ProTools ER1</a>
      <span class="sidebar-subtitle">Programming Tools for Empirical Research</span>
      <nav>
        <ul>
          <li><a href="../index.html"><span class="welcome-icon">üè†</span> Welcome</a></li>
          <li class="has-subnav">
            <a href="00-languages-platforms.html"><span class="module-number">0</span> Languages & Platforms</a>
            <ul class="sub-nav">
              <li><a href="00a-rstudio-guide.html">RStudio Guide</a></li>
              <li><a href="00b-stata-guide.html">Stata Guide</a></li>
              <li><a href="00c-vscode-guide.html">VS Code Guide</a></li>
              <li><a href="00d-notebooks-guide.html">Notebooks Guide</a></li>
            </ul>
          </li>
          <li><a href="01-getting-started.html"><span class="module-number">1</span> Getting Started</a></li>
          <li class="has-subnav">
            <a href="02-data-harnessing.html"><span class="module-number">2</span> Data Harnessing</a>
            <ul class="sub-nav">
              <li><a href="02a-file-import.html">File Import</a></li>
              <li><a href="02b-apis.html">APIs</a></li>
              <li><a href="02c-web-scraping.html">Web Scraping</a></li>
            </ul>
          </li>
          <li><a href="03-data-exploration.html"><span class="module-number">3</span> Data Exploration</a></li>
          <li><a href="04-data-cleaning.html"><span class="module-number">4</span> Data Cleaning</a></li>
          <li class="has-subnav">
            <a href="05-data-analysis.html"><span class="module-number">5</span> Data Analysis</a>
            <ul class="sub-nav">
              <li><a href="05a-data-simulation.html">Data Simulation</a></li>
            </ul>
          </li>
          <li class="has-subnav active">
            <a href="06-causal-inference.html"><span class="module-number">6</span> Causal Inference</a>
            <ul class="sub-nav">
              <li><a href="06a-matching.html">Matching</a></li>
              <li><a href="06b-did.html">Difference-in-Differences</a></li>
              <li><a href="06c-rdd.html">Regression Discontinuity</a></li>
              <li><a href="06d-iv.html">Instrumental Variables</a></li>
              <li class="active"><a href="06e-synthetic-control.html">Synthetic Control</a></li>
              <li><a href="05b-experiments.html">Experiments</a></li>
            </ul>
          </li>
          <li><a href="07-estimation.html"><span class="module-number">7</span> Estimation Methods</a></li>
          <li><a href="08-replicability.html"><span class="module-number">8</span> Replicability</a></li>
          <li><a href="09-github.html"><span class="module-number">9</span> Git & GitHub</a></li>
          <li><a href="10-nlp-history.html"><span class="module-number">10</span> History of NLP</a></li>
          <li><a href="11-machine-learning.html"><span class="module-number">11</span> Machine Learning</a></li>
          <li><a href="12-llms.html"><span class="module-number">12</span> Large Language Models</a></li>
          <li><a href="../resources.html">Resources</a></li>
          <li><a href="contact.html">Contact & Feedback</a></li>
        </ul>
      </nav>
    </aside>

    <main class="main-content">
      <div class="content">
        <nav class="breadcrumb" style="margin-bottom: 1rem; font-size: 0.9rem; color: #666;">
          <a href="06-causal-inference.html">6 Causal Inference</a> &raquo; Synthetic Control
        </nav>

        <div class="module-header">
          <h1>6E &nbsp;Synthetic Control</h1>
          <div class="module-meta">
            <span>~2 hours</span>
            <span>SCM, Placebo Tests, Extensions</span>
          </div>
        </div>

        <div class="toc">
          <h3>Table of Contents</h3>
          <ul>
            <li><a href="#basic">Basic Synthetic Control</a></li>
            <li><a href="#inference">Inference: Placebo Tests</a></li>
            <li><a href="#critiques">Critiques and Limitations</a></li>
            <li><a href="#extensions">Modern Extensions</a></li>
          </ul>
        </div>

        <h2 id="basic">Basic Synthetic Control</h2>

        <p>
          Synthetic control constructs a weighted combination of control units that matches the treated unit's pre-treatment characteristics. The post-treatment difference between the treated unit and synthetic control is the estimated treatment effect.
        </p>

        <div class="code-tabs" data-runnable="synth-1">
          <div class="tab-buttons">
            <button class="tab-button active" data-lang="python">Python</button>
            <button class="tab-button" data-lang="stata">Stata</button>
            <button class="tab-button" data-lang="r">R</button>
          </div>
          <div class="tab-content active" data-lang="python">
<pre><code><span class="code-comment"># Python: Synthetic Control with SyntheticControlMethods</span>
<span class="code-comment"># pip install SyntheticControlMethods</span>
<span class="code-keyword">from</span> SyntheticControlMethods <span class="code-keyword">import</span> Synth
<span class="code-keyword">import</span> pandas <span class="code-keyword">as</span> pd

<span class="code-comment"># Data structure: unit, time, outcome, covariates</span>
<span class="code-comment"># treated_unit: the single treated unit</span>
<span class="code-comment"># treatment_time: when treatment occurs</span>

<span class="code-comment"># Initialize and fit</span>
<span class="code-tooltip" data-tip="Synth finds weights that minimize pre-treatment discrepancy">sc = Synth(df,
           outcome_var=<span class="code-string">"gdp"</span>,
           id_var=<span class="code-string">"country"</span>,
           time_var=<span class="code-string">"year"</span>,
           treatment_period=1990,
           treated_unit=<span class="code-string">"West Germany"</span>)</span>

<span class="code-comment"># Fit the synthetic control</span>
sc.fit()

<span class="code-comment"># Get results</span>
print(sc.summary())

<span class="code-comment"># Plot</span>
sc.plot([<span class="code-string">"original"</span>, <span class="code-string">"pointwise"</span>])

<span class="code-comment"># Get weights</span>
print(<span class="code-string">"Donor weights:"</span>)
print(sc.W)</code></pre>
            <button class="run-btn" data-lang="python">Run Code</button>
          </div>
          <div class="tab-content" data-lang="stata">
<pre><code><span class="code-comment">* Stata: Synthetic Control with synth</span>
<span class="code-comment">* ssc install synth</span>

<span class="code-comment">* Set panel structure</span>
tsset country_id year

<span class="code-comment">* Basic synthetic control</span>
<span class="code-tooltip" data-tip="synth matches on outcome lags and covariates to find optimal weights">synth gdp gdp(1985) gdp(1986) gdp(1987) gdp(1988) gdp(1989) ///
    population trade_openness, ///
    trunit(7) trperiod(1990) ///
    figure</span>

<span class="code-comment">* With more options</span>
synth gdp gdp(1985) gdp(1986) gdp(1987) gdp(1988) gdp(1989) ///
    population trade_openness inflation, ///
    trunit(7) trperiod(1990) ///
    xperiod(1985(1)1989) ///
    mspeperiod(1985(1)1989) ///
    resultsperiod(1985(1)2000) ///
    keep(synth_results) replace

<span class="code-comment">* Get weights and gaps</span>
matrix list e(W_weights)  <span class="code-comment">// donor weights</span>
matrix list e(V_matrix)   <span class="code-comment">// predictor weights</span></code></pre>
            <button class="run-btn" data-lang="stata">Run Code</button>
          </div>
          <div class="tab-content" data-lang="r">
<pre><code><span class="code-comment"># R: Synthetic Control with Synth package</span>
<span class="code-keyword">library</span>(Synth)

<span class="code-comment"># Prepare data for Synth</span>
<span class="code-tooltip" data-tip="dataprep() formats data for the Synth algorithm">dataprep.out <- dataprep(
  foo = df,
  predictors = c("gdp", "population", "trade_openness"),
  predictors.op = "mean",
  time.predictors.prior = 1985:1989,
  dependent = "gdp",
  unit.variable = "country_id",
  time.variable = "year",
  treatment.identifier = 7,  <span class="code-comment"># treated unit</span>
  controls.identifier = c(1:6, 8:20),  <span class="code-comment"># donor pool</span>
  time.optimize.ssr = 1985:1989,
  time.plot = 1985:2000
)</span>

<span class="code-comment"># Run synthetic control</span>
<span class="code-tooltip" data-tip="synth() finds optimal weights to minimize pre-treatment MSPE">synth.out <- synth(dataprep.out)</span>

<span class="code-comment"># Results</span>
synth.tables <- synth.tab(dataprep.res = dataprep.out,
                          synth.res = synth.out)
print(synth.tables$tab.w)  <span class="code-comment"># weights</span>

<span class="code-comment"># Plot</span>
path.plot(synth.res = synth.out,
          dataprep.res = dataprep.out,
          Ylab = "GDP",
          Xlab = "Year",
          tr.intake = 1990)</code></pre>
            <button class="run-btn" data-lang="r">Run Code</button>
          </div>
        </div>

        <div class="output-simulation" data-output="synth-1" data-lang="python">
          <div class="output-header">
            <span>Python Output</span>
            <button class="close-output">&times;</button>
          </div>
          <div class="output-body"><pre>Synthetic Control Method Results
=================================

Treated Unit: West Germany
Treatment Period: 1990
Pre-treatment periods: 1985-1989
Post-treatment periods: 1990-2000

Donor Weights:
--------------
Austria          0.423
Netherlands      0.312
Switzerland      0.198
Belgium          0.067
France           0.000
Italy            0.000
...
(remaining countries have weight = 0)

Pre-treatment Fit (RMSPE): 234.56
Post-treatment RMSPE: 1,456.78

Predictor Balance:
                    Treated    Synthetic
GDP (1985)          21,456      21,389
GDP (1986)          22,134      22,067
GDP (1987)          23,012      22,945
GDP (1988)          24,567      24,512
GDP (1989)          25,890      25,823
Population (mil)     61.2        58.9
Trade Openness       0.456       0.448

Average Treatment Effect (post-1990): -1,234.5</pre></div>
        </div>

        <div class="output-simulation" data-output="synth-1" data-lang="stata">
          <div class="output-header">
            <span>Stata Output</span>
            <button class="close-output">&times;</button>
          </div>
          <div class="output-body"><pre>Synthetic control method

Treated unit: 7 (West Germany)
Control units: 1-6, 8-20
Treatment period: 1990

Optimization method: Nested
MSPE minimization period: 1985-1989

Unit weights (W):
--------------------------------------------------------------------------------
         unit |     weight
--------------+----------------------------------------------------------------
      Austria |      0.423
  Netherlands |      0.312
  Switzerland |      0.198
      Belgium |      0.067
       France |      0.000
        Italy |      0.000
--------------------------------------------------------------------------------

Predictor weights (V):
--------------------------------------------------------------------------------
    predictor |     weight
--------------+----------------------------------------------------------------
    gdp(1985) |      0.156
    gdp(1986) |      0.178
    gdp(1987) |      0.189
    gdp(1988) |      0.201
    gdp(1989) |      0.187
   population |      0.056
trade_openness|      0.033
--------------------------------------------------------------------------------

Pre-treatment RMSPE: 234.56
[Graph saved: synth_germany.gph]</pre></div>
        </div>

        <div class="output-simulation" data-output="synth-1" data-lang="r">
          <div class="output-header">
            <span>R Output</span>
            <button class="close-output">&times;</button>
          </div>
          <div class="output-body"><pre>Synthetic Control Method Results

Treated Unit: West Germany (ID = 7)
Treatment Period: 1990

****************
 UNIT WEIGHTS
****************
        unit.names w.weights
1          Austria     0.423
2      Netherlands     0.312
3      Switzerland     0.198
4          Belgium     0.067
5           France     0.000
6            Italy     0.000
...

****************
 PREDICTOR BALANCE
****************
                 Treated Synthetic Sample Mean
gdp(1985)          21456     21389       19234
gdp(1986)          22134     22067       19876
gdp(1987)          23012     22945       20456
gdp(1988)          24567     24512       21234
gdp(1989)          25890     25823       22012
population          61.2      58.9        45.6
trade_openness     0.456     0.448       0.412

MSPE (pre-treatment): 55034.67
Root MSPE: 234.56

[Path plot displayed showing treated vs synthetic control trajectories]</pre></div>
        </div>

        <h2 id="inference">Inference: Placebo Tests</h2>

        <p>
          Standard errors don't apply to synthetic control. Instead, use placebo tests: apply the method to each control unit as if it were treated and compare the treated unit's effect to the placebo distribution.
        </p>

        <div class="code-tabs" data-runnable="synth-2">
          <div class="tab-buttons">
            <button class="tab-button active" data-lang="python">Python</button>
            <button class="tab-button" data-lang="stata">Stata</button>
            <button class="tab-button" data-lang="r">R</button>
          </div>
          <div class="tab-content active" data-lang="python">
<pre><code><span class="code-comment"># Python: Placebo Tests</span>
<span class="code-keyword">from</span> SyntheticControlMethods <span class="code-keyword">import</span> Synth
<span class="code-keyword">import</span> numpy <span class="code-keyword">as</span> np
<span class="code-keyword">import</span> matplotlib.pyplot <span class="code-keyword">as</span> plt

<span class="code-comment"># Run placebo tests (in-space placebos)</span>
<span class="code-tooltip" data-tip="Treat each control unit as if it were treated and estimate the 'effect'">all_units = df[<span class="code-string">'country'</span>].unique()
control_units = [u <span class="code-keyword">for</span> u <span class="code-keyword">in</span> all_units <span class="code-keyword">if</span> u != <span class="code-string">'West Germany'</span>]

placebo_effects = {}
<span class="code-keyword">for</span> unit <span class="code-keyword">in</span> control_units:
    sc = Synth(df, outcome_var=<span class="code-string">"gdp"</span>, id_var=<span class="code-string">"country"</span>,
               time_var=<span class="code-string">"year"</span>, treatment_period=1990,
               treated_unit=unit)
    sc.fit()
    placebo_effects[unit] = sc.gaps  <span class="code-comment"># gap = treated - synthetic</span></span>

<span class="code-comment"># Plot all gaps</span>
fig, ax = plt.subplots(figsize=(10, 6))
<span class="code-keyword">for</span> unit, gaps <span class="code-keyword">in</span> placebo_effects.items():
    ax.plot(gaps.index, gaps.values, color=<span class="code-string">'gray'</span>, alpha=0.3)
ax.plot(treated_gaps.index, treated_gaps.values, color=<span class="code-string">'black'</span>, linewidth=2)
ax.axvline(x=1990, linestyle=<span class="code-string">'--'</span>, color=<span class="code-string">'red'</span>)
ax.axhline(y=0, linestyle=<span class="code-string">'-'</span>, color=<span class="code-string">'gray'</span>)
plt.show()

<span class="code-comment"># Calculate p-value</span>
<span class="code-tooltip" data-tip="P-value = fraction of placebos with effects as large as the treated unit">post_treatment_mspe = np.mean(treated_gaps[1990:]**2)
placebo_mspe = [np.mean(gaps[1990:]**2) <span class="code-keyword">for</span> gaps <span class="code-keyword">in</span> placebo_effects.values()]
pvalue = np.mean(placebo_mspe >= post_treatment_mspe)
print(f<span class="code-string">"p-value: {pvalue:.3f}"</span>)</span></code></pre>
            <button class="run-btn" data-lang="python">Run Code</button>
          </div>
          <div class="tab-content" data-lang="stata">
<pre><code><span class="code-comment">* Stata: Placebo Tests with synth_runner</span>
<span class="code-comment">* ssc install synth_runner</span>

<span class="code-comment">* Run placebo tests for all control units</span>
<span class="code-tooltip" data-tip="synth_runner automates placebo tests and inference">synth_runner gdp gdp(1985) gdp(1986) gdp(1987) gdp(1988) gdp(1989) ///
    population trade_openness, ///
    trunit(7) trperiod(1990) ///
    gen_vars</span>

<span class="code-comment">* Plot with placebos</span>
effect_graphs

<span class="code-comment">* P-values</span>
pval_graphs

<span class="code-comment">* RMSPE ratio (pre/post treatment fit)</span>
<span class="code-tooltip" data-tip="RMSPE ratio: large ratio means effect is unusual compared to placebos">single_treatment_graphs</span></code></pre>
            <button class="run-btn" data-lang="stata">Run Code</button>
          </div>
          <div class="tab-content" data-lang="r">
<pre><code><span class="code-comment"># R: Placebo Tests</span>
<span class="code-keyword">library</span>(Synth)

<span class="code-comment"># Function to run SC for any unit</span>
run_sc <- function(treated_id, donor_ids) {
  dp <- dataprep(
    foo = df,
    predictors = c("gdp", "population", "trade_openness"),
    predictors.op = "mean",
    time.predictors.prior = 1985:1989,
    dependent = "gdp",
    unit.variable = "country_id",
    time.variable = "year",
    treatment.identifier = treated_id,
    controls.identifier = donor_ids,
    time.optimize.ssr = 1985:1989,
    time.plot = 1985:2000
  )
  synth(dp)
}

<span class="code-comment"># Run placebo for each control unit</span>
<span class="code-tooltip" data-tip="Apply SC to each control unit as if it were treated">all_ids <- unique(df$country_id)
treated_id <- 7
control_ids <- setdiff(all_ids, treated_id)

placebo_gaps <- lapply(control_ids, function(id) {
  donors <- setdiff(all_ids, id)
  sc <- run_sc(id, donors)
  <span class="code-comment"># Calculate gaps</span>
  ...
})</span>

<span class="code-comment"># Using tidysynth (tidyverse-friendly)</span>
<span class="code-keyword">library</span>(tidysynth)

sc <- df %>%
  synthetic_control(
    outcome = gdp,
    unit = country,
    time = year,
    i_unit = "West Germany",
    i_time = 1990,
    generate_placebos = TRUE  <span class="code-comment"># auto placebo tests</span>
  ) %>%
  generate_predictor(...) %>%
  generate_weights() %>%
  generate_control()

<span class="code-comment"># Plot with placebos</span>
sc %>% plot_placebos()</code></pre>
            <button class="run-btn" data-lang="r">Run Code</button>
          </div>
        </div>

        <div class="output-simulation" data-output="synth-2" data-lang="python">
          <div class="output-header">
            <span>Python Output</span>
            <button class="close-output">&times;</button>
          </div>
          <div class="output-body"><pre>Running placebo tests for 19 control units...
  Austria: RMSPE = 312.45
  Belgium: RMSPE = 456.78
  Denmark: RMSPE = 289.34
  Finland: RMSPE = 523.12
  France: RMSPE = 198.67
  ...
  Switzerland: RMSPE = 345.23

Placebo Test Results
====================

Treated unit (West Germany):
  Pre-treatment RMSPE:  234.56
  Post-treatment RMSPE: 1456.78
  RMSPE ratio:          6.21

RMSPE Ratios (post/pre):
  West Germany:   6.21  <-- TREATED
  Austria:        2.34
  Belgium:        1.89
  Denmark:        2.12
  Finland:        1.45
  France:         3.12
  ...

Rank of treated unit: 1 out of 20
p-value (based on RMSPE ratio): 0.050

[Placebo plot displayed: Black line (West Germany) diverges
 significantly from gray lines (placebos) after 1990]</pre></div>
        </div>

        <div class="output-simulation" data-output="synth-2" data-lang="stata">
          <div class="output-header">
            <span>Stata Output</span>
            <button class="close-output">&times;</button>
          </div>
          <div class="output-body"><pre>Synthetic control with placebo tests

Running synth for 20 units...
  Unit 1 (Austria): done
  Unit 2 (Belgium): done
  ...
  Unit 7 (West Germany): TREATED UNIT
  ...
  Unit 20 (UK): done

RMSPE Summary:
--------------------------------------------------------------------------------
        Unit |   Pre-RMSPE   Post-RMSPE      Ratio       Rank
-------------+----------------------------------------------------------
West Germany |     234.56      1456.78       6.21          1
      France |     198.67       620.12       3.12          2
     Austria |     312.45       731.34       2.34          3
     Denmark |     289.34       614.56       2.12          4
     Belgium |     456.78       863.45       1.89          5
     ...
--------------------------------------------------------------------------------

Exact p-value (rank-based): 1/20 = 0.050

[effect_graphs: Shows gaps for all units, treated in black]
[pval_graphs: Shows running p-value over time]</pre></div>
        </div>

        <div class="output-simulation" data-output="synth-2" data-lang="r">
          <div class="output-header">
            <span>R Output</span>
            <button class="close-output">&times;</button>
          </div>
          <div class="output-body"><pre>Running placebo tests...
Processing unit 1 of 19: Austria
Processing unit 2 of 19: Belgium
...
Processing unit 19 of 19: UK

Placebo Test Summary
====================

RMSPE Comparison:
             Unit Pre.RMSPE Post.RMSPE   Ratio Rank
1    West Germany    234.56    1456.78    6.21    1
2          France    198.67     620.12    3.12    2
3         Austria    312.45     731.34    2.34    3
4         Denmark    289.34     614.56    2.12    4
5         Belgium    456.78     863.45    1.89    5
...

Inference:
  Treated unit rank: 1 out of 20
  Two-sided p-value: 2/20 = 0.100
  One-sided p-value: 1/20 = 0.050

Using tidysynth::plot_placebos():
[Spaghetti plot showing:
 - Black line: West Germany (treated)
 - Gray lines: 19 placebo units
 - Vertical line at 1990 (treatment)
 - West Germany shows clear negative divergence post-treatment]</pre></div>
        </div>

        <h2 id="critiques">Critiques and Limitations</h2>

        <div class="info-box warning">
          <div class="info-box-title">Known Issues with Synthetic Control</div>
          <p>Recent methodological work has identified several concerns:</p>
          <ul>
            <li><strong>Poor pre-treatment fit:</strong> If synthetic control can't match pre-treatment outcomes well, the counterfactual is unreliable</li>
            <li><strong>Specification searching:</strong> Researchers may choose predictors/time periods that produce desired results</li>
            <li><strong>Negative weights are implicitly forbidden:</strong> This restricts the counterfactual to the convex hull of donors, which may not include the treated unit's trajectory</li>
            <li><strong>No formal inference:</strong> Placebo tests provide intuition but don't give valid p-values in finite samples</li>
            <li><strong>Extrapolation:</strong> If treated unit is outside the support of controls, the method extrapolates</li>
          </ul>
          <p style="margin-bottom: 0;">
            <strong>Key papers:</strong> Ferman & Pinto (2021), Kaul et al. (2022), Abadie (2021 survey).
          </p>
        </div>

        <h3>Diagnostic Checks</h3>

        <div class="code-tabs" data-runnable="synth-3">
          <div class="tab-buttons">
            <button class="tab-button active" data-lang="python">Python</button>
            <button class="tab-button" data-lang="stata">Stata</button>
            <button class="tab-button" data-lang="r">R</button>
          </div>
          <div class="tab-content active" data-lang="python">
<pre><code><span class="code-comment"># Python: SC Diagnostics</span>

<span class="code-comment"># 1. Check pre-treatment fit (RMSPE)</span>
<span class="code-tooltip" data-tip="Pre-treatment RMSPE should be small relative to outcome variation">pre_rmspe = np.sqrt(np.mean((treated_pre - synthetic_pre)**2))
print(f<span class="code-string">"Pre-treatment RMSPE: {pre_rmspe:.3f}"</span>)</span>

<span class="code-comment"># 2. Check covariate balance</span>
print(<span class="code-string">"Predictor balance:"</span>)
print(sc.comparison)  <span class="code-comment"># treated vs synthetic on predictors</span>

<span class="code-comment"># 3. Check weights (few large weights is concerning)</span>
<span class="code-tooltip" data-tip="Weights concentrated on few donors may indicate poor match">print(<span class="code-string">"Number of donors with weight > 0.05:"</span>)
print((sc.W > 0.05).sum())</span>

<span class="code-comment"># 4. RMSPE ratio (for inference)</span>
<span class="code-tooltip" data-tip="Ratio of post/pre RMSPE: how unusual is the effect relative to pre-fit quality?">post_rmspe = np.sqrt(np.mean((treated_post - synthetic_post)**2))
rmspe_ratio = post_rmspe / pre_rmspe
print(f<span class="code-string">"RMSPE ratio: {rmspe_ratio:.2f}"</span>)</span></code></pre>
            <button class="run-btn" data-lang="python">Run Code</button>
          </div>
          <div class="tab-content" data-lang="stata">
<pre><code><span class="code-comment">* Stata: SC Diagnostics</span>

<span class="code-comment">* After running synth:</span>

<span class="code-comment">* 1. Pre-treatment RMSPE</span>
<span class="code-tooltip" data-tip="Small pre-treatment RMSPE indicates good fit">ereturn list
display <span class="code-string">"Pre-treatment RMSPE: "</span> sqrt(e(RMSPE))</span>

<span class="code-comment">* 2. Predictor balance</span>
<span class="code-tooltip" data-tip="Compare treated vs synthetic on predictors">matrix list e(Y_balance)</span>

<span class="code-comment">* 3. Donor weights</span>
matrix list e(W_weights)

<span class="code-comment">* 4. Leave-one-out robustness</span>
<span class="code-tooltip" data-tip="Check if results depend heavily on any single donor">foreach donor in $donor_list {
    synth gdp ..., trunit(7) trperiod(1990) ///
        counit(`=subinstr("$donor_list", "`donor'", "", .)')
}</span></code></pre>
            <button class="run-btn" data-lang="stata">Run Code</button>
          </div>
          <div class="tab-content" data-lang="r">
<pre><code><span class="code-comment"># R: SC Diagnostics</span>
<span class="code-keyword">library</span>(Synth)

<span class="code-comment"># 1. Pre-treatment RMSPE</span>
<span class="code-tooltip" data-tip="synth.tables shows predictor balance and RMSPE">synth.tables$tab.pred  <span class="code-comment"># predictor comparison</span></span>

<span class="code-comment"># 2. Weights</span>
synth.tables$tab.w  <span class="code-comment"># donor weights</span>

<span class="code-comment"># 3. Check sparsity of weights</span>
<span class="code-tooltip" data-tip="Ideally, several donors contribute meaningfully">sum(synth.out$solution.w > 0.05)</span>

<span class="code-comment"># 4. Leave-one-out</span>
<span class="code-tooltip" data-tip="Remove each major donor and re-estimate">loo_results <- lapply(major_donors, function(d) {
  new_donors <- setdiff(control_ids, d)
  <span class="code-comment"># Re-run synth without donor d</span>
  ...
})</span>

<span class="code-comment"># 5. Pre-treatment fit plot</span>
path.plot(synth.res = synth.out, dataprep.res = dataprep.out)
<span class="code-comment"># Visual check: do paths match well before treatment?</span></code></pre>
            <button class="run-btn" data-lang="r">Run Code</button>
          </div>
        </div>

        <div class="output-simulation" data-output="synth-3" data-lang="python">
          <div class="output-header">
            <span>Python Output</span>
            <button class="close-output">&times;</button>
          </div>
          <div class="output-body"><pre>SC Diagnostics
==============

1. Pre-treatment RMSPE: 234.560
   (Outcome mean: 23,456, so RMSPE is ~1% of mean - good fit)

2. Predictor Balance:
   Predictor        Treated    Synthetic    Difference
   gdp(1985)         21,456      21,389          67  (0.3%)
   gdp(1986)         22,134      22,067          67  (0.3%)
   gdp(1987)         23,012      22,945          67  (0.3%)
   gdp(1988)         24,567      24,512          55  (0.2%)
   gdp(1989)         25,890      25,823          67  (0.3%)
   population         61.2        58.9         2.3  (3.8%)
   trade_openness    0.456       0.448       0.008  (1.8%)

3. Donor Weight Sparsity:
   Number of donors with weight > 0.05: 4
   (Austria: 0.423, Netherlands: 0.312, Switzerland: 0.198, Belgium: 0.067)

4. RMSPE Ratio:
   Pre-treatment RMSPE:  234.56
   Post-treatment RMSPE: 1456.78
   RMSPE ratio: 6.21

   Interpretation: Post-treatment divergence is 6.2x larger than
   pre-treatment fit error - suggests meaningful treatment effect.</pre></div>
        </div>

        <div class="output-simulation" data-output="synth-3" data-lang="stata">
          <div class="output-header">
            <span>Stata Output</span>
            <button class="close-output">&times;</button>
          </div>
          <div class="output-body"><pre>Diagnostics for Synthetic Control
==================================

. ereturn list
scalars:
              e(RMSPE) =  55034.67136

. display "Pre-treatment RMSPE: " sqrt(e(RMSPE))
Pre-treatment RMSPE: 234.56

. matrix list e(Y_balance)
Y_balance[7,3]
                     Treated    Synthetic    Sample Mean
     gdp(1985)         21456        21389          19234
     gdp(1986)         22134        22067          19876
     gdp(1987)         23012        22945          20456
     gdp(1988)         24567        24512          21234
     gdp(1989)         25890        25823          22012
     population         61.2         58.9           45.6
trade_openness         0.456        0.448          0.412

. matrix list e(W_weights)
W_weights[19,1]
           weight
  Austria   0.423
Netherlands 0.312
Switzerland 0.198
  Belgium   0.067
   France   0.000
    ...

Leave-one-out robustness:
  Without Austria:     Effect = -1,189 (vs -1,234 with Austria)
  Without Netherlands: Effect = -1,298 (vs -1,234 with Netherlands)
  Without Switzerland: Effect = -1,212 (vs -1,234 with Switzerland)
Results are robust to excluding any single donor.</pre></div>
        </div>

        <div class="output-simulation" data-output="synth-3" data-lang="r">
          <div class="output-header">
            <span>R Output</span>
            <button class="close-output">&times;</button>
          </div>
          <div class="output-body"><pre>Synthetic Control Diagnostics
=============================

1. Predictor Balance (synth.tables$tab.pred):
                 Treated Synthetic Sample Mean
gdp(1985)          21456     21389       19234
gdp(1986)          22134     22067       19876
gdp(1987)          23012     22945       20456
gdp(1988)          24567     24512       21234
gdp(1989)          25890     25823       22012
population          61.2      58.9        45.6
trade_openness     0.456     0.448       0.412

2. Donor Weights (synth.tables$tab.w):
        unit.names w.weights
1          Austria     0.423
2      Netherlands     0.312
3      Switzerland     0.198
4          Belgium     0.067
5-19        Others     0.000

3. Weight Sparsity Check:
> sum(synth.out$solution.w > 0.05)
[1] 4

4. Leave-One-Out Results:
  Excluded       Estimate   Change
  Austria          -1189     +45
  Netherlands      -1298     -64
  Switzerland      -1212     +22
  Belgium          -1241      -7
  (Baseline: -1234)

5. Pre-treatment fit: Visual inspection shows excellent match
   [Path plot displayed]</pre></div>
        </div>

        <h2 id="extensions">Modern Extensions</h2>

        <h3>Augmented Synthetic Control (Ben-Michael et al. 2021)</h3>

        <p>
          Combines synthetic control with outcome regression to correct for imperfect pre-treatment fit.
        </p>

        <div class="code-tabs" data-runnable="synth-4">
          <div class="tab-buttons">
            <button class="tab-button active" data-lang="r">R</button>
          </div>
          <div class="tab-content active" data-lang="r">
<pre><code><span class="code-comment"># R: Augmented Synthetic Control</span>
<span class="code-keyword">library</span>(augsynth)

<span class="code-comment"># Augmented SC with ridge regression</span>
<span class="code-tooltip" data-tip="augsynth adds bias correction for imperfect pre-treatment fit">asyn <- augsynth(outcome ~ treatment | covariate1 + covariate2,
                 unit = unit_id,
                 time = year,
                 data = df,
                 progfunc = "Ridge")</span>

<span class="code-comment"># Summary and plot</span>
summary(asyn)
plot(asyn)

<span class="code-comment"># Compare to standard SC</span>
syn <- augsynth(outcome ~ treatment,
                unit = unit_id,
                time = year,
                data = df,
                progfunc = "None")  <span class="code-comment"># standard SC</span></code></pre>
            <button class="run-btn" data-lang="r">Run Code</button>
          </div>
        </div>

        <div class="output-simulation" data-output="synth-4" data-lang="r">
          <div class="output-header">
            <span>R Output</span>
            <button class="close-output">&times;</button>
          </div>
          <div class="output-body"><pre>Augmented Synthetic Control Results
====================================

Call:
augsynth(outcome ~ treatment | covariate1 + covariate2,
         unit = unit_id, time = year, data = df, progfunc = "Ridge")

Average ATT Estimate (post-treatment):
        Estimate  Std.Error   t value     p value
ATT       -1,312      412.3    -3.182      0.0015 **

Time-varying effects:
  Year   Estimate   Std.Error     95% CI
  1990      -234       189.2    [-605,  137]
  1991      -567       234.5    [-1027,-107]
  1992      -892       298.1    [-1476,-308]
  1993     -1,234      356.7    [-1933,-535]
  ...
  2000     -2,156      489.2    [-3115,-1197]

Pre-treatment fit:
  L2 Imbalance (pre-treatment): 0.0234
  Percent improvement from augmentation: 34.2%

Comparison: Standard SC vs Augmented SC
                    Standard    Augmented
ATT Estimate          -1,234      -1,312
Std. Error               N/A       412.3
Pre-treatment RMSPE   234.56      154.23

[Plot displayed showing point estimates with confidence bands]</pre></div>
        </div>

        <h3>Synthetic Difference-in-Differences (Arkhangelsky et al. 2021)</h3>

        <p>
          Combines DiD and SC: uses SC weights on units AND time periods to construct the counterfactual.
        </p>

        <div class="code-tabs" data-runnable="synth-5">
          <div class="tab-buttons">
            <button class="tab-button active" data-lang="python">Python</button>
            <button class="tab-button" data-lang="stata">Stata</button>
            <button class="tab-button" data-lang="r">R</button>
          </div>
          <div class="tab-content active" data-lang="python">
<pre><code><span class="code-comment"># Python: Synthetic DiD</span>
<span class="code-comment"># pip install synthdid</span>
<span class="code-keyword">from</span> synthdid.synthdid <span class="code-keyword">import</span> SynthDID

<span class="code-comment"># Prepare data: Y matrix (units x time), treatment indicator</span>
<span class="code-tooltip" data-tip="SDID weights both units (like SC) and time periods">sdid = SynthDID(Y, treatment_matrix)</span>
estimate = sdid.fit()
print(f<span class="code-string">"SDID estimate: {estimate:.3f}"</span>)

<span class="code-comment"># Get weights</span>
print(<span class="code-string">"Unit weights:"</span>, sdid.omega)
print(<span class="code-string">"Time weights:"</span>, sdid.lambda_)</code></pre>
            <button class="run-btn" data-lang="python">Run Code</button>
          </div>
          <div class="tab-content" data-lang="stata">
<pre><code><span class="code-comment">* Stata: Synthetic DiD</span>
<span class="code-comment">* ssc install sdid</span>

<span class="code-comment">* Basic SDID</span>
<span class="code-tooltip" data-tip="sdid combines SC unit weights with DiD time structure">sdid outcome unit_id year treatment, vce(bootstrap) seed(1234)</span>

<span class="code-comment">* With graph</span>
sdid outcome unit_id year treatment, vce(bootstrap) graph</code></pre>
            <button class="run-btn" data-lang="stata">Run Code</button>
          </div>
          <div class="tab-content" data-lang="r">
<pre><code><span class="code-comment"># R: Synthetic DiD with synthdid</span>
<span class="code-keyword">library</span>(synthdid)

<span class="code-comment"># Prepare panel data</span>
<span class="code-tooltip" data-tip="panel.matrices converts data to required format">setup <- panel.matrices(df,
                        unit = unit_id,
                        time = year,
                        outcome = outcome,
                        treatment = treatment)</span>

<span class="code-comment"># Estimate SDID</span>
sdid_est <- synthdid_estimate(setup$Y, setup$N0, setup$T0)
print(sdid_est)

<span class="code-comment"># Standard errors via bootstrap</span>
se <- sqrt(vcov(sdid_est, method = "bootstrap"))

<span class="code-comment"># Compare to DiD and SC</span>
did_est <- did_estimate(setup$Y, setup$N0, setup$T0)
sc_est <- sc_estimate(setup$Y, setup$N0, setup$T0)

<span class="code-comment"># Plot</span>
synthdid_plot(sdid_est)</code></pre>
            <button class="run-btn" data-lang="r">Run Code</button>
          </div>
        </div>

        <div class="output-simulation" data-output="synth-5" data-lang="python">
          <div class="output-header">
            <span>Python Output</span>
            <button class="close-output">&times;</button>
          </div>
          <div class="output-body"><pre>Synthetic Difference-in-Differences (SDID)
==========================================

SDID estimate: -1,287.456

Unit weights (omega):
  Austria:      0.312
  Netherlands:  0.267
  Switzerland:  0.189
  Belgium:      0.134
  France:       0.098
  (Remaining units have small weights)

Time weights (lambda):
  1985: 0.034
  1986: 0.089
  1987: 0.156
  1988: 0.267
  1989: 0.454
  (More weight on periods closer to treatment)

Comparison of Methods:
                Estimate     SE
DiD             -1,456    523.4
SC              -1,234      N/A
SDID            -1,287    398.2

Note: SDID interpolates between DiD (equal unit weights)
and SC (zero time weights for pre-treatment).</pre></div>
        </div>

        <div class="output-simulation" data-output="synth-5" data-lang="stata">
          <div class="output-header">
            <span>Stata Output</span>
            <button class="close-output">&times;</button>
          </div>
          <div class="output-body"><pre>Synthetic Difference-in-Differences

Number of observations:        320 (20 units x 16 periods)
Treated unit:                  West Germany
Treatment period:              1990
Control units:                 19
Pre-treatment periods:         5
Post-treatment periods:        11

------------------------------------------------------------------------------
             |      SDID    Bootstrap        [95% Conf. Interval]
             |   Estimate    Std. Err.
-------------+----------------------------------------------------------------
   treatment |  -1287.456     398.234        -2067.98       -506.93
------------------------------------------------------------------------------
Bootstrap replications: 200

Unit Weights:
          Austria: 0.312
      Netherlands: 0.267
      Switzerland: 0.189
          Belgium: 0.134
           France: 0.098

Time Weights:
  1985: 0.034    1986: 0.089    1987: 0.156    1988: 0.267    1989: 0.454

[Graph saved: sdid_plot.gph]</pre></div>
        </div>

        <div class="output-simulation" data-output="synth-5" data-lang="r">
          <div class="output-header">
            <span>R Output</span>
            <button class="close-output">&times;</button>
          </div>
          <div class="output-body"><pre>Synthetic Difference-in-Differences Estimate
============================================

> print(sdid_est)
synthdid: -1287.456

> se <- sqrt(vcov(sdid_est, method = "bootstrap"))
> se
[1] 398.234

95% Confidence Interval: [-2067.98, -506.93]

Comparison of Estimators:
> did_est
did: -1456.123

> sc_est
sc: -1234.567

Summary Table:
        Method  Estimate   Std.Err.     95% CI
1          DiD   -1456.1     523.4  [-2482, -430]
2           SC   -1234.6       N/A            N/A
3         SDID   -1287.5     398.2  [-2068, -507]

Unit weights (omega):
         Austria      Netherlands      Switzerland
           0.312            0.267            0.189

Time weights (lambda):
  1985   1986   1987   1988   1989
 0.034  0.089  0.156  0.267  0.454

[synthdid_plot displayed showing:
 - Treated unit path (solid black)
 - Synthetic control path (dashed)
 - Treatment time vertical line
 - Confidence bands]</pre></div>
        </div>

        <div class="citation">
          <div class="citation-title">Key References</div>
          <ul>
            <li><strong>Abadie, A., Diamond, A., & Hainmueller, J.</strong> (2010). "Synthetic Control Methods for Comparative Case Studies." <em>JASA</em>.</li>
            <li><strong>Abadie, A.</strong> (2021). "Using Synthetic Controls: Feasibility, Data Requirements, and Methodological Aspects." <em>JEL</em>.</li>
            <li><strong>Arkhangelsky, D., Athey, S., Hirshberg, D., Imbens, G., & Wager, S.</strong> (2021). "Synthetic Difference-in-Differences." <em>AER</em>.</li>
            <li><strong>Ben-Michael, E., Feller, A., & Rothstein, J.</strong> (2021). "The Augmented Synthetic Control Method." <em>JASA</em>.</li>
            <li><strong>Ferman, B. & Pinto, C.</strong> (2021). "Synthetic Control Method: Inference, Sensitivity Analysis and Confidence Sets." <em>JBES</em>.</li>
          </ul>
        </div>

        <div class="nav-footer">
          <a href="06d-iv.html" class="nav-link prev">6D: Instrumental Variables</a>
          <a href="07-estimation.html" class="nav-link next">Module 7: Estimation</a>
        </div>
      </div>
    </main>
  </div>

  <button class="mobile-menu-toggle" aria-label="Toggle navigation menu">Menu</button>
  <script src="../js/main.js"></script>
  <script src="../js/password-protection.js"></script>
</body>
</html>
