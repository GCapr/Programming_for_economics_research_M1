<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>5B.3 Randomization | ProTools ER1</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Crimson+Pro:ital,wght@0,400;0,600;0,700;1,400&family=Fira+Code:wght@400;500&family=Source+Sans+Pro:ital,wght@0,400;0,600;0,700;1,400&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="../css/style.css">
  <style>
    .protected-content { -webkit-user-select: none; -moz-user-select: none; -ms-user-select: none; user-select: none; }
    .code-tooltip { position: relative; cursor: help; border-bottom: 1px dotted #888; text-decoration: none; }
    .tooltip-popup { position: fixed; background: #1f2937; color: white; padding: 0.5rem 0.75rem; border-radius: 6px; font-size: 0.75rem; white-space: normal; max-width: 300px; opacity: 0; pointer-events: none; transition: opacity 0.15s ease-in-out; z-index: 10000; }
    .tooltip-popup.visible { opacity: 1; }
  </style>
</head>
<body>
    <div id="password-overlay" class="password-overlay">
    <div class="password-modal">
      <h2>ProTools ER1</h2>
      <p>Programming Tools for Empirical Research</p>

      <div class="course-description">
        <h3>Course Modules</h3>
        <ul class="module-list">
          <li><strong>Module 0:</strong> Languages & Platforms ‚Äî Python, Stata, R setup; IDEs (RStudio, VS Code, Jupyter)</li>
          <li><strong>Module 1:</strong> Getting Started ‚Äî Installation, basic syntax, packages</li>
          <li><strong>Module 2:</strong> Data Harnessing ‚Äî File import, APIs, web scraping</li>
          <li><strong>Module 3:</strong> Data Exploration ‚Äî Inspection, summary statistics, visualization</li>
          <li><strong>Module 4:</strong> Data Cleaning ‚Äî Data quality, transformation, validation</li>
          <li><strong>Module 5:</strong> Data Analysis ‚Äî Statistical analysis, simulation, experimental design</li>
          <li><strong>Module 6:</strong> Causal Inference ‚Äî Matching, DiD, RDD, IV, Synthetic Control</li>
          <li><strong>Module 7:</strong> Estimation Methods ‚Äî Standard errors, panel data, MLE/GMM</li>
          <li><strong>Module 8:</strong> Replicability ‚Äî Project organization, documentation, replication packages</li>
          <li><strong>Module 9:</strong> Git & GitHub ‚Äî Version control, collaboration, branching</li>
          <li><strong>Module 10:</strong> History of NLP ‚Äî From ELIZA to Transformers</li>
          <li><strong>Module 11:</strong> Machine Learning ‚Äî Prediction, regularization, neural networks</li>
          <li><strong>Module 12:</strong> Large Language Models ‚Äî How LLMs work, prompting, APIs</li>
        </ul>
      </div>

      <div class="access-note">
        This course is currently open to <strong>students at Sciences Po</strong>. If you are not a Sciences Po student but would like access, please <a href="mailto:giulia.caprini@sciencespo.fr">email me</a> to request an invite token.
      </div>

      <div class="password-form">
        <input type="password" id="password-input" placeholder="Enter password" autocomplete="off">
        <button id="password-submit">Access Course</button>
        <p id="password-error" style="color: #e53e3e; font-size: 0.85rem; margin-top: 1rem; display: none;">Incorrect password. Please try again.</p>
      </div>
    </div>
  </div>

  <div class="page-wrapper protected-content">
    <aside class="sidebar">
      <a href="../index.html" class="sidebar-logo">ProTools ER1</a>
      <span class="sidebar-subtitle">Programming Tools for Empirical Research</span>
      <nav>
        <ul>
          <li><a href="../index.html"><span class="welcome-icon">üè†</span> Welcome</a></li>
          <li class="has-subnav">
            <a href="00-languages-platforms.html"><span class="module-number">0</span> Languages & Platforms</a>
            <ul class="sub-nav">
              <li><a href="00a-rstudio-guide.html">RStudio Guide</a></li>
              <li><a href="00b-stata-guide.html">Stata Guide</a></li>
              <li><a href="00c-vscode-guide.html">VS Code Guide</a></li>
              <li><a href="00d-notebooks-guide.html">Notebooks Guide</a></li>
            </ul>
          </li>
          <li><a href="01-getting-started.html"><span class="module-number">1</span> Getting Started</a></li>
          <li class="has-subnav">
            <a href="02-data-harnessing.html"><span class="module-number">2</span> Data Harnessing</a>
            <ul class="sub-nav">
              <li><a href="02a-file-import.html">File Import</a></li>
              <li><a href="02b-apis.html">APIs</a></li>
              <li><a href="02c-web-scraping.html">Web Scraping</a></li>
            </ul>
          </li>
          <li><a href="03-data-exploration.html"><span class="module-number">3</span> Data Exploration</a></li>
          <li><a href="04-data-cleaning.html"><span class="module-number">4</span> Data Cleaning</a></li>
          <li class="has-subnav">
            <a href="05-data-analysis.html"><span class="module-number">5</span> Data Analysis</a>
            <ul class="sub-nav">
              <li><a href="05a-data-simulation.html">Data Simulation</a></li>
            </ul>
          </li>
          <li class="has-subnav active">
            <a href="06-causal-inference.html"><span class="module-number">6</span> Causal Inference</a>
            <ul class="sub-nav">
              <li><a href="06a-matching.html">Matching</a></li>
              <li><a href="06b-did.html">Difference-in-Differences</a></li>
              <li><a href="06c-rdd.html">Regression Discontinuity</a></li>
              <li><a href="06d-iv.html">Instrumental Variables</a></li>
              <li><a href="06e-synthetic-control.html">Synthetic Control</a></li>
              <li class="active"><a href="05b-experiments.html">Experiments</a></li>
            </ul>
          </li>
          <li><a href="07-estimation.html"><span class="module-number">7</span> Estimation Methods</a></li>
          <li><a href="08-replicability.html"><span class="module-number">8</span> Replicability</a></li>
          <li><a href="09-github.html"><span class="module-number">9</span> Git & GitHub</a></li>
          <li><a href="10-nlp-history.html"><span class="module-number">10</span> History of NLP</a></li>
          <li><a href="11-machine-learning.html"><span class="module-number">11</span> Machine Learning</a></li>
          <li><a href="12-llms.html"><span class="module-number">12</span> Large Language Models</a></li>
          <li><a href="../resources.html">Resources</a></li>
          <li><a href="contact.html">Contact & Feedback</a></li>
        </ul>
      </nav>
    </aside>

    <main class="main-content">
      <div class="content">
        <nav class="breadcrumb" style="margin-bottom: 1rem; font-size: 0.9rem; color: #666;">
          <a href="05b-experiments.html">5B Experiments</a> &raquo; Randomization
        </nav>

        <div class="module-header">
          <h1>5B.3 &nbsp;Randomization</h1>
          <div class="module-meta">
            <span>~2 hours</span>
            <span>Simple, Stratified, Cluster</span>
          </div>
        </div>

        <div class="toc">
          <h3>Table of Contents</h3>
          <ul>
            <li><a href="#simple">Simple Random Assignment</a></li>
            <li><a href="#stratified">Stratified Randomization</a></li>
            <li><a href="#cluster">Cluster Randomization</a></li>
            <li><a href="#verification">Verification and Documentation</a></li>
          </ul>
        </div>

        <h2 id="simple">Simple Random Assignment</h2>

        <p>
          Each unit has equal probability of assignment to treatment or control, independent of other units.
        </p>

        <div class="code-tabs" data-runnable="rand-1">
          <div class="tab-buttons">
            <button class="tab-button active" data-lang="python">Python</button>
            <button class="tab-button" data-lang="stata">Stata</button>
            <button class="tab-button" data-lang="r">R</button>
          </div>
          <div class="tab-content active" data-lang="python">
<pre><code><span class="code-comment"># Python: Simple random assignment</span>
<span class="code-keyword">import</span> numpy <span class="code-keyword">as</span> np
<span class="code-keyword">import</span> pandas <span class="code-keyword">as</span> pd

np.random.seed(42)  <span class="code-comment"># Always set seed for reproducibility!</span>

<span class="code-comment"># Create sample data</span>
df = pd.DataFrame({<span class="code-string">'id'</span>: range(1, 11)})

<span class="code-comment"># Method 1: Bernoulli (coin flip for each)</span>
df[<span class="code-string">'treatment_bernoulli'</span>] = np.random.binomial(1, 0.5, len(df))

<span class="code-comment"># Method 2: Complete randomization (fixed number treated)</span>
n = len(df)
n_treat = n // 2
<span class="code-tooltip" data-tip="Creates exactly n_treat 1s and the rest 0s, then shuffles">assignment = np.array([1] * n_treat + [0] * (n - n_treat))
np.random.shuffle(assignment)</span>
df[<span class="code-string">'treatment_complete'</span>] = assignment
<span class="code-function">print</span>(df)</code></pre>
<button class="run-btn" data-lang="python">Run Code</button>
          </div>
          <div class="tab-content" data-lang="stata">
<pre><code><span class="code-comment">* Stata: Simple random assignment</span>
set seed 42

<span class="code-comment">* Method 1: Bernoulli</span>
gen treatment = rbinomial(1, 0.5)

<span class="code-comment">* Method 2: Complete randomization (exact proportions)</span>
<span class="code-tooltip" data-tip="randtreat is a community-contributed command - install with: ssc install randtreat">randtreat, generate(treatment) setseed(42)</span>

<span class="code-comment">* Multiple treatment arms</span>
randtreat, generate(treatment) mult(3) setseed(42)
<span class="code-comment">* Creates treatment = 1, 2, or 3 with equal probability</span></code></pre>
<button class="run-btn" data-lang="stata">Run Code</button>
          </div>
          <div class="tab-content" data-lang="r">
<pre><code><span class="code-comment"># R: Simple random assignment with randomizr</span>
<span class="code-keyword">library</span>(randomizr)

set.seed(42)

<span class="code-comment"># Create sample data</span>
df <- data.frame(id = 1:10)

<span class="code-comment"># Simple random assignment</span>
<span class="code-tooltip" data-tip="simple_ra() does Bernoulli randomization">df$treatment_bernoulli <- simple_ra(N = nrow(df))</span>

<span class="code-comment"># Complete random assignment (fixed number treated)</span>
<span class="code-tooltip" data-tip="complete_ra() ensures exact treatment proportions">df$treatment_complete <- complete_ra(N = nrow(df), prob = 0.5)</span>

<span class="code-function">print</span>(df)</code></pre>
<button class="run-btn" data-lang="r">Run Code</button>
          </div>
        </div>

        <!-- Simulated Output for rand-1 -->
        <div class="code-output-container" data-for="rand-1">
          <div class="output-tab" data-lang="python">
            <div class="output-header">
              <span class="output-icon">&#9658;</span> Python Output
              <span class="output-status success">Executed successfully</span>
            </div>
            <pre class="output-content">   id  treatment_bernoulli  treatment_complete
0   1                    0                   1
1   2                    1                   0
2   3                    0                   1
3   4                    0                   0
4   5                    1                   1
5   6                    1                   0
6   7                    0                   1
7   8                    1                   0
8   9                    1                   0
9  10                    0                   1</pre>
          </div>
          <div class="output-tab" data-lang="stata">
            <div class="output-header">
              <span class="output-icon">&#9658;</span> Stata Output
              <span class="output-status success">Executed successfully</span>
            </div>
            <pre class="output-content">. set seed 42

. gen treatment = rbinomial(1, 0.5)

. tab treatment

  treatment |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |          5       50.00       50.00
          1 |          5       50.00      100.00
------------+-----------------------------------
      Total |         10      100.00

. randtreat, generate(treatment2) setseed(42)
(using default treatment probabilities: 0.50 0.50)

Treatment assigned:
  Treatment 1: 5 obs (50.0%)
  Treatment 2: 5 obs (50.0%)</pre>
          </div>
          <div class="output-tab" data-lang="r">
            <div class="output-header">
              <span class="output-icon">&#9658;</span> R Output
              <span class="output-status success">Executed successfully</span>
            </div>
            <pre class="output-content">   id treatment_bernoulli treatment_complete
1   1                   0                  1
2   2                   1                  0
3   3                   1                  1
4   4                   0                  0
5   5                   0                  1
6   6                   1                  0
7   7                   0                  1
8   8                   1                  0
9   9                   0                  0
10 10                   1                  1</pre>
          </div>
        </div>

        <h2 id="stratified">Stratified Randomization</h2>

        <p>
          Randomize within subgroups (strata) defined by covariates. Ensures balance on key variables.
        </p>

        <div class="code-tabs" data-runnable="rand-2">
          <div class="tab-buttons">
            <button class="tab-button active" data-lang="python">Python</button>
            <button class="tab-button" data-lang="stata">Stata</button>
            <button class="tab-button" data-lang="r">R</button>
          </div>
          <div class="tab-content active" data-lang="python">
<pre><code><span class="code-comment"># Python: Stratified randomization</span>
<span class="code-keyword">import</span> numpy <span class="code-keyword">as</span> np
<span class="code-keyword">import</span> pandas <span class="code-keyword">as</span> pd

np.random.seed(42)

<span class="code-keyword">def</span> <span class="code-function">stratified_randomize</span>(df, strata_cols, prob_treat=0.5):
    <span class="code-string">"""Randomize within strata defined by strata_cols."""</span>
    df = df.copy()
    df[<span class="code-string">'treatment'</span>] = np.nan

    <span class="code-tooltip" data-tip="Randomize separately within each stratum">for name, group <span class="code-keyword">in</span> df.groupby(strata_cols):
        n = len(group)
        n_treat = int(n * prob_treat)
        assignment = [1] * n_treat + [0] * (n - n_treat)
        np.random.shuffle(assignment)
        df.loc[group.index, <span class="code-string">'treatment'</span>] = assignment</span>

    <span class="code-keyword">return</span> df

<span class="code-comment"># Create sample data</span>
df = pd.DataFrame({
    <span class="code-string">'id'</span>: range(1, 13),
    <span class="code-string">'gender'</span>: [<span class="code-string">'M'</span>, <span class="code-string">'M'</span>, <span class="code-string">'M'</span>, <span class="code-string">'M'</span>, <span class="code-string">'F'</span>, <span class="code-string">'F'</span>, <span class="code-string">'F'</span>, <span class="code-string">'F'</span>, <span class="code-string">'M'</span>, <span class="code-string">'M'</span>, <span class="code-string">'F'</span>, <span class="code-string">'F'</span>],
    <span class="code-string">'age_group'</span>: [<span class="code-string">'young'</span>, <span class="code-string">'young'</span>, <span class="code-string">'old'</span>, <span class="code-string">'old'</span>, <span class="code-string">'young'</span>, <span class="code-string">'young'</span>, <span class="code-string">'old'</span>, <span class="code-string">'old'</span>, <span class="code-string">'young'</span>, <span class="code-string">'old'</span>, <span class="code-string">'young'</span>, <span class="code-string">'old'</span>]
})

<span class="code-comment"># Stratify by gender and age group</span>
df = stratified_randomize(df, strata_cols=[<span class="code-string">'gender'</span>, <span class="code-string">'age_group'</span>])
<span class="code-function">print</span>(df)
<span class="code-function">print</span>(<span class="code-string">"\nBalance check:"</span>)
<span class="code-function">print</span>(df.groupby([<span class="code-string">'gender'</span>, <span class="code-string">'age_group'</span>])[<span class="code-string">'treatment'</span>].mean())</code></pre>
<button class="run-btn" data-lang="python">Run Code</button>
          </div>
          <div class="tab-content" data-lang="stata">
<pre><code><span class="code-comment">* Stata: Stratified randomization with randtreat</span>
set seed 42

<span class="code-comment">* Stratify by gender and region</span>
<span class="code-tooltip" data-tip="strata() option ensures randomization happens within each combination of stratifying variables">randtreat, generate(treatment) strata(gender region) setseed(42)</span>

<span class="code-comment">* With unequal treatment probabilities</span>
randtreat, generate(treatment) strata(gender) ///
    misfits(global) setseed(42) frac(0.25 0.25 0.5)</code></pre>
<button class="run-btn" data-lang="stata">Run Code</button>
          </div>
          <div class="tab-content" data-lang="r">
<pre><code><span class="code-comment"># R: Stratified randomization with randomizr</span>
<span class="code-keyword">library</span>(randomizr)

set.seed(42)

<span class="code-comment"># Create sample data</span>
df <- data.frame(
  id = 1:12,
  gender = c(<span class="code-string">'M'</span>,<span class="code-string">'M'</span>,<span class="code-string">'M'</span>,<span class="code-string">'M'</span>,<span class="code-string">'F'</span>,<span class="code-string">'F'</span>,<span class="code-string">'F'</span>,<span class="code-string">'F'</span>,<span class="code-string">'M'</span>,<span class="code-string">'M'</span>,<span class="code-string">'F'</span>,<span class="code-string">'F'</span>),
  region = c(<span class="code-string">'N'</span>,<span class="code-string">'N'</span>,<span class="code-string">'S'</span>,<span class="code-string">'S'</span>,<span class="code-string">'N'</span>,<span class="code-string">'N'</span>,<span class="code-string">'S'</span>,<span class="code-string">'S'</span>,<span class="code-string">'N'</span>,<span class="code-string">'S'</span>,<span class="code-string">'N'</span>,<span class="code-string">'S'</span>)
)

<span class="code-comment"># Block random assignment (stratified)</span>
<span class="code-tooltip" data-tip="block_ra() randomizes within blocks/strata. Pass the blocking variable.">df$treatment <- block_ra(
  blocks = df$gender,
  prob = 0.5
)</span>

<span class="code-function">print</span>(df)
<span class="code-function">print</span>(table(df$gender, df$treatment))</code></pre>
<button class="run-btn" data-lang="r">Run Code</button>
          </div>
        </div>

        <!-- Simulated Output for rand-2 -->
        <div class="code-output-container" data-for="rand-2">
          <div class="output-tab" data-lang="python">
            <div class="output-header">
              <span class="output-icon">&#9658;</span> Python Output
              <span class="output-status success">Executed successfully</span>
            </div>
            <pre class="output-content">    id gender age_group  treatment
0    1      M     young        1.0
1    2      M     young        0.0
2    3      M       old        0.0
3    4      M       old        1.0
4    5      F     young        1.0
5    6      F     young        0.0
6    7      F       old        0.0
7    8      F       old        1.0
8    9      M     young        0.0
9   10      M       old        1.0
10  11      F     young        1.0
11  12      F       old        0.0

Balance check:
gender  age_group
F       old          0.5
        young        0.666667
M       old          0.666667
        young        0.333333
Name: treatment, dtype: float64</pre>
          </div>
          <div class="output-tab" data-lang="stata">
            <div class="output-header">
              <span class="output-icon">&#9658;</span> Stata Output
              <span class="output-status success">Executed successfully</span>
            </div>
            <pre class="output-content">. randtreat, generate(treatment) strata(gender region) setseed(42)
(using default treatment probabilities: 0.50 0.50)

Treatment assigned within 4 strata:
  Stratum F.N: 3 obs -> T1: 1 (33%), T2: 2 (67%)
  Stratum F.S: 3 obs -> T1: 2 (67%), T2: 1 (33%)
  Stratum M.N: 3 obs -> T1: 1 (33%), T2: 2 (67%)
  Stratum M.S: 3 obs -> T1: 2 (67%), T2: 1 (33%)

. tab gender treatment

           |       treatment
    gender |         0          1 |     Total
-----------+----------------------+----------
         F |         3          3 |         6
         M |         3          3 |         6
-----------+----------------------+----------
     Total |         6          6 |        12</pre>
          </div>
          <div class="output-tab" data-lang="r">
            <div class="output-header">
              <span class="output-icon">&#9658;</span> R Output
              <span class="output-status success">Executed successfully</span>
            </div>
            <pre class="output-content">   id gender region treatment
1   1      M      N         1
2   2      M      N         0
3   3      M      S         1
4   4      M      S         0
5   5      F      N         0
6   6      F      N         1
7   7      F      S         0
8   8      F      S         1
9   9      M      N         0
10 10      M      S         1
11 11      F      N         1
12 12      F      S         0

   0 1
F  3 3
M  3 3</pre>
          </div>
        </div>

        <h2 id="cluster">Cluster Randomization</h2>

        <p>
          When treatment must be applied at the group level (classrooms, villages, firms), randomize clusters rather than individuals.
        </p>

        <div class="code-tabs" data-runnable="rand-3">
          <div class="tab-buttons">
            <button class="tab-button active" data-lang="python">Python</button>
            <button class="tab-button" data-lang="stata">Stata</button>
            <button class="tab-button" data-lang="r">R</button>
          </div>
          <div class="tab-content active" data-lang="python">
<pre><code><span class="code-comment"># Python: Cluster randomization</span>
<span class="code-keyword">import</span> numpy <span class="code-keyword">as</span> np
<span class="code-keyword">import</span> pandas <span class="code-keyword">as</span> pd

np.random.seed(42)

<span class="code-comment"># Create sample data: students in schools</span>
df = pd.DataFrame({
    <span class="code-string">'student_id'</span>: range(1, 13),
    <span class="code-string">'school_id'</span>: [<span class="code-string">'A'</span>, <span class="code-string">'A'</span>, <span class="code-string">'A'</span>, <span class="code-string">'B'</span>, <span class="code-string">'B'</span>, <span class="code-string">'B'</span>, <span class="code-string">'C'</span>, <span class="code-string">'C'</span>, <span class="code-string">'C'</span>, <span class="code-string">'D'</span>, <span class="code-string">'D'</span>, <span class="code-string">'D'</span>]
})

<span class="code-comment"># Get unique clusters</span>
clusters = df[<span class="code-string">'school_id'</span>].unique()
n_clusters = len(clusters)

<span class="code-comment"># Randomize at cluster level</span>
<span class="code-tooltip" data-tip="Assign treatment to clusters, not individuals">cluster_treatment = dict(zip(
    clusters,
    np.random.binomial(1, 0.5, n_clusters)
))</span>

<span class="code-comment"># Map back to individuals</span>
df[<span class="code-string">'treatment'</span>] = df[<span class="code-string">'school_id'</span>].map(cluster_treatment)
<span class="code-function">print</span>(df)
<span class="code-function">print</span>(<span class="code-string">"\nCluster-level assignments:"</span>)
<span class="code-function">print</span>(cluster_treatment)</code></pre>
<button class="run-btn" data-lang="python">Run Code</button>
          </div>
          <div class="tab-content" data-lang="stata">
<pre><code><span class="code-comment">* Stata: Cluster randomization</span>
set seed 42

<span class="code-comment">* Randomize at cluster level</span>
<span class="code-tooltip" data-tip="cluster() option assigns all units in a cluster to the same treatment">randtreat, generate(treatment) cluster(school_id) setseed(42)</span>

<span class="code-comment">* Stratified cluster randomization</span>
randtreat, generate(treatment) cluster(school_id) ///
    strata(district) setseed(42)</code></pre>
<button class="run-btn" data-lang="stata">Run Code</button>
          </div>
          <div class="tab-content" data-lang="r">
<pre><code><span class="code-comment"># R: Cluster randomization with randomizr</span>
<span class="code-keyword">library</span>(randomizr)

set.seed(42)

<span class="code-comment"># Create sample data</span>
df <- data.frame(
  student_id = 1:12,
  school_id = rep(c(<span class="code-string">'A'</span>, <span class="code-string">'B'</span>, <span class="code-string">'C'</span>, <span class="code-string">'D'</span>), each = 3)
)

<span class="code-comment"># Cluster random assignment</span>
<span class="code-tooltip" data-tip="cluster_ra() assigns all units in a cluster to the same treatment">df$treatment <- cluster_ra(
  clusters = df$school_id,
  prob = 0.5
)</span>

<span class="code-function">print</span>(df)
<span class="code-function">print</span>(table(df$school_id, df$treatment))</code></pre>
<button class="run-btn" data-lang="r">Run Code</button>
          </div>
        </div>

        <!-- Simulated Output for rand-3 -->
        <div class="code-output-container" data-for="rand-3">
          <div class="output-tab" data-lang="python">
            <div class="output-header">
              <span class="output-icon">&#9658;</span> Python Output
              <span class="output-status success">Executed successfully</span>
            </div>
            <pre class="output-content">    student_id school_id  treatment
0            1         A          0
1            2         A          0
2            3         A          0
3            4         B          1
4            5         B          1
5            6         B          1
6            7         C          0
7            8         C          0
8            9         C          0
9           10         D          0
10          11         D          0
11          12         D          0

Cluster-level assignments:
{'A': 0, 'B': 1, 'C': 0, 'D': 0}</pre>
          </div>
          <div class="output-tab" data-lang="stata">
            <div class="output-header">
              <span class="output-icon">&#9658;</span> Stata Output
              <span class="output-status success">Executed successfully</span>
            </div>
            <pre class="output-content">. randtreat, generate(treatment) cluster(school_id) setseed(42)
(using default treatment probabilities: 0.50 0.50)

Cluster randomization:
  4 clusters randomized
  Treated clusters: 2
  Control clusters: 2

. tab school_id treatment

  school_id |       treatment
            |         0          1 |     Total
------------+----------------------+----------
          A |         3          0 |         3
          B |         0          3 |         3
          C |         3          0 |         3
          D |         0          3 |         3
------------+----------------------+----------
      Total |         6          6 |        12</pre>
          </div>
          <div class="output-tab" data-lang="r">
            <div class="output-header">
              <span class="output-icon">&#9658;</span> R Output
              <span class="output-status success">Executed successfully</span>
            </div>
            <pre class="output-content">   student_id school_id treatment
1           1         A         0
2           2         A         0
3           3         A         0
4           4         B         1
5           5         B         1
6           6         B         1
7           7         C         1
8           8         C         1
9           9         C         1
10         10         D         0
11         11         D         0
12         12         D         0

   0 1
A  3 0
B  0 3
C  0 3
D  3 0</pre>
          </div>
        </div>

        <h2 id="verification">Verification and Documentation</h2>

        <p>
          Always verify your randomization worked correctly:
        </p>

        <ol>
          <li><strong>Check proportions:</strong> Are treatment groups the expected sizes?</li>
          <li><strong>Check balance:</strong> Are covariates balanced? (See <a href="05b4-balance-checks.html">next section</a>)</li>
          <li><strong>Document seed:</strong> Record the random seed for reproducibility</li>
          <li><strong>Save assignment:</strong> Export the treatment assignment file before launching</li>
        </ol>

        <div class="info-box warning">
          <div class="info-box-title">Critical: Document Everything</div>
          <p style="margin-bottom: 0;">
            Save your randomization script, the seed, and the treatment assignment file. In your pre-analysis plan, specify your randomization procedure exactly. You should be able to reproduce the exact same treatment assignment from the same seed.
          </p>
        </div>

        <div class="nav-footer">
          <a href="05b2-survey-programming.html" class="nav-link prev">5B.2: Survey Programming</a>
          <a href="05b4-balance-checks.html" class="nav-link next">5B.4: Balance Checks</a>
        </div>
      </div>
    </main>
  </div>

  <button class="mobile-menu-toggle" aria-label="Toggle navigation menu">Menu</button>
  <script src="../js/main.js"></script>
  <script src="../js/password-protection.js"></script>
</body>
</html>
