<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Module 5: Data Analysis | ProTools ER1</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Crimson+Pro:ital,wght@0,400;0,600;0,700;1,400&family=Fira+Code:wght@400;500&family=Source+Sans+Pro:ital,wght@0,400;0,600;0,700;1,400&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="../css/style.css">
  <style>
    .protected-content {
      -webkit-user-select: none;
      -moz-user-select: none;
      -ms-user-select: none;
      user-select: none;
    }
    /* Allow text selection on code blocks for copy-paste */
    .protected-content pre,
    .protected-content code,
    .protected-content .code-block,
    .protected-content .code-tabs {
      -webkit-user-select: text;
      -moz-user-select: text;
      -ms-user-select: text;
      user-select: text;
    }
    /* Interactive Exercise Styles */
    .interactive-exercise { background: white; border: 2px solid var(--color-border); border-radius: 12px; padding: 1.5rem; margin: 2rem 0; box-shadow: 0 2px 8px rgba(0,0,0,0.05); }
    .exercise-editor { margin: 1rem 0; }
    .editor-tabs { display: flex; gap: 0.5rem; margin-bottom: 0.5rem; }
    .lang-btn { padding: 0.4rem 1rem; border: 1px solid var(--color-border); background: white; border-radius: 20px; cursor: pointer; font-size: 0.85rem; transition: all 0.2s; }
    .lang-btn:hover { border-color: var(--color-primary); }
    .lang-btn.active { background: var(--color-primary); color: white; border-color: var(--color-primary); }
    .code-editor { width: 100%; min-height: 200px; padding: 1rem; font-family: var(--font-code); font-size: 0.9rem; border: none; border-radius: 8px; background: #1a202c; color: #e2e8f0; resize: vertical; line-height: 1.5; }
    .code-editor:focus { outline: 2px solid var(--color-accent); }
    .exercise-actions { display: flex; align-items: center; gap: 1rem; margin-top: 1rem; flex-wrap: wrap; }
    .btn-check-score, .btn-show-solution { padding: 0.75rem 1.5rem; border: none; border-radius: 6px; font-weight: 600; cursor: pointer; transition: all 0.2s; }
    .btn-check-score { background: var(--color-primary); color: white; }
    .btn-check-score:hover { background: var(--color-secondary); transform: translateY(-1px); }
    .btn-show-solution { background: var(--color-accent); color: white; }
    .btn-show-solution:hover { background: #c77a3a; }
    .score-display { display: flex; align-items: center; gap: 1rem; padding: 0.75rem 1rem; background: var(--color-bg-alt); border-radius: 8px; }
    .score-circle { display: flex; align-items: baseline; gap: 2px; }
    .score-value { font-size: 2rem; font-weight: 700; color: var(--color-primary); }
    .score-value.score-high { color: #38a169; }
    .score-value.score-medium { color: #d69e2e; }
    .score-value.score-low { color: #e53e3e; }
    .score-label { font-size: 1rem; color: #666; }
    .score-feedback { font-size: 0.9rem; color: #555; max-width: 300px; }
    .solution-steps { margin-top: 1.5rem; border: 1px solid var(--color-border); border-radius: 8px; overflow: hidden; }
    .solution-header { display: flex; justify-content: space-between; align-items: center; padding: 0.75rem 1rem; background: var(--color-bg-alt); border-bottom: 1px solid var(--color-border); }
    .solution-header h5 { margin: 0; color: var(--color-primary); }
    .step-counter { font-size: 0.85rem; color: #666; }
    .solution-step { padding: 1rem; border-bottom: 1px solid var(--color-border); animation: fadeIn 0.3s ease; }
    .solution-step:last-of-type { border-bottom: none; }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(-10px); } to { opacity: 1; transform: translateY(0); } }
    .step-description { font-weight: 600; color: var(--color-secondary); margin-bottom: 0.75rem; padding-left: 0.5rem; border-left: 3px solid var(--color-accent); }
    .step-code { margin: 0; background: #1e1e1e; border-radius: 6px; padding: 1rem; }
    .step-code code { color: #d4d4d4; }
    .solution-navigation { display: flex; justify-content: space-between; padding: 1rem; background: var(--color-bg-alt); }
    .btn-prev-step, .btn-next-step { padding: 0.5rem 1.25rem; border: 1px solid var(--color-border); background: white; border-radius: 6px; cursor: pointer; font-weight: 500; transition: all 0.2s; }
    .btn-prev-step:hover:not(:disabled), .btn-next-step:hover:not(:disabled) { background: var(--color-primary); color: white; border-color: var(--color-primary); }
    .btn-prev-step:disabled, .btn-next-step:disabled { opacity: 0.5; cursor: not-allowed; }
    /* Code tooltips - hover explanations (JavaScript-powered for boundary detection) */
    .code-tooltip {
      position: relative;
      cursor: help;
      border-bottom: 1px dotted #888;
      text-decoration: none;
    }

    /* Tooltip element created by JavaScript */
    .tooltip-popup {
      position: fixed;
      background: #1f2937;
      color: white;
      padding: 0.5rem 0.75rem;
      border-radius: 6px;
      font-size: 0.75rem;
      white-space: normal;
      max-width: 300px;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.15s ease-in-out;
      z-index: 10000;
      line-height: 1.4;
      text-align: left;
      font-family: var(--font-body);
      font-style: normal;
      box-shadow: 0 4px 12px rgba(0,0,0,0.3);
    }
    .tooltip-popup.visible {
      opacity: 1;
    }

    /* Small arrow pointer */
    .tooltip-popup::after {
      content: '';
      position: absolute;
      border: 6px solid transparent;
    }
    .tooltip-popup.arrow-bottom::after {
      top: 100%;
      left: 50%;
      transform: translateX(-50%);
      border-top-color: #1f2937;
    }
    .tooltip-popup.arrow-top::after {
      bottom: 100%;
      left: 50%;
      transform: translateX(-50%);
      border-bottom-color: #1f2937;
    }
    .tooltip-popup.arrow-left::after {
      top: 50%;
      right: 100%;
      transform: translateY(-50%);
      border-right-color: #1f2937;
    }
    .tooltip-popup.arrow-right::after {
      top: 50%;
      left: 100%;
      transform: translateY(-50%);
      border-left-color: #1f2937;
    }
  </style>
</head>
<body>
  <!-- Password Protection Overlay -->
    <div id="password-overlay" class="password-overlay">
    <div class="password-modal">
      <h2>ProTools ER1</h2>
      <p>Programming Tools for Empirical Research</p>

      <div class="course-description">
        <h3>Course Modules</h3>
        <ul class="module-list">
          <li><strong>Module 0:</strong> Languages & Platforms ‚Äî Python, Stata, R setup; IDEs (RStudio, VS Code, Jupyter)</li>
          <li><strong>Module 1:</strong> Getting Started ‚Äî Installation, basic syntax, packages</li>
          <li><strong>Module 2:</strong> Data Harnessing ‚Äî File import, APIs, web scraping</li>
          <li><strong>Module 3:</strong> Data Exploration ‚Äî Inspection, summary statistics, visualization</li>
          <li><strong>Module 4:</strong> Data Cleaning ‚Äî Data quality, transformation, validation</li>
          <li><strong>Module 5:</strong> Data Analysis ‚Äî Statistical analysis, simulation, experimental design</li>
          <li><strong>Module 6:</strong> Causal Inference ‚Äî Matching, DiD, RDD, IV, Synthetic Control</li>
          <li><strong>Module 7:</strong> Estimation Methods ‚Äî Standard errors, panel data, MLE/GMM</li>
          <li><strong>Module 8:</strong> Replicability ‚Äî Project organization, documentation, replication packages</li>
          <li><strong>Module 9:</strong> Git & GitHub ‚Äî Version control, collaboration, branching</li>
          <li><strong>Module 10:</strong> History of NLP ‚Äî From ELIZA to Transformers</li>
          <li><strong>Module 11:</strong> Machine Learning ‚Äî Prediction, regularization, neural networks</li>
          <li><strong>Module 12:</strong> Large Language Models ‚Äî How LLMs work, prompting, APIs</li>
        </ul>
      </div>

      <div class="access-note">
        This course is currently open to <strong>students at Sciences Po</strong>. If you are not a Sciences Po student but would like access, please <a href="mailto:giulia.caprini@sciencespo.fr">email me</a> to request an invite token.
      </div>

      <div class="password-form">
        <input type="password" id="password-input" placeholder="Enter password" autocomplete="off">
        <button id="password-submit">Access Course</button>
        <p id="password-error" style="color: #e53e3e; font-size: 0.85rem; margin-top: 1rem; display: none;">Incorrect password. Please try again.</p>
      </div>
    </div>
  </div>

  <div class="page-wrapper protected-content">
    <aside class="sidebar">
      <a href="../index.html" class="sidebar-logo">ProTools ER1</a>
      <span class="sidebar-subtitle">Programming Tools for Empirical Research</span>
      <nav>
        <ul>
          <li><a href="../index.html"><span class="welcome-icon">üè†</span> Welcome</a></li>
          <li class="has-subnav">
            <a href="00-languages-platforms.html"><span class="module-number">0</span> Languages & Platforms</a>
            <ul class="sub-nav">
              <li><a href="00a-rstudio-guide.html">RStudio Guide</a></li>
              <li><a href="00b-stata-guide.html">Stata Guide</a></li>
              <li><a href="00c-vscode-guide.html">VS Code Guide</a></li>
              <li><a href="00d-notebooks-guide.html">Notebooks Guide</a></li>
            </ul>
          </li>
          <li><a href="01-getting-started.html"><span class="module-number">1</span> Getting Started</a></li>
          <li class="has-subnav">
            <a href="02-data-harnessing.html"><span class="module-number">2</span> Data Harnessing</a>
            <ul class="sub-nav">
              <li><a href="02a-file-import.html">File Import</a></li>
              <li><a href="02b-apis.html">APIs</a></li>
              <li><a href="02c-web-scraping.html">Web Scraping</a></li>
            </ul>
          </li>
          <li><a href="03-data-exploration.html"><span class="module-number">3</span> Data Exploration</a></li>
          <li><a href="04-data-cleaning.html"><span class="module-number">4</span> Data Cleaning</a></li>
          <li class="has-subnav active">
            <a href="05-data-analysis.html"><span class="module-number">5</span> Data Analysis</a>
            <ul class="sub-nav">
              <li><a href="05a-data-simulation.html">Data Simulation</a></li>
            </ul>
          </li>
          <li class="has-subnav">
            <a href="06-causal-inference.html"><span class="module-number">6</span> Causal Inference</a>
            <ul class="sub-nav">
              <li><a href="06a-matching.html">Matching</a></li>
              <li><a href="06b-did.html">Difference-in-Differences</a></li>
              <li><a href="06c-rdd.html">Regression Discontinuity</a></li>
              <li><a href="06d-iv.html">Instrumental Variables</a></li>
              <li><a href="06e-synthetic-control.html">Synthetic Control</a></li>
              <li><a href="05b-experiments.html">Experiments</a></li>
            </ul>
          </li>
          <li><a href="07-estimation.html"><span class="module-number">7</span> Estimation Methods</a></li>
          <li><a href="08-replicability.html"><span class="module-number">8</span> Replicability</a></li>
          <li><a href="09-github.html"><span class="module-number">9</span> Git & GitHub</a></li>
          <li><a href="10-nlp-history.html"><span class="module-number">10</span> History of NLP</a></li>
          <li class="has-subnav">
            <a href="11-machine-learning.html"><span class="module-number">11</span> Machine Learning</a>
            <ul class="sub-nav">
              <li><a href="11a-regularization.html">Regularization</a></li>
              <li><a href="11b-trees.html">Tree-Based Methods</a></li>
              <li><a href="11c-neural-networks.html">Neural Networks</a></li>
              <li><a href="11d-causal-ml.html">Causal ML</a></li>
              <li><a href="11e-model-evaluation.html">Model Evaluation</a></li>
            </ul>
          </li>          <li><a href="12-llms.html"><span class="module-number">12</span> Large Language Models</a></li>
          <li><a href="../resources.html">Resources</a></li>
          <li><a href="contact.html">Contact & Feedback</a></li>
        </ul>
      </nav>
    </aside>

    <main class="main-content">
      <div class="content">
        <div class="module-header">
          <h1>5 &nbsp;Data Analysis & Visualization</h1>
          <div class="module-meta">
            <span>~8 hours</span>
            <span>EDA, Statistics, Plots</span>
            <span>Intermediate</span>
          </div>
        </div>

        <div class="learning-objectives">
          <h3>Learning Objectives</h3>
          <ul>
            <li>Organize research projects with clear script naming conventions</li>
            <li>Create and maintain README files for reproducibility</li>
            <li>Compute and interpret descriptive statistics</li>
            <li>Create publication-quality visualizations</li>
            <li>Run and interpret regression analyses</li>
            <li>Generate summary tables for papers</li>
          </ul>
        </div>

        <div class="toc">
          <h3>Table of Contents</h3>
          <ul>
            <li><a href="#project-organization">5.1 Project Organization</a></li>
            <li><a href="#readme-files">5.2 README Files</a></li>
            <li><a href="#descriptive-stats">5.3 Descriptive Statistics</a></li>
            <li><a href="#visualization">5.4 Data Visualization</a></li>
            <li><a href="#correlation">5.5 Correlation Analysis</a></li>
            <li><a href="#regression">5.6 Basic Regression Analysis</a></li>
            <li><a href="#summary-tables">5.7 Summary Tables for Papers</a></li>
            <li><a href="#exercises">5.8 Exercises</a></li>
          </ul>
        </div>

        <!-- ============================================ -->
        <!-- SECTION 5.1: PROJECT ORGANIZATION            -->
        <!-- ============================================ -->
        <h2 id="project-organization">5.1 Project Organization</h2>

        <p>
          Before diving into analysis, establishing a clear project structure is essential. A well-organized project allows you (and others) to understand what each script does and the order in which to run them. This becomes critical as projects grow in complexity and when sharing code for replication.
        </p>

        <h3>Script Naming Conventions</h3>

        <p>
          Script names should reveal <strong>what they do</strong> and the <strong>order to run them</strong>. The most effective approach uses numbered prefixes combined with descriptive names:
        </p>

        <div class="info-box tip">
          <div class="info-box-title">Naming Pattern</div>
          <p style="margin-bottom: 0;">
            <code>##_action_description.ext</code><br>
            where <code>##</code> is a two-digit number (01, 02, 03...) indicating execution order.
          </p>
        </div>

        <h4>Example Project Structure</h4>

        <pre style="background: #1a202c; color: #e2e8f0; padding: 1rem; border-radius: 8px; overflow-x: auto;"><code>project/
‚îú‚îÄ‚îÄ <span style="color: #90cdf4;">data/</span>
‚îÇ   ‚îú‚îÄ‚îÄ raw/                    <span style="color: #68d391;"># Original, untouched data</span>
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ census_2020.csv
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ survey_responses.xlsx
‚îÇ   ‚îú‚îÄ‚îÄ processed/              <span style="color: #68d391;"># Cleaned, analysis-ready data</span>
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ analysis_sample.csv
‚îÇ   ‚îî‚îÄ‚îÄ temp/                   <span style="color: #68d391;"># Intermediate files</span>
‚îÇ
‚îú‚îÄ‚îÄ <span style="color: #90cdf4;">code/</span>
‚îÇ   ‚îú‚îÄ‚îÄ <span style="color: #f6ad55;">01_import_data.py</span>          <span style="color: #68d391;"># Load raw data</span>
‚îÇ   ‚îú‚îÄ‚îÄ <span style="color: #f6ad55;">02_clean_data.py</span>          <span style="color: #68d391;"># Handle missing values, outliers</span>
‚îÇ   ‚îú‚îÄ‚îÄ <span style="color: #f6ad55;">03_merge_datasets.py</span>      <span style="color: #68d391;"># Combine data sources</span>
‚îÇ   ‚îú‚îÄ‚îÄ <span style="color: #f6ad55;">04_create_variables.py</span>    <span style="color: #68d391;"># Generate analysis variables</span>
‚îÇ   ‚îú‚îÄ‚îÄ <span style="color: #f6ad55;">05_descriptive_stats.py</span>   <span style="color: #68d391;"># Summary statistics, EDA</span>
‚îÇ   ‚îú‚îÄ‚îÄ <span style="color: #f6ad55;">06_regression_analysis.py</span> <span style="color: #68d391;"># Main estimation</span>
‚îÇ   ‚îú‚îÄ‚îÄ <span style="color: #f6ad55;">07_robustness_checks.py</span>   <span style="color: #68d391;"># Sensitivity analyses</span>
‚îÇ   ‚îî‚îÄ‚îÄ <span style="color: #f6ad55;">08_create_figures.py</span>     <span style="color: #68d391;"># Publication plots</span>
‚îÇ
‚îú‚îÄ‚îÄ <span style="color: #90cdf4;">output/</span>
‚îÇ   ‚îú‚îÄ‚îÄ tables/
‚îÇ   ‚îî‚îÄ‚îÄ figures/
‚îÇ
‚îî‚îÄ‚îÄ <span style="color: #fc8181;">README.md</span>                    <span style="color: #68d391;"># Project documentation</span></code></pre>

        <h4>Naming Best Practices</h4>

        <table>
          <thead>
            <tr>
              <th>Practice</th>
              <th>Good</th>
              <th>Avoid</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>Use numbers for order</td>
              <td><code>01_import.py</code></td>
              <td><code>import.py</code></td>
            </tr>
            <tr>
              <td>Be descriptive</td>
              <td><code>03_clean_income_vars.do</code></td>
              <td><code>03_clean.do</code></td>
            </tr>
            <tr>
              <td>Use underscores</td>
              <td><code>05_merge_datasets.R</code></td>
              <td><code>05 merge datasets.R</code></td>
            </tr>
            <tr>
              <td>Lowercase</td>
              <td><code>02_data_prep.py</code></td>
              <td><code>02_Data_Prep.py</code></td>
            </tr>
            <tr>
              <td>Skip numbers for flexibility</td>
              <td><code>01, 02, 05, 10</code></td>
              <td><code>1, 2, 3, 4</code></td>
            </tr>
          </tbody>
        </table>

        <div class="info-box warning">
          <div class="info-box-title">Why Skip Numbers?</div>
          <p style="margin-bottom: 0;">
            Leave gaps in your numbering (01, 02, 05, 10...) so you can insert new scripts without renaming everything. If you later need a script between <code>02_clean.py</code> and <code>05_merge.py</code>, you can create <code>03_validate.py</code> without disrupting the sequence.
          </p>
        </div>

        <h4>Language-Specific Conventions</h4>

        <div class="code-tabs" data-runnable="analysis-1">
          <div class="tab-buttons">
            <button class="tab-button active" data-lang="python">Python</button>
            <button class="tab-button" data-lang="stata">Stata</button>
            <button class="tab-button" data-lang="r">R</button>
          </div>
          <div class="tab-content active" data-lang="python">
<pre><code><span class="code-comment"># Python: Typical project structure</span>
<span class="code-comment"># code/</span>
<span class="code-comment">#   01_import_data.py</span>
<span class="code-comment">#   02_clean_data.py</span>
<span class="code-comment">#   03_analysis.py</span>
<span class="code-comment">#   utils/               # Helper functions</span>
<span class="code-comment">#     __init__.py</span>
<span class="code-comment">#     data_helpers.py</span>
<span class="code-comment">#   config.py            # Settings, paths</span>

<span class="code-comment"># In config.py:</span>
<span class="code-keyword">from</span> pathlib <span class="code-keyword">import</span> Path

<span class="code-tooltip" data-tip="Path(__file__).parent.parent resolves to the project root by going up two directories from the config file">PROJECT_ROOT</span> = Path(__file__).parent.parent
DATA_RAW = PROJECT_ROOT / <span class="code-string">"data"</span> / <span class="code-string">"raw"</span>
DATA_PROCESSED = PROJECT_ROOT / <span class="code-string">"data"</span> / <span class="code-string">"processed"</span>
OUTPUT = PROJECT_ROOT / <span class="code-string">"output"</span></code></pre>
            <button class="run-btn" data-lang="python">Run Code</button>
          </div>
          <div class="tab-content" data-lang="stata">
<pre><code><span class="code-comment">* Stata: Master do-file pattern</span>
<span class="code-comment">* Create a 00_master.do that runs everything</span>

<span class="code-comment">* ============================================</span>
<span class="code-comment">* 00_master.do - Run entire analysis pipeline</span>
<span class="code-comment">* ============================================</span>

<span class="code-tooltip" data-tip="Set the global macro PROJECT to your project folder - all other paths are relative to this">global PROJECT</span> <span class="code-string">"/Users/researcher/my_project"</span>
<span class="code-tooltip" data-tip="Define paths as globals so all scripts can access them consistently">global CODE</span>    <span class="code-string">"$PROJECT/code"</span>
global DATA    <span class="code-string">"$PROJECT/data"</span>
global OUTPUT  <span class="code-string">"$PROJECT/output"</span>

<span class="code-comment">* Run scripts in order</span>
<span class="code-tooltip" data-tip="The 'do' command executes another do-file. Running them from a master file ensures correct execution order">do</span> <span class="code-string">"$CODE/01_import_data.do"</span>
do <span class="code-string">"$CODE/02_clean_data.do"</span>
do <span class="code-string">"$CODE/03_merge_datasets.do"</span>
do <span class="code-string">"$CODE/04_analysis.do"</span>
do <span class="code-string">"$CODE/05_create_tables.do"</span></code></pre>
            <button class="run-btn" data-lang="stata">Run Code</button>
          </div>
          <div class="tab-content" data-lang="r">
<pre><code><span class="code-comment"># R: Typical project structure</span>
<span class="code-comment"># Using here() package for portable paths</span>

<span class="code-comment"># code/</span>
<span class="code-comment">#   00_main.R            # Master script</span>
<span class="code-comment">#   01_load_data.R</span>
<span class="code-comment">#   02_clean_data.R</span>
<span class="code-comment">#   03_analysis.R</span>
<span class="code-comment">#   R/                   # Reusable functions</span>
<span class="code-comment">#     utils.R</span>

<span class="code-comment"># In 00_main.R:</span>
<span class="code-tooltip" data-tip="The here package finds your project root automatically, making paths work across different computers">library(here)</span>

<span class="code-comment"># Source all scripts in order</span>
<span class="code-tooltip" data-tip="source() runs an R script. here() constructs the path relative to project root">source(here(<span class="code-string">"code"</span>, <span class="code-string">"01_load_data.R"</span>))</span>
source(here(<span class="code-string">"code"</span>, <span class="code-string">"02_clean_data.R"</span>))
source(here(<span class="code-string">"code"</span>, <span class="code-string">"03_analysis.R"</span>))</code></pre>
            <button class="run-btn" data-lang="r">Run Code</button>
          </div>
        </div>

        <div class="output-simulation" data-output="analysis-1" data-lang="python">
          <div class="output-header">
            <span>Python Output</span>
            <button class="close-output">&times;</button>
          </div>
          <div class="output-body"><span style="color: #68d391;">Project paths configured successfully:</span>
PROJECT_ROOT: /Users/researcher/my_project
DATA_RAW:     /Users/researcher/my_project/data/raw
DATA_PROCESSED: /Users/researcher/my_project/data/processed
OUTPUT:       /Users/researcher/my_project/output</div>
        </div>
        <div class="output-simulation" data-output="analysis-1" data-lang="stata">
          <div class="output-header">
            <span>Stata Output</span>
            <button class="close-output">&times;</button>
          </div>
          <div class="output-body">. global PROJECT "/Users/researcher/my_project"
. global CODE    "$PROJECT/code"
. global DATA    "$PROJECT/data"
. global OUTPUT  "$PROJECT/output"

. do "$CODE/01_import_data.do"
<span style="color: #68d391;">running 01_import_data.do ...</span>

. do "$CODE/02_clean_data.do"
<span style="color: #68d391;">running 02_clean_data.do ...</span>

. do "$CODE/03_merge_datasets.do"
<span style="color: #68d391;">running 03_merge_datasets.do ...</span>

. do "$CODE/04_analysis.do"
<span style="color: #68d391;">running 04_analysis.do ...</span>

. do "$CODE/05_create_tables.do"
<span style="color: #68d391;">running 05_create_tables.do ...</span>

<span style="color: #68d391;">All scripts completed successfully.</span></div>
        </div>
        <div class="output-simulation" data-output="analysis-1" data-lang="r">
          <div class="output-header">
            <span>R Output</span>
            <button class="close-output">&times;</button>
          </div>
          <div class="output-body">&gt; library(here)
<span style="color: #68d391;">here() starts at /Users/researcher/my_project</span>

&gt; source(here("code", "01_load_data.R"))
<span style="color: #68d391;">Sourcing 01_load_data.R...</span>

&gt; source(here("code", "02_clean_data.R"))
<span style="color: #68d391;">Sourcing 02_clean_data.R...</span>

&gt; source(here("code", "03_analysis.R"))
<span style="color: #68d391;">Sourcing 03_analysis.R...</span>

<span style="color: #68d391;">All scripts executed successfully.</span></div>
        </div>

        <!-- ============================================ -->
        <!-- SECTION 5.2: README FILES                    -->
        <!-- ============================================ -->
        <h2 id="readme-files">5.2 README Files</h2>

        <p>
          A <strong>README</strong> file is the front door to your project. It tells collaborators (including your future self) what the project does, how to run it, and what to expect. Every research project should have one.
        </p>

        <div class="info-box note">
          <div class="info-box-title">Deep Dive in Module 8</div>
          <p style="margin-bottom: 0;">
            This section introduces README basics. For comprehensive documentation practices, including data dictionaries, codebooks, and replication packages, see <a href="08-replicability.html">Module 8: Replicability</a>.
          </p>
        </div>

        <h3>Essential README Elements</h3>

        <p>
          At minimum, your README should answer these questions:
        </p>

        <ol>
          <li><strong>What is this project?</strong> - Brief description of the research question</li>
          <li><strong>How do I run it?</strong> - Step-by-step instructions to reproduce results</li>
          <li><strong>What do I need?</strong> - Software requirements, data sources</li>
          <li><strong>What does each file do?</strong> - Description of key scripts</li>
        </ol>

        <h3>README Template</h3>

        <pre style="background: #1a202c; color: #e2e8f0; padding: 1rem; border-radius: 8px; overflow-x: auto;"><code><span style="color: #f6ad55;"># Project Title</span>

Brief description of your research project and main findings.

<span style="color: #f6ad55;">## Data</span>

- <span style="color: #90cdf4;">**Source:**</span> Describe where data comes from
- <span style="color: #90cdf4;">**Access:**</span> How to obtain the data (public/restricted)
- <span style="color: #90cdf4;">**Files:**</span> List main data files

<span style="color: #f6ad55;">## Requirements</span>

<span style="color: #68d391;">### Software</span>
- Python 3.9+ with packages in `requirements.txt`
- Stata 17 (for some analyses)
- R 4.2+ with packages in `renv.lock`

<span style="color: #68d391;">### Installation</span>
```bash
pip install -r requirements.txt
```

<span style="color: #f6ad55;">## How to Replicate</span>

1. Clone this repository
2. Download data from [source] and place in `data/raw/`
3. Run scripts in order:
   - `01_import_data.py` - Load and validate raw data
   - `02_clean_data.py` - Handle missing values, create variables
   - `03_analysis.py` - Main regression analysis
   - `04_figures.py` - Generate all figures

Or run everything with:
```bash
python 00_main.py
```

<span style="color: #f6ad55;">## File Structure</span>

```
‚îú‚îÄ‚îÄ code/          # Analysis scripts
‚îú‚îÄ‚îÄ data/          # Data files (not tracked in git)
‚îú‚îÄ‚îÄ output/        # Tables and figures
‚îî‚îÄ‚îÄ README.md      # This file
```

<span style="color: #f6ad55;">## Authors</span>

Your Name (your.email@university.edu)

<span style="color: #f6ad55;">## License</span>

MIT License (or appropriate license)</code></pre>

        <h3>README for Different Audiences</h3>

        <table>
          <thead>
            <tr>
              <th>Audience</th>
              <th>Key Information</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td><strong>Replicator</strong></td>
              <td>Exact steps to reproduce results, software versions, data access</td>
            </tr>
            <tr>
              <td><strong>Collaborator</strong></td>
              <td>Code organization, where to add new analyses, coding conventions</td>
            </tr>
            <tr>
              <td><strong>Future You</strong></td>
              <td>What you were thinking, why certain decisions were made</td>
            </tr>
            <tr>
              <td><strong>Reviewer/Editor</strong></td>
              <td>What data is included, what is sensitive, how results map to paper</td>
            </tr>
          </tbody>
        </table>

        <!-- ============================================ -->
        <!-- SECTION 5.3: DESCRIPTIVE STATISTICS          -->
        <!-- ============================================ -->
        <h2 id="descriptive-stats">5.3 Descriptive Statistics</h2>

        <p>
          Before computing statistics, let's load a dataset to work with throughout this module. We'll use the <strong>NLSW88</strong> dataset &mdash; a real open-source economics dataset from the National Longitudinal Survey of Young Women (1988) with labor market data for 2,246 women.
        </p>

        <div class="code-tabs" data-runnable="setup-data-05">
          <div class="tab-buttons">
            <button class="tab-button active" data-lang="python">Python</button>
            <button class="tab-button" data-lang="stata">Stata</button>
            <button class="tab-button" data-lang="r">R</button>
          </div>
          <div class="tab-content active" data-lang="python">
<pre><code><span class="code-keyword">import</span> pandas <span class="code-keyword">as</span> pd
<span class="code-keyword">import</span> numpy <span class="code-keyword">as</span> np

<span class="code-comment"># Load the NLSW88 dataset (National Longitudinal Survey of Young Women, 1988)</span>
df = pd.read_stata(<span class="code-string">'https://www.stata-press.com/data/r18/nlsw88.dta'</span>)

<span class="code-comment"># Rename columns to match this module's examples</span>
df = df.rename(columns={<span class="code-string">'wage'</span>: <span class="code-string">'income'</span>, <span class="code-string">'grade'</span>: <span class="code-string">'education'</span>,
                        <span class="code-string">'ttl_exp'</span>: <span class="code-string">'experience'</span>})
<span class="code-keyword">print</span>(<span class="code-string">f"Loaded {len(df)} observations and {len(df.columns)} variables"</span>)
<span class="code-keyword">print</span>(df.head())</code></pre>
            <button class="run-btn" data-lang="python">Run Code</button>
          </div>
          <div class="tab-content" data-lang="stata">
<pre><code><span class="code-comment">* Load the NLSW88 dataset (National Longitudinal Survey of Young Women, 1988)</span>
<span class="code-keyword">webuse</span> nlsw88, clear

<span class="code-comment">* Rename variables to match this module's examples</span>
<span class="code-keyword">rename</span> wage income
<span class="code-keyword">rename</span> grade education
<span class="code-keyword">rename</span> ttl_exp experience
<span class="code-keyword">describe</span>, short</code></pre>
            <button class="run-btn" data-lang="stata">Run Code</button>
          </div>
          <div class="tab-content" data-lang="r">
<pre><code><span class="code-comment"># Load the NLSW88 dataset (National Longitudinal Survey of Young Women, 1988)</span>
<span class="code-function">library</span>(tidyverse)
df &lt;- haven::read_dta(<span class="code-string">"https://www.stata-press.com/data/r18/nlsw88.dta"</span>)

<span class="code-comment"># Rename columns to match this module's examples</span>
df &lt;- df %&gt;% rename(income = wage, education = grade,
                    experience = ttl_exp)
<span class="code-function">cat</span>(<span class="code-string">"Loaded"</span>, nrow(df), <span class="code-string">"observations and"</span>, ncol(df), <span class="code-string">"variables\n"</span>)
<span class="code-function">head</span>(df)</code></pre>
            <button class="run-btn" data-lang="r">Run Code</button>
          </div>
        </div>

        <div class="code-tabs" data-runnable="analysis-2">
          <div class="tab-buttons">
            <button class="tab-button active" data-lang="python">Python</button>
            <button class="tab-button" data-lang="stata">Stata</button>
            <button class="tab-button" data-lang="r">R</button>
          </div>
          <div class="tab-content active" data-lang="python">
<pre><code><span class="code-comment"># Python: Descriptive statistics</span>
<span class="code-keyword">import</span> <span class="code-tooltip" data-tip="pandas is a data analysis library that provides DataFrame structures for organizing and manipulating tabular data">pandas</span> <span class="code-keyword">as</span> pd

<span class="code-tooltip" data-tip="df is your DataFrame (data table). describe() automatically calculates count, mean, std, min, 25%, 50%, 75%, and max for all numeric columns">df.describe()</span>                          <span class="code-comment"># Summary stats</span>
<span class="code-tooltip" data-tip="Calculates the arithmetic average of the income column - sum of all values divided by the number of observations">df[<span class="code-string">'income'</span>].mean()</span>                   <span class="code-comment"># Mean</span>
<span class="code-tooltip" data-tip="Returns the middle value when data is sorted. Unlike mean, median is robust to outliers - useful for skewed income distributions">df[<span class="code-string">'income'</span>].median()</span>                 <span class="code-comment"># Median</span>
<span class="code-tooltip" data-tip="Standard deviation measures how spread out values are from the mean. Higher std means more variability in income">df[<span class="code-string">'income'</span>].std()</span>                    <span class="code-comment"># Standard deviation</span>
<span class="code-tooltip" data-tip="Returns the 25th and 75th percentiles (quartiles). 25% of observations fall below Q1, and 75% fall below Q3. The difference (IQR) measures spread">df[<span class="code-string">'income'</span>].quantile([<span class="code-number">0.25</span>, <span class="code-number">0.75</span>])</span>  <span class="code-comment"># Percentiles</span>

<span class="code-comment"># By group</span>
<span class="code-tooltip" data-tip="Groups data by education level, then calculates mean income for each group - essential for comparing outcomes across categories">df.groupby(<span class="code-string">'education'</span>)[<span class="code-string">'income'</span>].mean()</span></code></pre>
            <button class="run-btn" data-lang="python">Run Code</button>
          </div>
          <div class="tab-content" data-lang="stata">
<pre><code><span class="code-comment">* Stata: Descriptive statistics</span>
<span class="code-tooltip" data-tip="Basic summary: shows number of observations, mean, standard deviation, and min/max values for the income variable">summarize income</span>
<span class="code-tooltip" data-tip="Detailed summary: adds percentiles (1, 5, 10, 25, 50, 75, 90, 95, 99), skewness (asymmetry), and kurtosis (tail heaviness) to basic stats">summarize income, detail</span>
<span class="code-tooltip" data-tip="Creates a table showing mean, standard deviation, and count (n) of income for each education level - great for group comparisons">tabstat income, by(education) stat(mean sd n)</span></code></pre>
            <button class="run-btn" data-lang="stata">Run Code</button>
          </div>
          <div class="tab-content" data-lang="r">
<pre><code><span class="code-comment"># R: Descriptive statistics</span>
<span class="code-tooltip" data-tip="Provides a quick overview: minimum, 1st quartile (25%), median (50%), mean, 3rd quartile (75%), and maximum values">summary(df$income)</span>
<span class="code-tooltip" data-tip="Calculates the arithmetic average. na.rm = TRUE tells R to ignore missing values (NA) - without this, any NA would make the result NA">mean(df$income, na.rm = TRUE)</span>
<span class="code-tooltip" data-tip="Standard deviation measures spread around the mean. na.rm = TRUE excludes missing values from the calculation">sd(df$income, na.rm = TRUE)</span>

<span class="code-comment"># By group with dplyr</span>
<span class="code-tooltip" data-tip="The pipe (%>%) passes data through steps: first group by education, then calculate mean income for each group. Creates a summary table">df %>% group_by(education) %>% summarize(mean_inc = mean(income))</span></code></pre>
            <button class="run-btn" data-lang="r">Run Code</button>
          </div>
        </div>

        <div class="output-simulation" data-output="analysis-2" data-lang="python">
          <div class="output-header">
            <span>Python Output</span>
            <button class="close-output">&times;</button>
          </div>
          <div class="output-body">&gt;&gt;&gt; df.describe()
              income    education        age
count    1000.000000  1000.000000  1000.000000
mean    52847.632000    14.230000    42.150000
std     18234.510000     2.890000    12.340000
min     18500.000000     8.000000    22.000000
25%     38250.000000    12.000000    32.000000
50%     51200.000000    14.000000    41.000000
75%     65800.000000    16.000000    52.000000
max    125000.000000    21.000000    65.000000

&gt;&gt;&gt; df['income'].mean()
52847.632

&gt;&gt;&gt; df['income'].median()
51200.0

&gt;&gt;&gt; df['income'].std()
18234.51

&gt;&gt;&gt; df['income'].quantile([0.25, 0.75])
0.25    38250.0
0.75    65800.0
Name: income, dtype: float64

&gt;&gt;&gt; df.groupby('education')['income'].mean()
education
High School     35420.50
Bachelor's      52180.25
Master's        68450.80
PhD             89230.15
Name: income, dtype: float64</div>
        </div>
        <div class="output-simulation" data-output="analysis-2" data-lang="stata">
          <div class="output-header">
            <span>Stata Output</span>
            <button class="close-output">&times;</button>
          </div>
          <div class="output-body">. summarize income

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
      income |      1,000    52847.63    18234.51      18500     125000

. summarize income, detail

                           income
-------------------------------------------------------------
      Percentiles      Smallest
 1%        22150          18500
 5%        28420          19200
10%        31850          20100       Obs               1,000
25%        38250          21500       Sum of wgt.       1,000

50%        51200                      Mean           52847.63
                        Largest       Std. dev.      18234.51
75%        65800         112000
90%        78500         118500       Variance       3.32e+08
95%        89200         122000       Skewness       .4521832
99%       105000         125000       Kurtosis       2.847123

. tabstat income, by(education) stat(mean sd n)

Summary for variables: income
Group variable: education

   education |      Mean        SD         N
-------------+------------------------------
High School  |  35420.50   8234.12       250
 Bachelor's  |  52180.25  12456.80       400
   Master's  |  68450.80  15678.30       250
        PhD  |  89230.15  18920.45       100
-------------+------------------------------
       Total |  52847.63  18234.51      1000
------------------------------------------------</div>
        </div>
        <div class="output-simulation" data-output="analysis-2" data-lang="r">
          <div class="output-header">
            <span>R Output</span>
            <button class="close-output">&times;</button>
          </div>
          <div class="output-body">&gt; summary(df$income)
   Min. 1st Qu.  Median    Mean 3rd Qu.    Max.
  18500   38250   51200   52848   65800  125000

&gt; mean(df$income, na.rm = TRUE)
[1] 52847.63

&gt; sd(df$income, na.rm = TRUE)
[1] 18234.51

&gt; df %>% group_by(education) %>% summarize(mean_inc = mean(income))
# A tibble: 4 x 2
  education   mean_inc
  &lt;chr&gt;          &lt;dbl&gt;
1 High School   35421.
2 Bachelor's    52180.
3 Master's      68451.
4 PhD           89230.</div>
        </div>

        <h2 id="visualization">5.4 Data Visualization</h2>

        <h3>Histograms</h3>
        <div class="code-tabs" data-runnable="analysis-3">
          <div class="tab-buttons">
            <button class="tab-button active" data-lang="python">Python</button>
            <button class="tab-button" data-lang="stata">Stata</button>
            <button class="tab-button" data-lang="r">R</button>
          </div>
          <div class="tab-content active" data-lang="python">
<pre><code><span class="code-comment"># Python: Histogram</span>
<span class="code-keyword">import</span> <span class="code-tooltip" data-tip="matplotlib.pyplot is the main plotting library in Python. The 'plt' alias is a convention that makes code shorter and easier to read">matplotlib.pyplot</span> <span class="code-keyword">as</span> plt

<span class="code-tooltip" data-tip="Creates a histogram showing how income values are distributed. bins=30 divides the range into 30 bars. Useful for spotting skewness, outliers, and the shape of your data">plt.hist(df[<span class="code-string">'income'</span>], bins=<span class="code-number">30</span>, edgecolor=<span class="code-string">'white'</span>)</span>
<span class="code-tooltip" data-tip="Labels the horizontal axis. Clear axis labels are essential for publication-quality figures">plt.xlabel(<span class="code-string">'Income'</span>)</span>
<span class="code-tooltip" data-tip="Labels the vertical axis. Frequency shows how many observations fall in each bin (income range)">plt.ylabel(<span class="code-string">'Frequency'</span>)</span>
<span class="code-tooltip" data-tip="Adds a descriptive title above the plot. Good titles explain what the visualization shows">plt.title(<span class="code-string">'Distribution of Income'</span>)</span>
<span class="code-tooltip" data-tip="Saves the figure as a PNG image file. You can also use .pdf or .svg for higher quality in publications">plt.savefig(<span class="code-string">'histogram.png'</span>)</span></code></pre>
            <button class="run-btn" data-lang="python">Run Code</button>
          </div>
          <div class="tab-content" data-lang="stata">
<pre><code><span class="code-comment">* Stata: Histogram</span>
<span class="code-tooltip" data-tip="Creates a histogram of income. 'frequency' shows counts (how many observations in each bar). The /// allows the command to continue on the next line">histogram income, frequency ///
    title(<span class="code-string">"Distribution of Income"</span>)</span>
<span class="code-tooltip" data-tip="Exports the current graph to a PNG file. 'replace' overwrites any existing file with the same name">graph export <span class="code-string">"histogram.png"</span>, replace</span></code></pre>
            <button class="run-btn" data-lang="stata">Run Code</button>
          </div>
          <div class="tab-content" data-lang="r">
<pre><code><span class="code-comment"># R: Histogram with ggplot2</span>
<span class="code-tooltip" data-tip="ggplot2 builds plots in layers. ggplot() sets up the canvas with your data, aes() defines which variables to plot. The + adds more layers">ggplot(df, aes(x = income)) +</span>
  <span class="code-tooltip" data-tip="Adds the histogram layer. bins=30 creates 30 bars, fill sets the color. More bins show more detail but may look noisy">geom_histogram(bins = <span class="code-number">30</span>, fill = <span class="code-string">"steelblue"</span>) +</span>
  <span class="code-tooltip" data-tip="labs() adds labels and titles to your plot. You can also add subtitle, caption, and axis labels here">labs(title = <span class="code-string">"Distribution of Income"</span>)</span>
<span class="code-tooltip" data-tip="Saves the most recent plot to a file. Automatically detects format from extension (.png, .pdf, .svg). Great for reproducible research">ggsave(<span class="code-string">"histogram.png"</span>)</span></code></pre>
            <button class="run-btn" data-lang="r">Run Code</button>
          </div>
        </div>

        <div class="output-simulation" data-output="analysis-3" data-lang="python">
          <div class="output-header">
            <span>Python Output</span>
            <button class="close-output">&times;</button>
          </div>
          <div class="output-body"><span style="color: #68d391;">[Histogram plot displayed]</span>

Distribution of Income
<span style="color: #90cdf4;">
     80 |          ‚ñà‚ñà
        |         ‚ñà‚ñà‚ñà‚ñà
     60 |        ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà
        |       ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà
     40 |      ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà
        |     ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà
     20 |   ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà
        |  ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà
      0 +---------------------------
        20k   40k   60k   80k  100k
                 Income
</span>
<span style="color: #68d391;">Figure saved to 'histogram.png'</span></div>
        </div>
        <div class="output-simulation" data-output="analysis-3" data-lang="stata">
          <div class="output-header">
            <span>Stata Output</span>
            <button class="close-output">&times;</button>
          </div>
          <div class="output-body">. histogram income, frequency title("Distribution of Income")
(bin=30, start=18500, width=3550)

<span style="color: #90cdf4;">
     80 |          ‚ñà‚ñà
        |         ‚ñà‚ñà‚ñà‚ñà
     60 |        ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà
        |       ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà
     40 |      ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà
        |     ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà
     20 |   ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà
        |  ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà
      0 +---------------------------
        20k   40k   60k   80k  100k
                 Income
</span>
. graph export "histogram.png", replace
<span style="color: #68d391;">(file histogram.png written in PNG format)</span></div>
        </div>
        <div class="output-simulation" data-output="analysis-3" data-lang="r">
          <div class="output-header">
            <span>R Output</span>
            <button class="close-output">&times;</button>
          </div>
          <div class="output-body">&gt; ggplot(df, aes(x = income)) +
+   geom_histogram(bins = 30, fill = "steelblue") +
+   labs(title = "Distribution of Income")

<span style="color: #90cdf4;">
     80 |          ‚ñà‚ñà
        |         ‚ñà‚ñà‚ñà‚ñà
     60 |        ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà
        |       ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà
     40 |      ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà
        |     ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà
     20 |   ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà
        |  ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà
      0 +---------------------------
        20k   40k   60k   80k  100k
                 Income
</span>
&gt; ggsave("histogram.png")
<span style="color: #68d391;">Saving 7 x 5 in image</span></div>
        </div>

        <h3>Scatter Plots</h3>
        <div class="code-tabs" data-runnable="analysis-4">
          <div class="tab-buttons">
            <button class="tab-button active" data-lang="python">Python</button>
            <button class="tab-button" data-lang="stata">Stata</button>
            <button class="tab-button" data-lang="r">R</button>
          </div>
          <div class="tab-content active" data-lang="python">
<pre><code><span class="code-comment"># Python: Scatter plot</span>
<span class="code-keyword">import</span> <span class="code-tooltip" data-tip="seaborn is a statistical visualization library built on matplotlib. It makes attractive plots with less code and integrates well with pandas DataFrames">seaborn</span> <span class="code-keyword">as</span> sns

<span class="code-tooltip" data-tip="Creates a scatter plot showing relationship between GDP per capita (x-axis) and life expectancy (y-axis). hue colors points by continent to reveal patterns across groups">sns.scatterplot(data=df, x=<span class="code-string">'gdpPercap'</span>, y=<span class="code-string">'lifeExp'</span>, hue=<span class="code-string">'continent'</span>)</span>
<span class="code-tooltip" data-tip="Transforms x-axis to logarithmic scale. Useful when data spans several orders of magnitude (like income or GDP) to spread out clustered points">plt.xscale(<span class="code-string">'log'</span>)</span>
<span class="code-tooltip" data-tip="Saves the scatter plot to a PNG file for use in papers or presentations">plt.savefig(<span class="code-string">'scatter.png'</span>)</span></code></pre>
            <button class="run-btn" data-lang="python">Run Code</button>
          </div>
          <div class="tab-content" data-lang="stata">
<pre><code><span class="code-comment">* Stata: Scatter plot</span>
<span class="code-tooltip" data-tip="twoway creates 2D plots. scatter plots lifeExp (y) against gdpPercap (x). xscale(log) uses log scale for x-axis - essential when GDP values vary widely">twoway (scatter lifeExp gdpPercap), xscale(log)</span></code></pre>
            <button class="run-btn" data-lang="stata">Run Code</button>
          </div>
          <div class="tab-content" data-lang="r">
<pre><code><span class="code-comment"># R: Scatter plot</span>
<span class="code-tooltip" data-tip="Sets up the plot with GDP per capita on x-axis, life expectancy on y-axis, and colors points by continent to show group differences">ggplot(df, aes(x = gdpPercap, y = lifeExp, color = continent)) +</span>
  <span class="code-tooltip" data-tip="Adds points to the plot. Each observation becomes one dot. You can customize size, shape, and transparency here">geom_point() +</span>
  <span class="code-tooltip" data-tip="Transforms x-axis to log base 10 scale. Makes it easier to see relationships when x values span multiple orders of magnitude">scale_x_log10()</span></code></pre>
            <button class="run-btn" data-lang="r">Run Code</button>
          </div>
        </div>

        <div class="output-simulation" data-output="analysis-4" data-lang="python">
          <div class="output-header">
            <span>Python Output</span>
            <button class="close-output">&times;</button>
          </div>
          <div class="output-body"><span style="color: #68d391;">[Scatter plot displayed]</span>

<span style="color: #90cdf4;">Life Expectancy vs GDP per Capita (log scale)

  80 |                    <span style="color: #68d391;">o</span> <span style="color: #68d391;">o</span>  <span style="color: #f6ad55;">*</span> <span style="color: #f6ad55;">*</span>
     |              <span style="color: #68d391;">o</span> <span style="color: #68d391;">o</span>   <span style="color: #f6ad55;">*</span><span style="color: #f6ad55;">*</span><span style="color: #f6ad55;">*</span>
  70 |         <span style="color: #90cdf4;">+</span>   <span style="color: #68d391;">o</span><span style="color: #68d391;">o</span><span style="color: #68d391;">o</span>  <span style="color: #f6ad55;">*</span> <span style="color: #f6ad55;">*</span>
     |     <span style="color: #fc8181;">x</span>  <span style="color: #90cdf4;">+</span><span style="color: #90cdf4;">+</span>  <span style="color: #68d391;">o</span>
  60 |   <span style="color: #fc8181;">x</span><span style="color: #fc8181;">x</span>  <span style="color: #90cdf4;">+</span>
     |  <span style="color: #fc8181;">x</span><span style="color: #fc8181;">x</span><span style="color: #fc8181;">x</span>
  50 | <span style="color: #fc8181;">x</span><span style="color: #fc8181;">x</span>
     +------------------------
      1k   5k  10k  50k  100k
        GDP per Capita (log)

Legend: <span style="color: #fc8181;">x</span>=Africa <span style="color: #90cdf4;">+</span>=Americas <span style="color: #68d391;">o</span>=Asia <span style="color: #f6ad55;">*</span>=Europe</span>

<span style="color: #68d391;">Figure saved to 'scatter.png'</span></div>
        </div>
        <div class="output-simulation" data-output="analysis-4" data-lang="stata">
          <div class="output-header">
            <span>Stata Output</span>
            <button class="close-output">&times;</button>
          </div>
          <div class="output-body">. twoway (scatter lifeExp gdpPercap), xscale(log)

<span style="color: #90cdf4;">Life Expectancy vs GDP per Capita

  80 |                       o  o
     |                  o  o  o
  70 |              o  o o o
     |         o  o o
  60 |      o o o
     |   o o o
  50 |  o o
     +------------------------
      1k   5k  10k  50k  100k
        GDP per Capita (log)
</span>
<span style="color: #68d391;">(graph displayed in Graph window)</span></div>
        </div>
        <div class="output-simulation" data-output="analysis-4" data-lang="r">
          <div class="output-header">
            <span>R Output</span>
            <button class="close-output">&times;</button>
          </div>
          <div class="output-body">&gt; ggplot(df, aes(x = gdpPercap, y = lifeExp, color = continent)) +
+   geom_point() +
+   scale_x_log10()

<span style="color: #90cdf4;">Life Expectancy vs GDP per Capita (log scale)

  80 |                    <span style="color: #68d391;">o</span> <span style="color: #68d391;">o</span>  <span style="color: #f6ad55;">*</span> <span style="color: #f6ad55;">*</span>
     |              <span style="color: #68d391;">o</span> <span style="color: #68d391;">o</span>   <span style="color: #f6ad55;">*</span><span style="color: #f6ad55;">*</span><span style="color: #f6ad55;">*</span>
  70 |         <span style="color: #90cdf4;">+</span>   <span style="color: #68d391;">o</span><span style="color: #68d391;">o</span><span style="color: #68d391;">o</span>  <span style="color: #f6ad55;">*</span> <span style="color: #f6ad55;">*</span>
     |     <span style="color: #fc8181;">x</span>  <span style="color: #90cdf4;">+</span><span style="color: #90cdf4;">+</span>  <span style="color: #68d391;">o</span>
  60 |   <span style="color: #fc8181;">x</span><span style="color: #fc8181;">x</span>  <span style="color: #90cdf4;">+</span>
     |  <span style="color: #fc8181;">x</span><span style="color: #fc8181;">x</span><span style="color: #fc8181;">x</span>
  50 | <span style="color: #fc8181;">x</span><span style="color: #fc8181;">x</span>
     +------------------------
      1k   5k  10k  50k  100k
        GDP per Capita (log)

Legend: <span style="color: #fc8181;">x</span>=Africa <span style="color: #90cdf4;">+</span>=Americas <span style="color: #68d391;">o</span>=Asia <span style="color: #f6ad55;">*</span>=Europe</span></div>
        </div>

        <h2 id="correlation">5.5 Correlation Analysis</h2>

        <div class="code-tabs" data-runnable="analysis-5">
          <div class="tab-buttons">
            <button class="tab-button active" data-lang="python">Python</button>
            <button class="tab-button" data-lang="stata">Stata</button>
            <button class="tab-button" data-lang="r">R</button>
          </div>
          <div class="tab-content active" data-lang="python">
<pre><code><span class="code-comment"># Python: Correlation</span>
<span class="code-tooltip" data-tip="Creates a correlation matrix showing how strongly each pair of variables moves together. Values range from -1 (perfect negative) to +1 (perfect positive). 0 means no linear relationship">df[[<span class="code-string">'income'</span>, <span class="code-string">'education'</span>, <span class="code-string">'age'</span>]].corr()</span>

<span class="code-comment"># With p-values</span>
<span class="code-keyword">from</span> <span class="code-tooltip" data-tip="scipy.stats provides statistical functions including hypothesis tests, distributions, and correlation measures">scipy</span> <span class="code-keyword">import</span> stats
<span class="code-tooltip" data-tip="Returns both the Pearson correlation coefficient (r) and its p-value. r measures linear relationship strength; p-value tests if correlation is statistically significant (p less than 0.05 is typically significant)">r, p = stats.pearsonr(df[<span class="code-string">'income'</span>], df[<span class="code-string">'education'</span>])</span></code></pre>
            <button class="run-btn" data-lang="python">Run Code</button>
          </div>
          <div class="tab-content" data-lang="stata">
<pre><code><span class="code-comment">* Stata: Correlation</span>
<span class="code-tooltip" data-tip="Displays a correlation matrix for the specified variables. Shows pairwise Pearson correlations - how strongly variables move together linearly">correlate income education age</span>
<span class="code-tooltip" data-tip="Pairwise correlations with significance levels. 'sig' shows p-values below each correlation. star(.05) marks correlations significant at 5% level with an asterisk">pwcorr income education age, sig star(<span class="code-number">.05</span>)</span></code></pre>
            <button class="run-btn" data-lang="stata">Run Code</button>
          </div>
          <div class="tab-content" data-lang="r">
<pre><code><span class="code-comment"># R: Correlation</span>
<span class="code-tooltip" data-tip="Computes correlation matrix for selected columns. use='complete.obs' excludes rows with any missing values (listwise deletion) - important for handling NA values">cor(df[c(<span class="code-string">"income"</span>, <span class="code-string">"education"</span>, <span class="code-string">"age"</span>)], use = <span class="code-string">"complete.obs"</span>)</span>
<span class="code-tooltip" data-tip="Tests if the correlation between two variables is statistically significant. Returns correlation coefficient, p-value, and 95% confidence interval">cor.test(df$income, df$education)</span></code></pre>
            <button class="run-btn" data-lang="r">Run Code</button>
          </div>
        </div>

        <div class="output-simulation" data-output="analysis-5" data-lang="python">
          <div class="output-header">
            <span>Python Output</span>
            <button class="close-output">&times;</button>
          </div>
          <div class="output-body">&gt;&gt;&gt; df[['income', 'education', 'age']].corr()
             income  education       age
income     1.000000   0.652341  0.234567
education  0.652341   1.000000  0.089123
age        0.234567   0.089123  1.000000

&gt;&gt;&gt; from scipy import stats
&gt;&gt;&gt; r, p = stats.pearsonr(df['income'], df['education'])
&gt;&gt;&gt; print(f"Correlation: r = {r:.4f}, p-value = {p:.4e}")
Correlation: r = 0.6523, p-value = 2.34e-112

<span style="color: #68d391;">The correlation between income and education is statistically significant (p &lt; 0.001)</span></div>
        </div>
        <div class="output-simulation" data-output="analysis-5" data-lang="stata">
          <div class="output-header">
            <span>Stata Output</span>
            <button class="close-output">&times;</button>
          </div>
          <div class="output-body">. correlate income education age
(obs=1,000)

             |   income education      age
-------------+---------------------------
      income |   1.0000
   education |   0.6523   1.0000
         age |   0.2346   0.0891   1.0000

. pwcorr income education age, sig star(.05)

             |   income education      age
-------------+---------------------------
      income |   1.0000
             |
             |
   education |   0.6523*  1.0000
             |   0.0000
             |
         age |   0.2346*  0.0891*  1.0000
             |   0.0000   0.0047
             |

<span style="color: #68d391;">* indicates significance at the 5% level</span></div>
        </div>
        <div class="output-simulation" data-output="analysis-5" data-lang="r">
          <div class="output-header">
            <span>R Output</span>
            <button class="close-output">&times;</button>
          </div>
          <div class="output-body">&gt; cor(df[c("income", "education", "age")], use = "complete.obs")
             income education       age
income    1.0000000 0.6523413 0.2345671
education 0.6523413 1.0000000 0.0891234
age       0.2345671 0.0891234 1.0000000

&gt; cor.test(df$income, df$education)

	Pearson's product-moment correlation

data:  df$income and df$education
t = 27.234, df = 998, p-value &lt; 2.2e-16
alternative hypothesis: true correlation is not equal to 0
95 percent confidence interval:
 0.6098 0.6921
sample estimates:
      cor
0.6523413

<span style="color: #68d391;">Strong positive correlation, highly significant (p &lt; 0.001)</span></div>
        </div>

        <!-- ============================================ -->
        <!-- SECTION 5.6: BASIC REGRESSION ANALYSIS       -->
        <!-- ============================================ -->
        <h2 id="regression">5.6 Basic Regression Analysis</h2>

        <p>
          Regression analysis is the foundation of quantitative empirical research. This section covers how to run regressions and‚Äîcritically‚Äîhow to interpret what the output means. Understanding these basics is essential before moving to causal inference methods in <a href="06-causal-inference.html">Module 6</a>.
        </p>

        <h3>Running a Basic Regression</h3>

        <div class="code-tabs" data-runnable="analysis-6">
          <div class="tab-buttons">
            <button class="tab-button active" data-lang="python">Python</button>
            <button class="tab-button" data-lang="stata">Stata</button>
            <button class="tab-button" data-lang="r">R</button>
          </div>
          <div class="tab-content active" data-lang="python">
<pre><code><span class="code-comment"># Python: OLS Regression with statsmodels</span>
<span class="code-keyword">import</span> <span class="code-tooltip" data-tip="statsmodels.formula.api allows you to write regression formulas like 'y ~ x1 + x2' in R-style syntax">statsmodels.formula.api</span> <span class="code-keyword">as</span> smf

<span class="code-comment"># Simple regression: income on education</span>
<span class="code-tooltip" data-tip="The formula 'income ~ education' means: income = b0 + b1*education + error. The ~ symbol separates the dependent variable (left) from independent variables (right)">model = smf.ols(<span class="code-string">'income ~ education'</span>, data=df).fit()</span>

<span class="code-comment"># Multiple regression: add controls</span>
<span class="code-tooltip" data-tip="Adding + age + experience includes these as control variables. Each coefficient is estimated while holding other variables constant">model = smf.ols(<span class="code-string">'income ~ education + age + experience'</span>, data=df).fit()</span>

<span class="code-comment"># View results</span>
<span class="code-function">print</span>(model.<span class="code-tooltip" data-tip="summary() displays the full regression output: coefficients, standard errors, t-statistics, p-values, R-squared, F-statistic, and more">summary()</span>)</code></pre>
            <button class="run-btn" data-lang="python">Run Code</button>
          </div>
          <div class="tab-content" data-lang="stata">
<pre><code><span class="code-comment">* Stata: OLS Regression</span>

<span class="code-comment">* Simple regression</span>
<span class="code-tooltip" data-tip="reg (short for regress) runs OLS. First variable is dependent (Y), rest are independent (X). Stata automatically includes a constant">reg income education</span>

<span class="code-comment">* Multiple regression with controls</span>
<span class="code-tooltip" data-tip="Adding age and experience as controls. Stata will estimate each coefficient while holding other variables constant">reg income education age experience</span>

<span class="code-comment">* Robust standard errors (heteroskedasticity-robust)</span>
<span class="code-tooltip" data-tip="The 'robust' option uses Huber-White standard errors that are valid even when error variance differs across observations">reg income education age experience, robust</span>

<span class="code-comment">* Clustered standard errors</span>
<span class="code-tooltip" data-tip="cluster(state) accounts for correlation within states. Essential when observations within a group are not independent">reg income education age experience, cluster(state)</span></code></pre>
            <button class="run-btn" data-lang="stata">Run Code</button>
          </div>
          <div class="tab-content" data-lang="r">
<pre><code><span class="code-comment"># R: OLS Regression</span>

<span class="code-comment"># Simple regression</span>
<span class="code-tooltip" data-tip="lm() fits a linear model. The formula 'income ~ education' means income is explained by education. R automatically includes an intercept">model <- lm(income ~ education, data = df)</span>

<span class="code-comment"># Multiple regression with controls</span>
<span class="code-tooltip" data-tip="The + symbol adds control variables. R estimates each coefficient while holding other variables constant">model <- lm(income ~ education + age + experience, data = df)</span>

<span class="code-comment"># View results</span>
<span class="code-tooltip" data-tip="summary() displays coefficients, standard errors, t-values, p-values, R-squared, and F-statistic">summary(model)</span>

<span class="code-comment"># Robust standard errors (using sandwich package)</span>
<span class="code-keyword">library</span>(sandwich)
<span class="code-keyword">library</span>(lmtest)
<span class="code-tooltip" data-tip="coeftest() with vcovHC() applies heteroskedasticity-consistent (robust) standard errors to your model">coeftest(model, vcov = vcovHC(model, type = <span class="code-string">"HC1"</span>))</span></code></pre>
            <button class="run-btn" data-lang="r">Run Code</button>
          </div>
        </div>

        <div class="output-simulation" data-output="analysis-6" data-lang="python">
          <div class="output-header">
            <span>Python Output</span>
            <button class="close-output">&times;</button>
          </div>
          <div class="output-body">&gt;&gt;&gt; print(model.summary())
                            OLS Regression Results
==============================================================================
Dep. Variable:                 income   R-squared:                       0.478
Model:                            OLS   Adj. R-squared:                  0.476
Method:                 Least Squares   F-statistic:                     304.2
Date:                Mon, 27 Jan 2026   Prob (F-statistic):          1.23e-134
Time:                        14:32:15   Log-Likelihood:                -11245.
No. Observations:                1000   AIC:                         2.250e+04
Df Residuals:                     996   BIC:                         2.252e+04
Df Model:                           3
==============================================================================
                 coef    std err          t      P>|t|      [0.025      0.975]
------------------------------------------------------------------------------
Intercept   <span style="color: #f6ad55;">15234.50</span>   1205.320     12.639      0.000   12869.45   17599.55
education    <span style="color: #68d391;">2847.63</span>    142.580     19.972      0.000    2567.83    3127.43
age           <span style="color: #68d391;">156.24</span>     28.450      5.491      0.000     100.39     212.09
experience    <span style="color: #68d391;">312.45</span>     45.230      6.908      0.000     223.66     401.24
==============================================================================
Omnibus:                       12.345   Durbin-Watson:                   2.012
Prob(Omnibus):                  0.002   Jarque-Bera (JB):               14.567
Skew:                           0.234   Prob(JB):                     0.000689
Kurtosis:                       3.456   Cond. No.                         156.
==============================================================================</div>
        </div>
        <div class="output-simulation" data-output="analysis-6" data-lang="stata">
          <div class="output-header">
            <span>Stata Output</span>
            <button class="close-output">&times;</button>
          </div>
          <div class="output-body">. reg income education age experience

      Source |       SS           df       MS      Number of obs   =     1,000
-------------+----------------------------------   F(3, 996)       =    304.23
       Model |  1.5892e+11         3  5.2973e+10   Prob > F        =    0.0000
    Residual |  1.7342e+11       996   174117430   R-squared       =    0.4782
-------------+----------------------------------   Adj R-squared   =    0.4766
       Total |  3.3234e+11       999   332671671   Root MSE        =     13195

------------------------------------------------------------------------------
      income |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
   education |   <span style="color: #68d391;">2847.632</span>   142.5801    19.97   0.000     2567.834    3127.429
         age |    <span style="color: #68d391;">156.243</span>   28.44956     5.49   0.000     100.3936     212.092
  experience |    <span style="color: #68d391;">312.451</span>   45.23245     6.91   0.000     223.6567    401.2453
       _cons |  <span style="color: #f6ad55;">15234.502</span>   1205.320    12.64   0.000    12869.454   17599.550
------------------------------------------------------------------------------

. reg income education age experience, robust

<span style="color: #68d391;">(Robust standard errors - coefficients identical, SEs may differ)</span>

. reg income education age experience, cluster(state)

<span style="color: #68d391;">(Clustered by state - 50 clusters)</span></div>
        </div>
        <div class="output-simulation" data-output="analysis-6" data-lang="r">
          <div class="output-header">
            <span>R Output</span>
            <button class="close-output">&times;</button>
          </div>
          <div class="output-body">&gt; summary(model)

Call:
lm(formula = income ~ education + age + experience, data = df)

Residuals:
   Min     1Q Median     3Q    Max
-38542  -8934   -234   8756  52341

Coefficients:
             Estimate Std. Error t value Pr(>|t|)
(Intercept) <span style="color: #f6ad55;">15234.50</span>    1205.32  12.639  < 2e-16 ***
education    <span style="color: #68d391;">2847.63</span>     142.58  19.972  < 2e-16 ***
age           <span style="color: #68d391;">156.24</span>      28.45   5.491 4.89e-08 ***
experience    <span style="color: #68d391;">312.45</span>      45.23   6.908 7.82e-12 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 13200 on 996 degrees of freedom
Multiple R-squared:  0.4782,	Adjusted R-squared:  0.4766
F-statistic: 304.2 on 3 and 996 DF,  p-value: < 2.2e-16

&gt; coeftest(model, vcov = vcovHC(model, type = "HC1"))

t test of coefficients:
             Estimate Std. Error t value  Pr(>|t|)
(Intercept) 15234.502   1312.456 11.6073 < 2.2e-16 ***
education    2847.632    156.234 18.2273 < 2.2e-16 ***
age           156.243     31.234  5.0024 6.45e-07 ***
experience    312.451     48.567  6.4332 1.89e-10 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</div>
        </div>

        <h3>Understanding Regression Output</h3>

        <p>
          A regression output contains many statistics. Here's what each one means and how to interpret it:
        </p>

        <div class="info-box note">
          <div class="info-box-title">Example Output</div>
          <p style="font-family: var(--font-code); font-size: 0.85rem; white-space: pre; margin-bottom: 0; overflow-x: auto;">
==============================================================================
                 coef    std err          t      P>|t|      [0.025      0.975]
------------------------------------------------------------------------------
Intercept    15234.50    1205.32     12.639      0.000    12869.45    17599.55
education     2847.63     142.58     19.972      0.000     2567.83     3127.43
age            156.24      28.45      5.491      0.000      100.39      212.09
==============================================================================
R-squared:                       0.423
F-statistic:                     285.7
Prob (F-statistic):           1.23e-89
==============================================================================</p>
        </div>

        <h4>Key Components Explained</h4>

        <table>
          <thead>
            <tr>
              <th>Component</th>
              <th>What It Tells You</th>
              <th>Example Interpretation</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td><strong>Coefficient (coef)</strong></td>
              <td>The estimated effect of a one-unit change in X on Y</td>
              <td>One more year of education is associated with $2,847.63 higher income</td>
            </tr>
            <tr>
              <td><strong>Standard Error (std err)</strong></td>
              <td>Uncertainty in the coefficient estimate</td>
              <td>Our estimate of education's effect could vary by about $142.58</td>
            </tr>
            <tr>
              <td><strong>t-statistic (t)</strong></td>
              <td>Coefficient divided by standard error; tests if coef differs from 0</td>
              <td>19.97 is very large, indicating strong evidence of an effect</td>
            </tr>
            <tr>
              <td><strong>P-value (P>|t|)</strong></td>
              <td>Probability of seeing this result if true effect were zero</td>
              <td>0.000 means extremely unlikely to see this by chance</td>
            </tr>
            <tr>
              <td><strong>Confidence Interval</strong></td>
              <td>Range that contains the true coefficient 95% of the time</td>
              <td>True education effect is likely between $2,568 and $3,127</td>
            </tr>
            <tr>
              <td><strong>R-squared</strong></td>
              <td>Proportion of variance in Y explained by the model</td>
              <td>Education and age explain 42.3% of income variation</td>
            </tr>
            <tr>
              <td><strong>F-statistic</strong></td>
              <td>Tests if all coefficients together are zero</td>
              <td>High F (285.7) with low p-value means model explains something</td>
            </tr>
          </tbody>
        </table>

        <div class="info-box warning">
          <div class="info-box-title">Correlation vs. Causation</div>
          <p style="margin-bottom: 0;">
            A regression coefficient measures <strong>association</strong>, not causation. The education coefficient tells us that higher education is <em>associated with</em> higher income‚Äînot that education <em>causes</em> higher income. People who get more education may differ in other ways (ability, motivation, family background) that also affect income. To make causal claims, you need the methods covered in <a href="06-causal-inference.html">Module 6: Causal Inference</a>.
          </p>
        </div>

        <h4>Statistical Significance</h4>

        <p>
          A coefficient is "statistically significant" when we can be confident it differs from zero. Common thresholds:
        </p>

        <ul>
          <li><strong>p &lt; 0.01</strong> (***): Very strong evidence</li>
          <li><strong>p &lt; 0.05</strong> (**): Strong evidence (most common threshold)</li>
          <li><strong>p &lt; 0.10</strong> (*): Weak evidence</li>
        </ul>

        <p>
          However, statistical significance tells you nothing about <strong>practical significance</strong>. A coefficient can be statistically significant but economically tiny‚Äîor statistically insignificant but potentially meaningful with more data.
        </p>

        <h3>Extracting OLS Components: SSR, ESS, TSS, R&sup2;</h3>

        <p>
          Understanding the decomposition of variance in regression is fundamental. The Total Sum of Squares (TSS) measures total variation in the outcome. OLS splits this into the Explained Sum of Squares (ESS)‚Äîvariation captured by the model‚Äîand the Sum of Squared Residuals (SSR)‚Äîunexplained variation. The identity TSS = ESS + SSR always holds for OLS with an intercept.
        </p>

        <div class="code-tabs" data-runnable="analysis-ssr">
          <div class="tab-buttons">
            <button class="tab-button active" data-lang="python">Python</button>
            <button class="tab-button" data-lang="stata">Stata</button>
            <button class="tab-button" data-lang="r">R</button>
          </div>
          <div class="tab-content active" data-lang="python">
<pre><code><span class="code-comment"># Python: Extracting SSR, ESS, TSS, R-squared</span>
<span class="code-keyword">import</span> statsmodels.formula.api <span class="code-keyword">as</span> smf
<span class="code-keyword">import</span> numpy <span class="code-keyword">as</span> np

model = smf.ols(<span class="code-string">'income ~ education + experience'</span>, data=df).fit()

<span class="code-comment"># Direct access from model object</span>
<span class="code-tooltip" data-tip="statsmodels stores these directly in the results object">print(f<span class="code-string">"SSR (Residual SS):  {model.ssr:.4f}"</span>)
print(f<span class="code-string">"ESS (Model SS):     {model.ess:.4f}"</span>)
print(f<span class="code-string">"TSS (Total SS):     {model.centered_tss:.4f}"</span>)
print(f<span class="code-string">"R-squared:          {model.rsquared:.4f}"</span>)
print(f<span class="code-string">"Adj. R-squared:     {model.rsquared_adj:.4f}"</span>)</span>

<span class="code-comment"># Manual calculation (for understanding)</span>
y = df[<span class="code-string">'income'</span>]
y_hat = model.fittedvalues
e = model.resid

<span class="code-tooltip" data-tip="TSS = sum of (y - y_bar)^2, ESS = sum of (y_hat - y_bar)^2, SSR = sum of e^2">SSR = np.sum(e**2)
TSS = np.sum((y - y.mean())**2)
ESS = np.sum((y_hat - y.mean())**2)
R2 = 1 - SSR / TSS</span>

<span class="code-comment"># Verify the identity: TSS = ESS + SSR</span>
print(f<span class="code-string">"TSS = {TSS:.4f}, ESS + SSR = {ESS + SSR:.4f}"</span>)

<span class="code-comment"># Adjusted R-squared</span>
n = len(y)
k = model.df_model  <span class="code-comment"># number of regressors</span>
adj_R2 = 1 - (1 - R2) * (n - 1) / (n - k - 1)</code></pre>
            <button class="run-btn" data-lang="python">Run Code</button>
          </div>
          <div class="tab-content" data-lang="stata">
<pre><code><span class="code-comment">* Stata: Extracting SSR, ESS, TSS, R-squared</span>

reg income education experience

<span class="code-comment">* All stored results accessible via ereturn list</span>
<span class="code-tooltip" data-tip="After any estimation command, ereturn list shows all stored scalars">ereturn list</span>

<span class="code-comment">* Key scalars:</span>
<span class="code-tooltip" data-tip="e(rss) is residual SS, e(mss) is model SS (ESS), e(r2) is R-squared">display "SSR (Residual SS):  " e(rss)
display "ESS (Model SS):     " e(mss)
display "R-squared:          " e(r2)
display "Adj R-squared:      " e(r2_a)
display "N observations:     " e(N)
display "Degrees of freedom: " e(df_r)</span>

<span class="code-comment">* TSS = ESS + SSR</span>
display "TSS = " e(mss) + e(rss)

<span class="code-comment">* Manual calculation from residuals</span>
predict residuals, residuals
predict yhat, xb
quietly summarize income
<span class="code-tooltip" data-tip="gen computes new variables; sum() with quietly summarize gives totals">gen dev_sq = (income - r(mean))^2
gen res_sq = residuals^2
gen fit_sq = (yhat - r(mean))^2
quietly summarize dev_sq
display "TSS = " r(sum)
quietly summarize res_sq
display "SSR = " r(sum)</span></code></pre>
            <button class="run-btn" data-lang="stata">Run Code</button>
          </div>
          <div class="tab-content" data-lang="r">
<pre><code><span class="code-comment"># R: Extracting SSR, ESS, TSS, R-squared</span>
model <- lm(income ~ education + experience, data = df)

<span class="code-comment"># Extract key objects</span>
<span class="code-tooltip" data-tip="residuals() and fitted() extract the vectors; deviance() gives SSR">e_hat  <- residuals(model)      <span class="code-comment"># residual vector</span>
y_hat  <- fitted(model)          <span class="code-comment"># predicted values</span>
y      <- df$income              <span class="code-comment"># actual outcome</span></span>

<span class="code-comment"># Manual calculations</span>
SSR <- sum(e_hat^2)                         <span class="code-comment"># Sum of Squared Residuals</span>
TSS <- sum((y - mean(y))^2)                 <span class="code-comment"># Total Sum of Squares</span>
ESS <- sum((y_hat - mean(y))^2)             <span class="code-comment"># Explained Sum of Squares</span>

<span class="code-comment"># Verify: TSS = ESS + SSR</span>
<span class="code-tooltip" data-tip="This identity always holds for OLS with an intercept">cat("TSS =", TSS, " ESS + SSR =", ESS + SSR, "\n")</span>

<span class="code-comment"># R-squared and adjusted R-squared</span>
R2 <- 1 - SSR / TSS
n  <- nrow(df)
k  <- length(coef(model)) - 1   <span class="code-comment"># number of regressors (excl. intercept)</span>
adj_R2 <- 1 - (1 - R2) * (n - 1) / (n - k - 1)

<span class="code-comment"># Compare with built-in</span>
<span class="code-tooltip" data-tip="summary(model) stores R2 and adj-R2 as named elements you can extract">cat("Manual R2:", R2, " summary R2:", summary(model)$r.squared, "\n")
cat("Manual adj-R2:", adj_R2, " summary adj-R2:", summary(model)$adj.r.squared, "\n")</span>

<span class="code-comment"># Alternative: deviance() gives SSR directly</span>
deviance(model)  <span class="code-comment"># same as SSR</span></code></pre>
            <button class="run-btn" data-lang="r">Run Code</button>
          </div>
        </div>

        <div class="output-simulation" data-output="analysis-ssr" data-lang="python">
          <div class="output-header"><span>Python Output</span><button class="close-output">&times;</button></div>
          <div class="output-body">SSR (Residual SS):  24531.2456
ESS (Model SS):     12893.7544
TSS (Total SS):     37425.0000
R-squared:          0.3445
Adj. R-squared:     0.3419

TSS = 37425.0000, ESS + SSR = 37425.0000</div>
        </div>

        <div class="output-simulation" data-output="analysis-ssr" data-lang="stata">
          <div class="output-header"><span>Stata Output</span><button class="close-output">&times;</button></div>
          <div class="output-body">. ereturn list

scalars:
              e(N) =  500
           e(df_m) =  2
           e(df_r) =  497
            e(F_f) =  130.4512
            e(r2) =  .34451234
          e(r2_a) =  .34187654
           e(rmse) =  7.0234567
           e(mss) =  12893.754
           e(rss) =  24531.246
            e(ll) =  -1678.234

SSR (Residual SS):  24531.246
ESS (Model SS):     12893.754
R-squared:          .34451234
Adj R-squared:      .34187654
TSS = 37425</div>
        </div>

        <div class="output-simulation" data-output="analysis-ssr" data-lang="r">
          <div class="output-header"><span>R Output</span><button class="close-output">&times;</button></div>
          <div class="output-body">TSS = 37425  ESS + SSR = 37425
Manual R2: 0.3445123  summary R2: 0.3445123
Manual adj-R2: 0.3418765  summary adj-R2: 0.3418765

> deviance(model)
[1] 24531.25</div>
        </div>

        <div class="info-box tip">
          <div class="info-box-title">Understanding the Variance Decomposition</div>
          <p>
            <strong>TSS = ESS + SSR</strong> (with an intercept). R&sup2; = ESS/TSS = 1 - SSR/TSS tells you the fraction of total variance explained by the model. Adjusted R&sup2; penalizes for adding regressors: it can decrease if a new variable adds more noise than explanatory power.
          </p>
          <p style="margin-bottom: 0;">
            In practice, you rarely compute these manually‚Äîbut understanding the decomposition helps you interpret regression output, compare models, and verify that your estimation code is correct.
          </p>
        </div>

        <h3>F-Tests and Joint Significance</h3>

        <p>
          An F-test evaluates whether a <em>set</em> of coefficients are jointly significantly different from zero (or from each other). This goes beyond testing individual coefficients one at a time, which can miss cases where variables are jointly important even if individually insignificant.
        </p>

        <div class="code-tabs" data-runnable="analysis-ftest">
          <div class="tab-buttons">
            <button class="tab-button active" data-lang="python">Python</button>
            <button class="tab-button" data-lang="stata">Stata</button>
            <button class="tab-button" data-lang="r">R</button>
          </div>
          <div class="tab-content active" data-lang="python">
<pre><code><span class="code-comment"># Python: F-tests and joint significance</span>
<span class="code-keyword">import</span> statsmodels.formula.api <span class="code-keyword">as</span> smf
<span class="code-keyword">import</span> numpy <span class="code-keyword">as</span> np

model = smf.ols(<span class="code-string">'income ~ education + experience + age'</span>, data=df).fit()

<span class="code-comment"># Joint test: education AND experience = 0</span>
<span class="code-tooltip" data-tip="f_test takes a hypothesis string or matrix. 'education = 0, experience = 0' tests both jointly.">f_result = model.f_test(<span class="code-string">'education = 0, experience = 0'</span>)</span>
print(f_result)

<span class="code-comment"># Test a linear restriction: education = experience</span>
<span class="code-tooltip" data-tip="Tests H0: beta_education = beta_experience (returns F-stat and p-value)">f_restrict = model.f_test(<span class="code-string">'education = experience'</span>)</span>
print(f_restrict)

<span class="code-comment"># Overall F-test (all regressors jointly = 0)</span>
print(f<span class="code-string">"Overall F-statistic: {model.fvalue:.4f}"</span>)
print(f<span class="code-string">"Overall F p-value:   {model.f_pvalue:.6f}"</span>)</code></pre>
            <button class="run-btn" data-lang="python">Run Code</button>
          </div>
          <div class="tab-content" data-lang="stata">
<pre><code><span class="code-comment">* Stata: F-tests and joint significance</span>

reg income education experience age

<span class="code-comment">* Joint test: education AND experience = 0</span>
<span class="code-tooltip" data-tip="test lists the hypotheses; Stata computes the joint F-statistic">test education experience</span>

<span class="code-comment">* Test a linear restriction: education = experience</span>
<span class="code-tooltip" data-tip="test can also handle equality restrictions between coefficients">test education = experience</span>

<span class="code-comment">* Multiple restrictions at once</span>
test (education = 0) (experience = 0) (age = 0)

<span class="code-comment">* Wald test (equivalent for linear models)</span>
<span class="code-tooltip" data-tip="testparm tests all coefficients matching a pattern">testparm education experience</span></code></pre>
            <button class="run-btn" data-lang="stata">Run Code</button>
          </div>
          <div class="tab-content" data-lang="r">
<pre><code><span class="code-comment"># R: F-tests and joint significance</span>
<span class="code-keyword">library</span>(car)

model <- lm(income ~ education + experience + age, data = df)

<span class="code-comment"># Joint test: education AND experience = 0</span>
<span class="code-tooltip" data-tip="linearHypothesis() tests linear restrictions on coefficients. Pass a character vector of hypotheses.">linearHypothesis(model, c("education = 0", "experience = 0"))</span>

<span class="code-comment"># Test a linear restriction: education = experience</span>
<span class="code-tooltip" data-tip="Tests H0: beta_education - beta_experience = 0">linearHypothesis(model, "education = experience")</span>

<span class="code-comment"># With robust standard errors</span>
<span class="code-keyword">library</span>(sandwich)
<span class="code-tooltip" data-tip="Pass a vcov matrix for robust or clustered tests">linearHypothesis(model, c("education = 0", "experience = 0"),
                 vcov = vcovHC(model, type = "HC1"))</span>

<span class="code-comment"># Overall F-test (from summary)</span>
<span class="code-tooltip" data-tip="summary() reports the overall F-test at the bottom of regression output">f_stat <- summary(model)$fstatistic
pf(f_stat[1], f_stat[2], f_stat[3], lower.tail = FALSE)</span></code></pre>
            <button class="run-btn" data-lang="r">Run Code</button>
          </div>
        </div>

        <div class="output-simulation" data-output="analysis-ftest" data-lang="python">
          <div class="output-header"><span>Python Output</span><button class="close-output">&times;</button></div>
          <div class="output-body">Joint F-test: education = 0, experience = 0
&lt;F test: F=array([[65.234]]), p=1.23e-26, df_denom=496, df_num=2&gt;

Restriction test: education = experience
&lt;F test: F=array([[8.912]]), p=0.00296, df_denom=496, df_num=1&gt;

Overall F-statistic: 130.4512
Overall F p-value:   0.000000</div>
        </div>

        <div class="output-simulation" data-output="analysis-ftest" data-lang="stata">
          <div class="output-header"><span>Stata Output</span><button class="close-output">&times;</button></div>
          <div class="output-body">. test education experience

 ( 1)  education = 0
 ( 2)  experience = 0

       F(  2,   496) =   65.23
            Prob > F =    0.0000

. test education = experience

 ( 1)  education - experience = 0

       F(  1,   496) =    8.91
            Prob > F =    0.0030</div>
        </div>

        <div class="output-simulation" data-output="analysis-ftest" data-lang="r">
          <div class="output-header"><span>R Output</span><button class="close-output">&times;</button></div>
          <div class="output-body">Linear hypothesis test

Hypothesis:
education = 0
experience = 0

Model 1: restricted model
Model 2: income ~ education + experience + age

  Res.Df   RSS Df Sum of Sq      F    Pr(>F)
1    498 37425
2    496 24531  2     12894 65.234 1.23e-26 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Linear hypothesis test (with HC1 robust SEs):
  Chisq = 118.45, Df = 2, Pr(>Chisq) = 2.34e-26</div>
        </div>

        <div class="info-box tip">
          <div class="info-box-title">When to Use F-Tests</div>
          <p style="margin-bottom: 0;">
            Use F-tests when you want to test whether a <em>group</em> of variables matters jointly, test restrictions like "does education have the same effect as experience?", or compare nested models. With heteroskedasticity or clustering, always use the robust version (pass a <code>vcov</code> matrix in R, or use <code>, robust</code> in Stata).
          </p>
        </div>

        <h3>Common Regression Specifications</h3>

        <div class="code-tabs" data-runnable="analysis-7">
          <div class="tab-buttons">
            <button class="tab-button active" data-lang="python">Python</button>
            <button class="tab-button" data-lang="stata">Stata</button>
            <button class="tab-button" data-lang="r">R</button>
          </div>
          <div class="tab-content active" data-lang="python">
<pre><code><span class="code-comment"># Python: Common specifications</span>
<span class="code-keyword">import</span> statsmodels.formula.api <span class="code-keyword">as</span> smf
<span class="code-keyword">import</span> numpy <span class="code-keyword">as</span> np

<span class="code-comment"># Log transformation</span>
<span class="code-tooltip" data-tip="Taking log of income converts the coefficient to approximate percentage changes. Log-linear: 1 unit increase in X = (coef*100)% change in Y">df[<span class="code-string">'log_income'</span>] = np.log(df[<span class="code-string">'income'</span>])</span>
model = smf.ols(<span class="code-string">'log_income ~ education + age'</span>, data=df).fit()

<span class="code-comment"># Quadratic term (non-linear relationship)</span>
<span class="code-tooltip" data-tip="I() in formulas prevents + from being interpreted as 'add variable'. This tests if the effect of age diminishes or increases at higher ages">model = smf.ols(<span class="code-string">'income ~ age + I(age**2)'</span>, data=df).fit()</span>

<span class="code-comment"># Interaction terms</span>
<span class="code-tooltip" data-tip="The * operator includes both main effects AND their interaction. Tests if education's effect differs by gender">model = smf.ols(<span class="code-string">'income ~ education * gender'</span>, data=df).fit()</span>

<span class="code-comment"># Categorical variables (dummy encoding)</span>
<span class="code-tooltip" data-tip="C() tells statsmodels to treat region as categorical. Creates dummy variables automatically, omitting one category as reference">model = smf.ols(<span class="code-string">'income ~ education + C(region)'</span>, data=df).fit()</span></code></pre>
            <button class="run-btn" data-lang="python">Run Code</button>
          </div>
          <div class="tab-content" data-lang="stata">
<pre><code><span class="code-comment">* Stata: Common specifications</span>

<span class="code-comment">* Log transformation</span>
<span class="code-tooltip" data-tip="gen creates a new variable. ln() takes natural log. Log-linear regression: coefficients represent approximate percentage changes">gen log_income = ln(income)</span>
reg log_income education age

<span class="code-comment">* Quadratic term</span>
<span class="code-tooltip" data-tip="c.age##c.age creates age and age-squared. The ## operator with c. prefix handles continuous variable interactions">reg income c.age##c.age</span>

<span class="code-comment">* Interaction terms</span>
<span class="code-tooltip" data-tip="c.education##i.female creates education, female dummy, and their interaction. Tests if education effect differs by gender">reg income c.education##i.female</span>

<span class="code-comment">* Categorical variables</span>
<span class="code-tooltip" data-tip="i.region creates dummy variables for each region automatically. First category is reference (omitted)">reg income education i.region</span>

<span class="code-comment">* Fixed effects</span>
<span class="code-tooltip" data-tip="areg absorbs state fixed effects. Equivalent to including a dummy for each state. More efficient than i.state for many categories">areg income education age, absorb(state)</span></code></pre>
            <button class="run-btn" data-lang="stata">Run Code</button>
          </div>
          <div class="tab-content" data-lang="r">
<pre><code><span class="code-comment"># R: Common specifications</span>

<span class="code-comment"># Log transformation</span>
<span class="code-tooltip" data-tip="log() in R formula applies natural log. Coefficients become approximate percentage changes in the outcome">model <- lm(log(income) ~ education + age, data = df)</span>

<span class="code-comment"># Quadratic term</span>
<span class="code-tooltip" data-tip="I() protects the arithmetic operation. poly(age, 2) is another option that creates orthogonal polynomials">model <- lm(income ~ age + I(age^2), data = df)</span>

<span class="code-comment"># Interaction terms</span>
<span class="code-tooltip" data-tip="The * operator includes education, gender, AND their interaction. : would include only the interaction">model <- lm(income ~ education * gender, data = df)</span>

<span class="code-comment"># Categorical variables</span>
<span class="code-tooltip" data-tip="factor() converts to categorical. R creates dummies automatically. First level is reference by default">model <- lm(income ~ education + factor(region), data = df)</span>

<span class="code-comment"># Fixed effects (using fixest package)</span>
<span class="code-keyword">library</span>(fixest)
<span class="code-tooltip" data-tip="feols() efficiently handles fixed effects. The | separates the model from fixed effects. Much faster than lm() with many groups">model <- feols(income ~ education + age | state, data = df)</span></code></pre>
            <button class="run-btn" data-lang="r">Run Code</button>
          </div>
        </div>

        <div class="output-simulation" data-output="analysis-7" data-lang="python">
          <div class="output-header">
            <span>Python Output</span>
            <button class="close-output">&times;</button>
          </div>
          <div class="output-body"><span style="color: #68d391;"># Log transformation model results:</span>
                 coef    std err          t      P>|t|
Intercept     9.2345      0.052    177.59      0.000
education     <span style="color: #68d391;">0.0543</span>      0.003     18.10      0.000  <span style="color: #90cdf4;">‚Üê 5.43% increase per year of education</span>
age           <span style="color: #68d391;">0.0028</span>      0.001      2.80      0.005  <span style="color: #90cdf4;">‚Üê 0.28% increase per year of age</span>

<span style="color: #68d391;"># Quadratic term model:</span>
                 coef    std err          t      P>|t|
Intercept   -12456.23    3245.12     -3.84      0.000
age           <span style="color: #68d391;">1823.45</span>     156.78     11.63      0.000
I(age**2)      <span style="color: #fc8181;">-15.67</span>       1.89     -8.29      0.000  <span style="color: #90cdf4;">‚Üê Negative: diminishing returns to age</span>

<span style="color: #68d391;"># Interaction model:</span>
                      coef    std err          t      P>|t|
Intercept          12345.67    1234.56      10.00      0.000
education           <span style="color: #68d391;">2567.89</span>     167.89      15.29      0.000
gender[T.Male]      <span style="color: #68d391;">8234.56</span>    1567.89       5.25      0.000
education:gender     <span style="color: #f6ad55;">-234.56</span>      89.12      -2.63      0.009  <span style="color: #90cdf4;">‚Üê Gender gap narrows with education</span>

<span style="color: #68d391;"># Categorical region model:</span>
                      coef    std err          t      P>|t|
Intercept          25678.90    1456.78      17.63      0.000
education           2789.34     145.67      19.15      0.000
C(region)[T.South]  <span style="color: #fc8181;">-3456.78</span>     890.12      -3.88      0.000
C(region)[T.West]    <span style="color: #68d391;">2345.67</span>     912.34       2.57      0.010
C(region)[T.Midwest] <span style="color: #fc8181;">-1234.56</span>     878.90      -1.40      0.161</div>
        </div>
        <div class="output-simulation" data-output="analysis-7" data-lang="stata">
          <div class="output-header">
            <span>Stata Output</span>
            <button class="close-output">&times;</button>
          </div>
          <div class="output-body">. gen log_income = ln(income)
. reg log_income education age

------------------------------------------------------------------------------
  log_income |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
   education |   <span style="color: #68d391;">.0543012</span>   .0030012    18.10   0.000     .0484112    .0601912
         age |   <span style="color: #68d391;">.0028456</span>   .0010162     2.80   0.005     .0008512    .0048400
       _cons |   9.234512   .0520123   177.59   0.000     9.132456   9.336568
------------------------------------------------------------------------------
<span style="color: #90cdf4;">Interpretation: 1 year of education ‚Üí 5.43% higher income</span>

. reg income c.age##c.age

------------------------------------------------------------------------------
      income |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
         age |   <span style="color: #68d391;">1823.456</span>   156.7823    11.63   0.000     1515.789   2131.123
             |
   c.age#c.age | <span style="color: #fc8181;">-15.6789</span>    1.89123    -8.29   0.000    -19.39012  -11.96768
             |
       _cons |  -12456.23   3245.123    -3.84   0.000   -18824.56  -6087.904
------------------------------------------------------------------------------
<span style="color: #90cdf4;">Negative age-squared: income peaks then declines</span>

. reg income c.education##i.female

------------------------------------------------------------------------------
      income |      Coef.   Std. Err.      t    P>|t|
-------------+----------------------------------------------------------------
   education |   <span style="color: #68d391;">2567.890</span>   167.8901    15.29   0.000
    1.female |  <span style="color: #fc8181;">-8234.560</span>  1567.890    -5.25   0.000
             |
c.education# |
    1.female |    <span style="color: #68d391;">234.560</span>    89.1234     2.63   0.009
             |
       _cons |  12345.670  1234.560    10.00   0.000
------------------------------------------------------------------------------
<span style="color: #90cdf4;">Positive interaction: education effect larger for women</span></div>
        </div>
        <div class="output-simulation" data-output="analysis-7" data-lang="r">
          <div class="output-header">
            <span>R Output</span>
            <button class="close-output">&times;</button>
          </div>
          <div class="output-body">&gt; model <- lm(log(income) ~ education + age, data = df)
&gt; summary(model)

Coefficients:
             Estimate Std. Error t value Pr(>|t|)
(Intercept) 9.2345120  0.0520123 177.587  < 2e-16 ***
education   <span style="color: #68d391;">0.0543012</span>  0.0030012  18.093  < 2e-16 ***  <span style="color: #90cdf4;"># 5.43% per year</span>
age         <span style="color: #68d391;">0.0028456</span>  0.0010162   2.800  0.00521 **   <span style="color: #90cdf4;"># 0.28% per year</span>

&gt; model <- lm(income ~ age + I(age^2), data = df)
&gt; summary(model)

Coefficients:
             Estimate Std. Error t value Pr(>|t|)
(Intercept) -12456.23    3245.12  -3.838 0.000131 ***
age           <span style="color: #68d391;">1823.46</span>     156.78  11.630  < 2e-16 ***
I(age^2)       <span style="color: #fc8181;">-15.68</span>       1.89  -8.291  < 2e-16 ***  <span style="color: #90cdf4;"># Peak at age ~58</span>

&gt; model <- lm(income ~ education * gender, data = df)
&gt; summary(model)

Coefficients:
                   Estimate Std. Error t value Pr(>|t|)
(Intercept)        12345.67    1234.56  10.000  < 2e-16 ***
education           <span style="color: #68d391;">2567.89</span>     167.89  15.294  < 2e-16 ***
genderMale          <span style="color: #68d391;">8234.56</span>    1567.89   5.251 1.89e-07 ***
education:genderMale <span style="color: #f6ad55;">-234.56</span>      89.12  -2.632 0.00862 **

&gt; library(fixest)
&gt; model <- feols(income ~ education + age | state, data = df)
&gt; summary(model)
OLS estimation, Dep. Var.: income
Observations: 1,000
Fixed-effects: state: 50
Standard-errors: Clustered (state)
             Estimate Std. Error  t value   Pr(>|t|)
education    <span style="color: #68d391;">2654.32</span>     189.45   14.014  < 2.2e-16 ***
age           <span style="color: #68d391;">145.67</span>      34.56    4.214  0.0001034 ***</div>
        </div>

        <h3>Interpreting Log Transformations</h3>

        <table>
          <thead>
            <tr>
              <th>Model</th>
              <th>Form</th>
              <th>Interpretation of b1</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td><strong>Linear</strong></td>
              <td>Y = b0 + b1*X</td>
              <td>1 unit increase in X ‚Üí b1 unit change in Y</td>
            </tr>
            <tr>
              <td><strong>Log-Linear</strong></td>
              <td>log(Y) = b0 + b1*X</td>
              <td>1 unit increase in X ‚Üí (b1 √ó 100)% change in Y</td>
            </tr>
            <tr>
              <td><strong>Linear-Log</strong></td>
              <td>Y = b0 + b1*log(X)</td>
              <td>1% increase in X ‚Üí b1/100 unit change in Y</td>
            </tr>
            <tr>
              <td><strong>Log-Log</strong></td>
              <td>log(Y) = b0 + b1*log(X)</td>
              <td>1% increase in X ‚Üí b1% change in Y (elasticity)</td>
            </tr>
          </tbody>
        </table>

        <!-- ============================================ -->
        <!-- SECTION 5.7: SUMMARY TABLES FOR PAPERS       -->
        <!-- ============================================ -->
        <h2 id="summary-tables">5.7 Summary Tables for Papers</h2>

        <div class="code-tabs" data-runnable="analysis-8">
          <div class="tab-buttons">
            <button class="tab-button active" data-lang="python">Python</button>
            <button class="tab-button" data-lang="stata">Stata</button>
            <button class="tab-button" data-lang="r">R</button>
          </div>
          <div class="tab-content active" data-lang="python">
<pre><code><span class="code-comment"># Python: Summary table with stargazer</span>
<span class="code-comment"># pip install stargazer</span>
<span class="code-keyword">from</span> <span class="code-tooltip" data-tip="stargazer creates publication-ready regression tables in LaTeX, HTML, or text format - similar to Stata's esttab or R's stargazer package">stargazer.stargazer</span> <span class="code-keyword">import</span> Stargazer

<span class="code-comment"># For regression tables</span>
<span class="code-keyword">import</span> <span class="code-tooltip" data-tip="statsmodels provides statistical models including OLS regression. The formula API lets you write models like 'y ~ x1 + x2' similar to R syntax">statsmodels.formula.api</span> <span class="code-keyword">as</span> smf
<span class="code-tooltip" data-tip="Runs Ordinary Least Squares (OLS) regression: income = b0 + b1*education + b2*age + error. This estimates how education and age relate to income, controlling for each other">model = smf.ols(<span class="code-string">'income ~ education + age'</span>, data=df).fit()</span>
<span class="code-tooltip" data-tip="Creates a Stargazer object that can format one or more regression models into a professional table">stargazer = Stargazer([model])</span>
<span class="code-tooltip" data-tip="Outputs the table in LaTeX format for academic papers. You can also use render_html() for web pages or render_text() for console output">print(stargazer.render_latex())</span></code></pre>
            <button class="run-btn" data-lang="python">Run Code</button>
          </div>
          <div class="tab-content" data-lang="stata">
<pre><code><span class="code-comment">* Stata: Summary tables with estout</span>
<span class="code-tooltip" data-tip="Clears any previously stored estimation results. Always do this before storing new models to avoid mixing old and new results">eststo clear</span>
<span class="code-tooltip" data-tip="eststo stores the regression results. 'reg' runs OLS: income = b0 + b1*education. The coefficient b1 shows how much income changes per unit of education">eststo: reg income education</span>
<span class="code-tooltip" data-tip="Adds a second model with age as a control variable. Comparing models shows if education effect changes when controlling for age">eststo: reg income education age</span>
<span class="code-tooltip" data-tip="Exports all stored models to a LaTeX table. 'se' shows standard errors below coefficients. Stars indicate significance: * p less than 0.1, ** p less than 0.05, *** p less than 0.01">esttab using <span class="code-string">"table.tex"</span>, replace se star(* <span class="code-number">0.1</span> ** <span class="code-number">0.05</span> *** <span class="code-number">0.01</span>)</span></code></pre>
            <button class="run-btn" data-lang="stata">Run Code</button>
          </div>
          <div class="tab-content" data-lang="r">
<pre><code><span class="code-comment"># R: Summary tables with modelsummary</span>
<span class="code-tooltip" data-tip="modelsummary is a modern R package for creating publication-quality tables from regression models. Supports many output formats">library(modelsummary)</span>

<span class="code-tooltip" data-tip="lm() fits a linear model (OLS regression). This estimates: income = b0 + b1*education + error. b1 is the estimated effect of education on income">model1 <- lm(income ~ education, data = df)</span>
<span class="code-tooltip" data-tip="Adds age as a control variable. Now b1 measures education's effect while holding age constant - important for isolating the education effect">model2 <- lm(income ~ education + age, data = df)</span>

<span class="code-tooltip" data-tip="Creates a side-by-side comparison table. stars=TRUE adds significance indicators. output='table.tex' saves as LaTeX for papers">modelsummary(list(model1, model2), stars = TRUE, output = <span class="code-string">"table.tex"</span>)</span></code></pre>
            <button class="run-btn" data-lang="r">Run Code</button>
          </div>
        </div>

        <div class="output-simulation" data-output="analysis-8" data-lang="python">
          <div class="output-header">
            <span>Python Output</span>
            <button class="close-output">&times;</button>
          </div>
          <div class="output-body">&gt;&gt;&gt; print(stargazer.render_latex())

<span style="color: #68d391;">\begin{table}[!htbp] \centering</span>
<span style="color: #68d391;">\caption{}</span>
<span style="color: #68d391;">\label{}</span>
<span style="color: #68d391;">\begin{tabular}{@{\extracolsep{5pt}}lc}</span>
<span style="color: #68d391;">\\[-1.8ex]\hline</span>
<span style="color: #68d391;">\hline \\[-1.8ex]</span>
<span style="color: #68d391;"> & \multicolumn{1}{c}{\textit{Dependent variable:}} \\</span>
<span style="color: #68d391;">\cline{2-2}</span>
<span style="color: #68d391;">\\[-1.8ex] & income \\</span>
<span style="color: #68d391;">\hline \\[-1.8ex]</span>
<span style="color: #68d391;"> education & 2847.632$^{***}$ \\</span>
<span style="color: #68d391;">  & (142.580) \\</span>
<span style="color: #68d391;"> age & 156.243$^{***}$ \\</span>
<span style="color: #68d391;">  & (28.450) \\</span>
<span style="color: #68d391;"> Constant & 15234.502$^{***}$ \\</span>
<span style="color: #68d391;">  & (1205.320) \\</span>
<span style="color: #68d391;">\hline \\[-1.8ex]</span>
<span style="color: #68d391;"> Observations & 1,000 \\</span>
<span style="color: #68d391;"> R$^{2}$ & 0.423 \\</span>
<span style="color: #68d391;">\hline</span>
<span style="color: #68d391;">\hline \\[-1.8ex]</span>
<span style="color: #68d391;">\textit{Note:}  & \multicolumn{1}{r}{$^{*}$p$<$0.1; $^{**}$p$<$0.05; $^{***}$p$<$0.01} \\</span>
<span style="color: #68d391;">\end{tabular}</span>
<span style="color: #68d391;">\end{table}</span></div>
        </div>
        <div class="output-simulation" data-output="analysis-8" data-lang="stata">
          <div class="output-header">
            <span>Stata Output</span>
            <button class="close-output">&times;</button>
          </div>
          <div class="output-body">. eststo clear

. eststo: reg income education
<span style="color: #68d391;">(est1 stored)</span>

. eststo: reg income education age
<span style="color: #68d391;">(est2 stored)</span>

. esttab using "table.tex", replace se star(* 0.1 ** 0.05 *** 0.01)
<span style="color: #68d391;">(output written to table.tex)</span>

<span style="color: #90cdf4;">Preview of table.tex:</span>
------------------------------------------------------------
                      (1)             (2)
                   income          income
------------------------------------------------------------
education        <span style="color: #68d391;">3124.56***</span>      <span style="color: #68d391;">2847.63***</span>
                  (148.23)        (142.58)

age                              <span style="color: #68d391;">156.24***</span>
                                  (28.45)

_cons            <span style="color: #f6ad55;">12456.78***</span>     <span style="color: #f6ad55;">15234.50***</span>
                 (1345.67)       (1205.32)
------------------------------------------------------------
N                    1000            1000
R-sq                0.385           0.423
------------------------------------------------------------
Standard errors in parentheses
* p&lt;0.1, ** p&lt;0.05, *** p&lt;0.01</div>
        </div>
        <div class="output-simulation" data-output="analysis-8" data-lang="r">
          <div class="output-header">
            <span>R Output</span>
            <button class="close-output">&times;</button>
          </div>
          <div class="output-body">&gt; library(modelsummary)
&gt; model1 <- lm(income ~ education, data = df)
&gt; model2 <- lm(income ~ education + age, data = df)
&gt; modelsummary(list(model1, model2), stars = TRUE, output = "table.tex")

<span style="color: #68d391;">File 'table.tex' written successfully.</span>

<span style="color: #90cdf4;">Preview:</span>
|                  | Model 1       | Model 2       |
|:-----------------|:-------------:|:-------------:|
| (Intercept)      | 12456.78***   | 15234.50***   |
|                  | (1345.67)     | (1205.32)     |
| education        | <span style="color: #68d391;">3124.56***</span>   | <span style="color: #68d391;">2847.63***</span>   |
|                  | (148.23)      | (142.58)      |
| age              |               | <span style="color: #68d391;">156.24***</span>    |
|                  |               | (28.45)       |
| Num.Obs.         | 1000          | 1000          |
| R2               | 0.385         | 0.423         |
| R2 Adj.          | 0.384         | 0.422         |
| AIC              | 22512.3       | 22489.1       |
| BIC              | 22527.1       | 22508.8       |

<span style="color: #90cdf4;">+ p &lt; 0.1, * p &lt; 0.05, ** p &lt; 0.01, *** p &lt; 0.001</span></div>
        </div>

        <h2 id="exercises">5.8 Exercises</h2>

        <!-- Exercise 5.1: Interactive -->
        <div class="interactive-exercise" data-exercise="5.1">
          <h4>Exercise 5.1: Descriptive Statistics and Visualization</h4>
          <p>Practice computing statistics and creating visualizations. Complete these tasks:</p>
          <ol>
            <li>Calculate descriptive statistics (mean, median, std)</li>
            <li>Create a histogram</li>
            <li>Create a scatter plot</li>
          </ol>

          <div class="exercise-editor">
            <div class="editor-tabs">
              <button class="lang-btn active" data-lang="python">Python</button>
              <button class="lang-btn" data-lang="stata">Stata</button>
              <button class="lang-btn" data-lang="r">R</button>
            </div>

            <textarea class="code-editor" data-lang="python" placeholder="# Write your Python code here
# Task 1: Calculate descriptive statistics
# Task 2: Create a histogram
# Task 3: Create a scatter plot
"></textarea>

            <textarea class="code-editor" data-lang="stata" style="display:none;" placeholder="* Write your Stata code here
* Task 1: Calculate descriptive statistics
* Task 2: Create a histogram
* Task 3: Create a scatter plot
"></textarea>

            <textarea class="code-editor" data-lang="r" style="display:none;" placeholder="# Write your R code here
# Task 1: Calculate descriptive statistics
# Task 2: Create a histogram
# Task 3: Create a scatter plot
"></textarea>
          </div>

          <div class="exercise-actions">
            <button class="btn-check-score">Check My Score</button>
            <div class="score-display" style="display:none;">
              <div class="score-circle">
                <span class="score-value">0</span>
                <span class="score-label">/100</span>
              </div>
              <div class="score-feedback"></div>
            </div>
            <button class="btn-show-solution" style="display:none;">Show Solution Step by Step</button>
          </div>

          <div class="solution-steps" style="display:none;">
            <div class="solution-header">
              <h5>Solution</h5>
              <span class="step-counter">Step <span class="current-step">0</span> of <span class="total-steps">3</span></span>
            </div>

            <!-- Python Solutions -->
            <div class="solution-step" data-lang="python" data-step="1" style="display:none;">
              <div class="step-description">Task 1: Calculate descriptive statistics</div>
              <pre class="step-code"><code><span class="code-keyword">import</span> <span class="code-tooltip" data-tip="pandas is the go-to library for data manipulation in Python, providing DataFrames (like Excel spreadsheets) for organizing data">pandas</span> <span class="code-keyword">as</span> pd

<span class="code-comment"># Descriptive statistics</span>
<span class="code-tooltip" data-tip="Shows summary stats for all numeric columns: count, mean, standard deviation, min, 25th/50th/75th percentiles, and max">df.describe()</span>
<span class="code-tooltip" data-tip="Calculates the average income - add all values and divide by number of observations">df[<span class="code-string">'income'</span>].mean()</span>
<span class="code-tooltip" data-tip="Returns the middle value when sorted - more robust to outliers than the mean">df[<span class="code-string">'income'</span>].median()</span>
<span class="code-tooltip" data-tip="Standard deviation measures how spread out values are from the mean">df[<span class="code-string">'income'</span>].std()</span></code></pre>
            </div>
            <div class="solution-step" data-lang="python" data-step="2" style="display:none;">
              <div class="step-description">Task 2: Create a histogram</div>
              <pre class="step-code"><code><span class="code-keyword">import</span> <span class="code-tooltip" data-tip="matplotlib.pyplot is Python's main plotting library - plt is the standard shorthand alias">matplotlib.pyplot</span> <span class="code-keyword">as</span> plt

<span class="code-tooltip" data-tip="Creates a histogram dividing income into 30 bins (bars) to show the distribution shape">plt.hist(df[<span class="code-string">'income'</span>], bins=<span class="code-number">30</span>)</span>
<span class="code-tooltip" data-tip="Labels the x-axis to explain what the horizontal values represent">plt.xlabel(<span class="code-string">'Income'</span>)</span>
<span class="code-tooltip" data-tip="Labels the y-axis - frequency shows how many observations fall in each income range">plt.ylabel(<span class="code-string">'Frequency'</span>)</span>
<span class="code-tooltip" data-tip="Displays the plot on screen - in Jupyter notebooks this may happen automatically">plt.show()</span></code></pre>
            </div>
            <div class="solution-step" data-lang="python" data-step="3" style="display:none;">
              <div class="step-description">Task 3: Create a scatter plot</div>
              <pre class="step-code"><code><span class="code-tooltip" data-tip="Creates a scatter plot with GDP per capita on x-axis and life expectancy on y-axis - each point is one observation">plt.scatter(df[<span class="code-string">'gdpPercap'</span>], df[<span class="code-string">'lifeExp'</span>])</span>
<span class="code-tooltip" data-tip="Labels the x-axis to identify the variable being plotted horizontally">plt.xlabel(<span class="code-string">'GDP per Capita'</span>)</span>
<span class="code-tooltip" data-tip="Labels the y-axis to identify the variable being plotted vertically">plt.ylabel(<span class="code-string">'Life Expectancy'</span>)</span>
<span class="code-tooltip" data-tip="Renders and displays the scatter plot">plt.show()</span></code></pre>
            </div>

            <!-- Stata Solutions -->
            <div class="solution-step" data-lang="stata" data-step="1" style="display:none;">
              <div class="step-description">Task 1: Calculate descriptive statistics</div>
              <pre class="step-code"><code><span class="code-comment">* Descriptive statistics</span>
<span class="code-tooltip" data-tip="Basic summary showing observation count, mean, standard deviation, min, and max values">summarize income</span>
<span class="code-tooltip" data-tip="Detailed summary adding percentiles, skewness, and kurtosis - gives fuller picture of distribution shape">summarize income, detail</span></code></pre>
            </div>
            <div class="solution-step" data-lang="stata" data-step="2" style="display:none;">
              <div class="step-description">Task 2: Create a histogram</div>
              <pre class="step-code"><code><span class="code-tooltip" data-tip="Creates a histogram showing income distribution. 'frequency' displays counts rather than density">histogram income, frequency</span>
<span class="code-tooltip" data-tip="Saves the current graph as a PNG file. 'replace' overwrites if file already exists">graph export <span class="code-string">"histogram.png"</span>, replace</span></code></pre>
            </div>
            <div class="solution-step" data-lang="stata" data-step="3" style="display:none;">
              <div class="step-description">Task 3: Create a scatter plot</div>
              <pre class="step-code"><code><span class="code-tooltip" data-tip="twoway creates 2D graphs. scatter plots life expectancy (y-axis) against GDP per capita (x-axis)">twoway (scatter lifeExp gdpPercap)</span>
<span class="code-tooltip" data-tip="Exports the scatter plot to a PNG image file for use in documents or presentations">graph export <span class="code-string">"scatter.png"</span>, replace</span></code></pre>
            </div>

            <!-- R Solutions -->
            <div class="solution-step" data-lang="r" data-step="1" style="display:none;">
              <div class="step-description">Task 1: Calculate descriptive statistics</div>
              <pre class="step-code"><code><span class="code-comment"># Descriptive statistics</span>
<span class="code-tooltip" data-tip="Shows min, 1st quartile, median, mean, 3rd quartile, and max - a quick overview of your data">summary(df$income)</span>
<span class="code-tooltip" data-tip="Calculates the arithmetic mean. na.rm=TRUE ignores missing values (NA) so the calculation works even with incomplete data">mean(df$income, na.rm = TRUE)</span>
<span class="code-tooltip" data-tip="Computes standard deviation - measures how spread out values are. na.rm=TRUE handles missing data">sd(df$income, na.rm = TRUE)</span></code></pre>
            </div>
            <div class="solution-step" data-lang="r" data-step="2" style="display:none;">
              <div class="step-description">Task 2: Create a histogram</div>
              <pre class="step-code"><code><span class="code-tooltip" data-tip="Loads ggplot2, the most popular R visualization package. Only need to load once per session">library(ggplot2)</span>

<span class="code-tooltip" data-tip="ggplot() initializes the plot with data; aes() maps income to x-axis. The + symbol adds layers">ggplot(df, aes(x = income)) +</span>
  <span class="code-tooltip" data-tip="Adds histogram layer with 30 bins. You can customize fill color, border, and transparency here">geom_histogram(bins = 30)</span></code></pre>
            </div>
            <div class="solution-step" data-lang="r" data-step="3" style="display:none;">
              <div class="step-description">Task 3: Create a scatter plot</div>
              <pre class="step-code"><code><span class="code-tooltip" data-tip="Sets up the plot with GDP per capita on x-axis and life expectancy on y-axis">ggplot(df, aes(x = gdpPercap, y = lifeExp)) +</span>
  <span class="code-tooltip" data-tip="Adds points to create a scatter plot - each point represents one observation in your data">geom_point()</span></code></pre>
            </div>

            <div class="solution-navigation">
              <button class="btn-prev-step" disabled>Previous</button>
              <button class="btn-next-step">Next Step</button>
            </div>
          </div>
        </div>

        <div class="nav-footer">
          <a href="04-data-cleaning.html" class="nav-link prev">Module 4: Data Cleaning</a>
          <a href="06-causal-inference.html" class="nav-link next">Module 6: Causal Inference</a>
        </div>
      </div>
    </main>
  </div>

  <!-- Chatbot Widget -->
  <div id="chatbot-widget" class="chatbot-widget">
    <button id="chatbot-toggle" class="chatbot-toggle" aria-label="Open course assistant">
      <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
      </svg>
    </button>
    <div id="chatbot-panel" class="chatbot-panel">
      <div class="chatbot-header">
        <h3>ProTools ER1 Assistant</h3>
        <button id="chatbot-close" class="chatbot-close">&times;</button>
      </div>
      <div id="chatbot-messages" class="chatbot-messages">
        <div class="chat-message assistant">
          <p>Hello! I'm the ProTools ER1 course assistant. I can help you with questions about Python, Stata, R, causal inference methods, or any of the course material. How can I assist you today?</p>
        </div>
      </div>
      <div class="chatbot-input-area">
        <textarea id="chatbot-input" placeholder="Ask a question about the course..." rows="2"></textarea>
        <button id="chatbot-send">Send</button>
      </div>
    </div>
  </div>

  <button class="mobile-menu-toggle" aria-label="Toggle navigation menu">Menu</button>
  <script src="../js/main.js"></script>
  <script src="../js/password-protection.js"></script>
  <script src="../js/chatbot.js"></script>

  <!-- Interactive Exercise Script -->
  <script>
  document.addEventListener('DOMContentLoaded', function() {
    const exercisePatterns = {
      '5.1': {
        python: {
          patterns: [
            // Descriptive stats - accepts: describe, mean, median, std, var, quantile, agg
            { regex: /\.describe\s*\(|\.mean\s*\(|\.median\s*\(|\.std\s*\(|\.var\s*\(|\.quantile\s*\(|\.agg\s*\(|statistics\.|np\.mean|np\.std|np\.median/i, points: 34, description: 'Calculate descriptive statistics' },
            // Histogram - accepts: plt.hist, hist(), sns.histplot, distplot, displot
            { regex: /plt\.hist\s*\(|\.hist\s*\(|sns\.histplot|sns\.distplot|sns\.displot|histogram|geom_histogram/i, points: 33, description: 'Create histogram' },
            // Scatter plot - accepts: plt.scatter, scatter(), sns.scatterplot, regplot
            { regex: /plt\.scatter\s*\(|\.scatter\s*\(|sns\.scatterplot|sns\.regplot|sns\.lmplot|geom_point|scatterplot/i, points: 33, description: 'Create scatter plot' }
          ]
        },
        stata: {
          patterns: [
            // Descriptive stats - accepts: summarize, su, sum, tabstat, tab, describe
            { regex: /summarize|sum\s+|su\s+|tabstat|tabulate|tab\s+|describe/i, points: 34, description: 'Calculate descriptive statistics' },
            // Histogram - accepts: histogram, hist, kdensity, graph bar
            { regex: /histogram|hist\s+|kdensity|graph\s+bar/i, points: 33, description: 'Create histogram' },
            // Scatter plot - accepts: scatter, twoway scatter, graph twoway
            { regex: /scatter\s+|twoway\s+\(?\s*scatter|graph\s+twoway/i, points: 33, description: 'Create scatter plot' }
          ]
        },
        r: {
          patterns: [
            // Descriptive stats - accepts: summary, mean, median, sd, var, describe, summarize/summarise
            { regex: /summary\s*\(|mean\s*\(|median\s*\(|sd\s*\(|var\s*\(|describe\s*\(|summarize\s*\(|summarise\s*\(/i, points: 34, description: 'Calculate descriptive statistics' },
            // Histogram - accepts: geom_histogram, hist(), geom_bar, geom_density
            { regex: /geom_histogram|hist\s*\(|geom_bar|geom_density|histogram/i, points: 33, description: 'Create histogram' },
            // Scatter plot - accepts: geom_point, plot(), geom_smooth, scatterplot
            { regex: /geom_point|plot\s*\(.*,|geom_smooth|scatterplot|geom_jitter/i, points: 33, description: 'Create scatter plot' }
          ]
        }
      }
    };

    // Initialize interactive exercises
    document.querySelectorAll('.interactive-exercise').forEach(exercise => {
      const exerciseId = exercise.dataset.exercise;
      let currentLang = 'python';
      let currentStep = 0;
      let hasCheckedScore = false;

      exercise.querySelectorAll('.lang-btn').forEach(btn => {
        btn.addEventListener('click', function() {
          const lang = this.dataset.lang;
          currentLang = lang;
          exercise.querySelectorAll('.lang-btn').forEach(b => b.classList.remove('active'));
          this.classList.add('active');
          exercise.querySelectorAll('.code-editor').forEach(editor => {
            editor.style.display = editor.dataset.lang === lang ? 'block' : 'none';
          });
          if (hasCheckedScore) resetSolutionSteps();
        });
      });

      const checkBtn = exercise.querySelector('.btn-check-score');
      const scoreDisplay = exercise.querySelector('.score-display');
      const scoreValue = exercise.querySelector('.score-value');
      const scoreFeedback = exercise.querySelector('.score-feedback');
      const showSolutionBtn = exercise.querySelector('.btn-show-solution');

      checkBtn.addEventListener('click', function() {
        const editor = exercise.querySelector(`.code-editor[data-lang="${currentLang}"]`);
        const code = editor.value;
        const patterns = exercisePatterns[exerciseId]?.[currentLang]?.patterns || [];

        let score = 0;
        let matched = [];
        let missed = [];

        patterns.forEach(p => {
          if (p.regex.test(code)) {
            score += p.points;
            matched.push(p.description);
          } else {
            missed.push(p.description);
          }
        });

        score = Math.min(100, score);
        scoreValue.textContent = score;
        scoreValue.className = 'score-value';
        if (score >= 80) scoreValue.classList.add('score-high');
        else if (score >= 50) scoreValue.classList.add('score-medium');
        else scoreValue.classList.add('score-low');

        if (score === 100) {
          scoreFeedback.textContent = 'Perfect! All tasks completed correctly.';
        } else if (score >= 70) {
          scoreFeedback.textContent = `Good work! Missing: ${missed.join(', ')}.`;
        } else if (score >= 40) {
          scoreFeedback.textContent = `Getting there. Missing: ${missed.join(', ')}.`;
        } else {
          scoreFeedback.textContent = `Keep trying! Check: ${missed.slice(0, 2).join(', ')}.`;
        }

        scoreDisplay.style.display = 'flex';
        showSolutionBtn.style.display = 'inline-block';
        hasCheckedScore = true;
      });

      const solutionSteps = exercise.querySelector('.solution-steps');
      const prevBtn = exercise.querySelector('.btn-prev-step');
      const nextBtn = exercise.querySelector('.btn-next-step');
      const currentStepEl = exercise.querySelector('.current-step');
      const totalStepsEl = exercise.querySelector('.total-steps');

      function resetSolutionSteps() {
        currentStep = 0;
        currentStepEl.textContent = '0';
        exercise.querySelectorAll('.solution-step').forEach(step => {
          step.style.display = 'none';
        });
        updateNavButtons();
      }

      function updateNavButtons() {
        const totalSteps = exercise.querySelectorAll(`.solution-step[data-lang="${currentLang}"]`).length;
        totalStepsEl.textContent = totalSteps;
        prevBtn.disabled = currentStep === 0;
        nextBtn.disabled = currentStep >= totalSteps;
        nextBtn.textContent = currentStep >= totalSteps ? 'Complete' : 'Next Step';
      }

      function showStep(stepNum) {
        const steps = exercise.querySelectorAll(`.solution-step[data-lang="${currentLang}"]`);
        steps.forEach((step, idx) => {
          step.style.display = (idx + 1) <= stepNum ? 'block' : 'none';
        });
        currentStepEl.textContent = stepNum;
      }

      showSolutionBtn.addEventListener('click', function() {
        solutionSteps.style.display = 'block';
        resetSolutionSteps();
        this.style.display = 'none';
      });

      nextBtn.addEventListener('click', function() {
        const totalSteps = exercise.querySelectorAll(`.solution-step[data-lang="${currentLang}"]`).length;
        if (currentStep < totalSteps) {
          currentStep++;
          showStep(currentStep);
          updateNavButtons();
        }
      });

      prevBtn.addEventListener('click', function() {
        if (currentStep > 0) {
          currentStep--;
          showStep(currentStep);
          updateNavButtons();
        }
      });

      updateNavButtons();
    });
  });
  </script>

  <!-- Smart Tooltip Positioning System -->
  <script>
  (function() {
    let tooltipEl = null;
    let currentTarget = null;
    let hideTimeout = null;

    function createTooltip() {
      if (tooltipEl) return tooltipEl;
      tooltipEl = document.createElement('div');
      tooltipEl.className = 'tooltip-popup';
      document.body.appendChild(tooltipEl);
      return tooltipEl;
    }

    function positionTooltip(target) {
      const tooltip = createTooltip();
      const tipText = target.getAttribute('data-tip');
      if (!tipText) return;

      tooltip.textContent = tipText;
      tooltip.className = 'tooltip-popup';

      const targetRect = target.getBoundingClientRect();
      let container = target.closest('pre') || target.closest('.tab-content') || target.closest('.code-tabs');
      let containerRect = container ? container.getBoundingClientRect() : {
        left: 0, right: window.innerWidth, top: 0, bottom: window.innerHeight
      };

      const viewportWidth = window.innerWidth;
      const viewportHeight = window.innerHeight;
      const padding = 10;

      tooltip.style.visibility = 'hidden';
      tooltip.style.display = 'block';
      tooltip.classList.add('visible');

      const tooltipRect = tooltip.getBoundingClientRect();
      const tooltipWidth = tooltipRect.width;
      const tooltipHeight = tooltipRect.height;

      let left = targetRect.left + (targetRect.width / 2) - (tooltipWidth / 2);
      let top = targetRect.top - tooltipHeight - 8;
      let arrowClass = 'arrow-bottom';

      if (top < padding) {
        top = targetRect.bottom + 8;
        arrowClass = 'arrow-top';
      }

      if (top + tooltipHeight > viewportHeight - padding) {
        top = targetRect.top - tooltipHeight - 8;
        arrowClass = 'arrow-bottom';
      }

      if (left < padding) {
        left = padding;
      }
      if (left + tooltipWidth > viewportWidth - padding) {
        left = viewportWidth - tooltipWidth - padding;
      }

      if (container) {
        const minLeft = Math.max(padding, containerRect.left);
        const maxRight = Math.min(viewportWidth - padding, containerRect.right);
        if (left < minLeft) left = minLeft;
        if (left + tooltipWidth > maxRight) left = maxRight - tooltipWidth;
      }

      tooltip.style.left = left + 'px';
      tooltip.style.top = top + 'px';
      tooltip.style.visibility = 'visible';
      tooltip.classList.add(arrowClass);
    }

    function showTooltip(target) {
      if (hideTimeout) { clearTimeout(hideTimeout); hideTimeout = null; }
      currentTarget = target;
      positionTooltip(target);
    }

    function hideTooltip() {
      hideTimeout = setTimeout(function() {
        if (tooltipEl) tooltipEl.classList.remove('visible');
        currentTarget = null;
      }, 100);
    }

    document.addEventListener('mouseenter', function(e) {
      if (e.target.classList && e.target.classList.contains('code-tooltip')) showTooltip(e.target);
    }, true);

    document.addEventListener('mouseleave', function(e) {
      if (e.target.classList && e.target.classList.contains('code-tooltip')) hideTooltip();
    }, true);

    document.addEventListener('scroll', function() {
      if (currentTarget && tooltipEl && tooltipEl.classList.contains('visible')) positionTooltip(currentTarget);
    }, true);

    window.addEventListener('resize', function() {
      if (currentTarget && tooltipEl && tooltipEl.classList.contains('visible')) positionTooltip(currentTarget);
    });
  })();
  </script>
</body>
</html>
