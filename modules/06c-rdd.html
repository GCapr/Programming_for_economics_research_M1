<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>6C Regression Discontinuity | ProTools ER1</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Crimson+Pro:ital,wght@0,400;0,600;0,700;1,400&family=Fira+Code:wght@400;500&family=Source+Sans+Pro:ital,wght@0,400;0,600;0,700;1,400&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="../css/style.css">
  <style>
    .protected-content { -webkit-user-select: none; -moz-user-select: none; -ms-user-select: none; user-select: none; }
    .code-tooltip { position: relative; cursor: help; border-bottom: 1px dotted #888; text-decoration: none; }
    .tooltip-popup { position: fixed; background: #1f2937; color: white; padding: 0.5rem 0.75rem; border-radius: 6px; font-size: 0.75rem; white-space: normal; max-width: 300px; opacity: 0; pointer-events: none; transition: opacity 0.15s ease-in-out; z-index: 10000; }
    .tooltip-popup.visible { opacity: 1; }
  </style>
</head>
<body>
    <div id="password-overlay" class="password-overlay">
    <div class="password-modal">
      <h2>ProTools ER1</h2>
      <p>Programming Tools for Empirical Research</p>

      <div class="course-description">
        <h3>Course Modules</h3>
        <ul class="module-list">
          <li><strong>Module 0:</strong> Languages & Platforms ‚Äî Python, Stata, R setup; IDEs (RStudio, VS Code, Jupyter)</li>
          <li><strong>Module 1:</strong> Getting Started ‚Äî Installation, basic syntax, packages</li>
          <li><strong>Module 2:</strong> Data Harnessing ‚Äî File import, APIs, web scraping</li>
          <li><strong>Module 3:</strong> Data Exploration ‚Äî Inspection, summary statistics, visualization</li>
          <li><strong>Module 4:</strong> Data Cleaning ‚Äî Data quality, transformation, validation</li>
          <li><strong>Module 5:</strong> Data Analysis ‚Äî Statistical analysis, simulation, experimental design</li>
          <li><strong>Module 6:</strong> Causal Inference ‚Äî Matching, DiD, RDD, IV, Synthetic Control</li>
          <li><strong>Module 7:</strong> Estimation Methods ‚Äî Standard errors, panel data, MLE/GMM</li>
          <li><strong>Module 8:</strong> Replicability ‚Äî Project organization, documentation, replication packages</li>
          <li><strong>Module 9:</strong> Git & GitHub ‚Äî Version control, collaboration, branching</li>
          <li><strong>Module 10:</strong> History of NLP ‚Äî From ELIZA to Transformers</li>
          <li><strong>Module 11:</strong> Machine Learning ‚Äî Prediction, regularization, neural networks</li>
          <li><strong>Module 12:</strong> Large Language Models ‚Äî How LLMs work, prompting, APIs</li>
        </ul>
      </div>

      <div class="access-note">
        This course is currently open to <strong>students at Sciences Po</strong>. If you are not a Sciences Po student but would like access, please <a href="mailto:giulia.caprini@sciencespo.fr">email me</a> to request an invite token.
      </div>

      <div class="password-form">
        <input type="password" id="password-input" placeholder="Enter password" autocomplete="off">
        <button id="password-submit">Access Course</button>
        <p id="password-error" style="color: #e53e3e; font-size: 0.85rem; margin-top: 1rem; display: none;">Incorrect password. Please try again.</p>
      </div>
    </div>
  </div>

  <div class="page-wrapper protected-content">
    <aside class="sidebar">
      <a href="../index.html" class="sidebar-logo">ProTools ER1</a>
      <span class="sidebar-subtitle">Programming Tools for Empirical Research</span>
      <nav>
        <ul>
          <li><a href="../index.html"><span class="welcome-icon">üè†</span> Welcome</a></li>
          <li class="has-subnav">
            <a href="00-languages-platforms.html"><span class="module-number">0</span> Languages & Platforms</a>
            <ul class="sub-nav">
              <li><a href="00a-rstudio-guide.html">RStudio Guide</a></li>
              <li><a href="00b-stata-guide.html">Stata Guide</a></li>
              <li><a href="00c-vscode-guide.html">VS Code Guide</a></li>
              <li><a href="00d-notebooks-guide.html">Notebooks Guide</a></li>
            </ul>
          </li>
          <li><a href="01-getting-started.html"><span class="module-number">1</span> Getting Started</a></li>
          <li class="has-subnav">
            <a href="02-data-harnessing.html"><span class="module-number">2</span> Data Harnessing</a>
            <ul class="sub-nav">
              <li><a href="02a-file-import.html">File Import</a></li>
              <li><a href="02b-apis.html">APIs</a></li>
              <li><a href="02c-web-scraping.html">Web Scraping</a></li>
            </ul>
          </li>
          <li><a href="03-data-exploration.html"><span class="module-number">3</span> Data Exploration</a></li>
          <li><a href="04-data-cleaning.html"><span class="module-number">4</span> Data Cleaning</a></li>
          <li class="has-subnav">
            <a href="05-data-analysis.html"><span class="module-number">5</span> Data Analysis</a>
            <ul class="sub-nav">
              <li><a href="05a-data-simulation.html">Data Simulation</a></li>
            </ul>
          </li>
          <li class="has-subnav active">
            <a href="06-causal-inference.html"><span class="module-number">6</span> Causal Inference</a>
            <ul class="sub-nav">
              <li><a href="06a-matching.html">Matching</a></li>
              <li><a href="06b-did.html">Difference-in-Differences</a></li>
              <li class="active"><a href="06c-rdd.html">Regression Discontinuity</a></li>
              <li><a href="06d-iv.html">Instrumental Variables</a></li>
              <li><a href="06e-synthetic-control.html">Synthetic Control</a></li>
              <li><a href="05b-experiments.html">Experiments</a></li>
            </ul>
          </li>
          <li><a href="07-estimation.html"><span class="module-number">7</span> Estimation Methods</a></li>
          <li><a href="08-replicability.html"><span class="module-number">8</span> Replicability</a></li>
          <li><a href="09-github.html"><span class="module-number">9</span> Git & GitHub</a></li>
          <li><a href="10-nlp-history.html"><span class="module-number">10</span> History of NLP</a></li>
          <li><a href="11-machine-learning.html"><span class="module-number">11</span> Machine Learning</a></li>
          <li><a href="12-llms.html"><span class="module-number">12</span> Large Language Models</a></li>
          <li><a href="../resources.html">Resources</a></li>
          <li><a href="contact.html">Contact & Feedback</a></li>
        </ul>
      </nav>
    </aside>

    <main class="main-content">
      <div class="content">
        <nav class="breadcrumb" style="margin-bottom: 1rem; font-size: 0.9rem; color: #666;">
          <a href="06-causal-inference.html">6 Causal Inference</a> &raquo; Regression Discontinuity
        </nav>

        <div class="module-header">
          <h1>6C &nbsp;Regression Discontinuity</h1>
          <div class="module-meta">
            <span>~2 hours</span>
            <span>Sharp, Fuzzy, Diagnostics</span>
          </div>
        </div>

        <div class="toc">
          <h3>Table of Contents</h3>
          <ul>
            <li><a href="#sharp">Sharp RDD</a></li>
            <li><a href="#bandwidth">Bandwidth Selection</a></li>
            <li><a href="#fuzzy">Fuzzy RDD</a></li>
            <li><a href="#diagnostics">Diagnostics and Validity Tests</a></li>
            <li><a href="#visualization">Visualization</a></li>
          </ul>
        </div>

        <h2 id="sharp">Sharp RDD</h2>

        <p>
          In a sharp RDD, treatment is deterministically assigned at the cutoff: everyone above is treated, everyone below is not.
        </p>

        <div class="code-tabs" data-runnable="rdd-1">
          <div class="tab-buttons">
            <button class="tab-button active" data-lang="python">Python</button>
            <button class="tab-button" data-lang="stata">Stata</button>
            <button class="tab-button" data-lang="r">R</button>
          </div>
          <div class="tab-content active" data-lang="python">
<pre><code><span class="code-comment"># Python: Sharp RDD with rdrobust</span>
<span class="code-comment"># pip install rdrobust</span>
<span class="code-keyword">from</span> rdrobust <span class="code-keyword">import</span> rdrobust, rdbwselect

<span class="code-comment"># running_var: the score that determines treatment (e.g., test score)</span>
<span class="code-comment"># cutoff: the threshold (e.g., 50 points)</span>

<span class="code-comment"># Center the running variable at cutoff</span>
df[<span class="code-string">'x_centered'</span>] = df[<span class="code-string">'running_var'</span>] - cutoff

<span class="code-comment"># Sharp RDD estimation</span>
<span class="code-tooltip" data-tip="rdrobust implements optimal bandwidth selection and bias-corrected estimation">result = rdrobust(
    y=df[<span class="code-string">'outcome'</span>],
    x=df[<span class="code-string">'x_centered'</span>],
    c=0  <span class="code-comment"># cutoff (centered)</span>
)</span>
print(result)

<span class="code-comment"># With covariates</span>
result = rdrobust(
    y=df[<span class="code-string">'outcome'</span>],
    x=df[<span class="code-string">'x_centered'</span>],
    c=0,
    covs=df[[<span class="code-string">'age'</span>, <span class="code-string">'gender'</span>]]
)</code></pre>
            <button class="run-btn" data-lang="python">Run Code</button>
          </div>
          <div class="tab-content" data-lang="stata">
<pre><code><span class="code-comment">* Stata: Sharp RDD with rdrobust</span>
<span class="code-comment">* ssc install rdrobust</span>

<span class="code-comment">* Center running variable</span>
gen x_centered = running_var - 50

<span class="code-comment">* Sharp RDD</span>
<span class="code-tooltip" data-tip="rdrobust uses MSE-optimal bandwidth and robust bias-corrected inference">rdrobust outcome x_centered, c(0)</span>

<span class="code-comment">* With covariates</span>
rdrobust outcome x_centered, c(0) covs(age gender)

<span class="code-comment">* Specify kernel and polynomial order</span>
rdrobust outcome x_centered, c(0) kernel(triangular) p(1)</code></pre>
            <button class="run-btn" data-lang="stata">Run Code</button>
          </div>
          <div class="tab-content" data-lang="r">
<pre><code><span class="code-comment"># R: Sharp RDD with rdrobust</span>
<span class="code-keyword">library</span>(rdrobust)

<span class="code-comment"># Center running variable</span>
df$x_centered <- df$running_var - 50

<span class="code-comment"># Sharp RDD</span>
<span class="code-tooltip" data-tip="rdrobust() implements Calonico, Cattaneo, Titiunik (2014) optimal bandwidth">rd_result <- rdrobust(y = df$outcome,
                      x = df$x_centered,
                      c = 0)</span>
summary(rd_result)

<span class="code-comment"># With covariates</span>
rd_result <- rdrobust(y = df$outcome,
                      x = df$x_centered,
                      c = 0,
                      covs = cbind(df$age, df$gender))</code></pre>
            <button class="run-btn" data-lang="r">Run Code</button>
          </div>
        </div>

        <div class="output-simulation" data-output="rdd-1" data-lang="python">
          <div class="output-header">
            <span>Python Output</span>
            <button class="close-output">&times;</button>
          </div>
          <div class="output-body"><pre>Sharp RDD Estimates using Local Polynomial Regression
=====================================================

Number of Obs.                 2847
BW type                       mserd
Kernel                   Triangular
VCE method                       NN

Number of Obs.                 1423        1424
Eff. Number of Obs.             612         587
Order est. (p)                    1           1
Order bias (q)                    2           2
BW est. (h)                   8.421       8.421
BW bias (b)                  13.892      13.892
rho (h/b)                     0.606       0.606

=============================================================================
        Method     Coef. Std. Err.         z     P>|z|      [ 95% C.I. ]
=============================================================================
  Conventional     2.847     0.792     3.595     0.000     [1.295 , 4.399]
        Robust         -         -     3.142     0.002     [1.084 , 4.743]
=============================================================================</pre></div>
        </div>

        <div class="output-simulation" data-output="rdd-1" data-lang="stata">
          <div class="output-header">
            <span>Stata Output</span>
            <button class="close-output">&times;</button>
          </div>
          <div class="output-body"><pre>Sharp RD estimates using local polynomial regression.

      Cutoff c = 0 | Left of c  Right of c       Number of obs =       2847
-------------------+----------------------       BW type       =      mserd
     Number of obs |      1423        1424       Kernel        = Triangular
Eff. Number of obs |       612         587       VCE method    =         NN
    Order est. (p) |         1           1
    Order bias (q) |         2           2
       BW est. (h) |     8.421       8.421
       BW bias (b) |    13.892      13.892
         rho (h/b) |     0.606       0.606

Outcome: outcome. Running variable: x_centered.
--------------------------------------------------------------------------------
            Method |   Coef.    Std. Err.    z      P>|z|    [95% Conf. Interval]
-------------------+------------------------------------------------------------
      Conventional |   2.847      0.792    3.595    0.000      1.295       4.399
            Robust |      -          -     3.142    0.002      1.084       4.743
--------------------------------------------------------------------------------</pre></div>
        </div>

        <div class="output-simulation" data-output="rdd-1" data-lang="r">
          <div class="output-header">
            <span>R Output</span>
            <button class="close-output">&times;</button>
          </div>
          <div class="output-body"><pre>Sharp RD estimates using local polynomial regression.

Number of Obs.                 2847
BW type                       mserd
Kernel                   Triangular
VCE method                       NN

Number of Obs.                 1423         1424
Eff. Number of Obs.             612          587
Order est. (p)                    1            1
Order bias (q)                    2            2
BW est. (h)                   8.421        8.421
BW bias (b)                  13.892       13.892
rho (h/b)                     0.606        0.606

=============================================================================
        Method     Coef. Std. Err.         z     P>|z|      [ 95% C.I. ]
=============================================================================
  Conventional     2.847     0.792     3.595     0.000     [1.295 , 4.399]
        Robust         -         -     3.142     0.002     [1.084 , 4.743]
=============================================================================</pre></div>
        </div>

        <h2 id="bandwidth">Bandwidth Selection</h2>

        <p>
          The bandwidth determines how much data around the cutoff is used. Narrower bandwidth = more local but less precise. Modern methods select optimal bandwidth automatically.
        </p>

        <div class="code-tabs" data-runnable="rdd-2">
          <div class="tab-buttons">
            <button class="tab-button active" data-lang="python">Python</button>
            <button class="tab-button" data-lang="stata">Stata</button>
            <button class="tab-button" data-lang="r">R</button>
          </div>
          <div class="tab-content active" data-lang="python">
<pre><code><span class="code-comment"># Python: Bandwidth Selection</span>
<span class="code-keyword">from</span> rdrobust <span class="code-keyword">import</span> rdbwselect

<span class="code-comment"># Optimal bandwidth selection</span>
<span class="code-tooltip" data-tip="rdbwselect computes MSE-optimal and CER-optimal bandwidths">bw_result = rdbwselect(
    y=df[<span class="code-string">'outcome'</span>],
    x=df[<span class="code-string">'x_centered'</span>],
    c=0
)</span>
print(bw_result)

<span class="code-comment"># Use specific bandwidth</span>
result = rdrobust(
    y=df[<span class="code-string">'outcome'</span>],
    x=df[<span class="code-string">'x_centered'</span>],
    c=0,
    h=5  <span class="code-comment"># manual bandwidth</span>
)

<span class="code-comment"># Robustness: different bandwidths</span>
<span class="code-keyword">for</span> h <span class="code-keyword">in</span> [3, 5, 7, 10]:
    result = rdrobust(y=df[<span class="code-string">'outcome'</span>], x=df[<span class="code-string">'x_centered'</span>], c=0, h=h)
    print(f<span class="code-string">"h={h}: estimate={result.coef[0]:.3f}"</span>)</code></pre>
            <button class="run-btn" data-lang="python">Run Code</button>
          </div>
          <div class="tab-content" data-lang="stata">
<pre><code><span class="code-comment">* Stata: Bandwidth Selection</span>

<span class="code-comment">* Optimal bandwidth</span>
<span class="code-tooltip" data-tip="rdbwselect reports MSE-optimal, CER-optimal, and other bandwidth choices">rdbwselect outcome x_centered, c(0)</span>

<span class="code-comment">* With different methods</span>
rdbwselect outcome x_centered, c(0) bwselect(mserd)  <span class="code-comment">// MSE</span>
rdbwselect outcome x_centered, c(0) bwselect(cerrd)  <span class="code-comment">// CER</span>

<span class="code-comment">* Robustness check: vary bandwidth</span>
<span class="code-tooltip" data-tip="Check if results are sensitive to bandwidth choice">foreach h in 3 5 7 10 {
    rdrobust outcome x_centered, c(0) h(`h')
}</span></code></pre>
            <button class="run-btn" data-lang="stata">Run Code</button>
          </div>
          <div class="tab-content" data-lang="r">
<pre><code><span class="code-comment"># R: Bandwidth Selection</span>
<span class="code-keyword">library</span>(rdrobust)

<span class="code-comment"># Optimal bandwidth</span>
<span class="code-tooltip" data-tip="rdbwselect() computes optimal bandwidths using different criteria">bw <- rdbwselect(y = df$outcome, x = df$x_centered, c = 0)</span>
summary(bw)

<span class="code-comment"># Use specific bandwidth</span>
rd_result <- rdrobust(y = df$outcome, x = df$x_centered, c = 0, h = 5)

<span class="code-comment"># Robustness: multiple bandwidths</span>
bandwidths <- c(3, 5, 7, 10)
results <- lapply(bandwidths, function(h) {
  rdrobust(y = df$outcome, x = df$x_centered, c = 0, h = h)
})
<span class="code-comment"># Extract and compare estimates</span></code></pre>
            <button class="run-btn" data-lang="r">Run Code</button>
          </div>
        </div>

        <div class="output-simulation" data-output="rdd-2" data-lang="python">
          <div class="output-header">
            <span>Python Output</span>
            <button class="close-output">&times;</button>
          </div>
          <div class="output-body"><pre>Bandwidth Selection using local polynomial regression

Number of Obs.                 2847
Kernel                   Triangular
Order loc. poly. (p)              1
Order bias (q)                    2

=======================================================
         BW Type         BW (h)      BW (b)
=======================================================
         mserd           8.421      13.892
         msetwo          7.934      12.156
         msesum          8.187      13.024
         msecommon       8.302      13.458
         cerrd           5.847       9.642
         certwo          5.506       8.438
         cersum          5.682       9.040
         cercommon       5.764       9.341
=======================================================

Robustness to bandwidth choice:
h=3: estimate=3.124
h=5: estimate=2.956
h=7: estimate=2.891
h=10: estimate=2.784</pre></div>
        </div>

        <div class="output-simulation" data-output="rdd-2" data-lang="stata">
          <div class="output-header">
            <span>Stata Output</span>
            <button class="close-output">&times;</button>
          </div>
          <div class="output-body"><pre>Bandwidth estimators for local polynomial regression

      Cutoff c = 0 | Left of c  Right of c       Number of obs =       2847
-------------------+----------------------       Kernel        = Triangular
     Number of obs |      1423        1424       VCE method    =         NN
Order loc. poly (p)|         1           1
   Order bias (q)  |         2           2

--------------------------------------------------------------------------------
            Method |         h          b                rho
-------------------+------------------------------------------------------------
             mserd |     8.421     13.892              0.606
            msetwo |     7.934     12.156              0.653
            msesum |     8.187     13.024              0.629
         msecommon |     8.302     13.458              0.617
             cerrd |     5.847      9.642              0.606
            certwo |     5.506      8.438              0.653
            cersum |     5.682      9.040              0.629
         cercommon |     5.764      9.341              0.617
--------------------------------------------------------------------------------

Robustness across bandwidths:
h=3:  Coef. = 3.124  (SE = 1.234)
h=5:  Coef. = 2.956  (SE = 0.923)
h=7:  Coef. = 2.891  (SE = 0.834)
h=10: Coef. = 2.784  (SE = 0.756)</pre></div>
        </div>

        <div class="output-simulation" data-output="rdd-2" data-lang="r">
          <div class="output-header">
            <span>R Output</span>
            <button class="close-output">&times;</button>
          </div>
          <div class="output-body"><pre>Bandwidth Selection for RD Local Polynomial Regression

Number of Obs.                 2847
Kernel                   Triangular
Order loc. poly. (p)              1
Order bias (q)                    2

Bandwidth Estimates:
          Type       h (left)    h (right)        b
         mserd          8.421        8.421   13.892
         msetwo         7.934        7.934   12.156
         msesum         8.187        8.187   13.024
      msecommon         8.302        8.302   13.458
         cerrd          5.847        5.847    9.642
         certwo         5.506        5.506    8.438
         cersum         5.682        5.682    9.040
      cercommon         5.764        5.764    9.341

Robustness check across bandwidths:
  h=3:  Estimate = 3.124, SE = 1.234, p = 0.011
  h=5:  Estimate = 2.956, SE = 0.923, p = 0.001
  h=7:  Estimate = 2.891, SE = 0.834, p < 0.001
  h=10: Estimate = 2.784, SE = 0.756, p < 0.001</pre></div>
        </div>

        <h2 id="fuzzy">Fuzzy RDD</h2>

        <p>
          In fuzzy RDD, the probability of treatment jumps at the cutoff but isn't deterministic. This is essentially IV using the threshold as an instrument for treatment.
        </p>

        <div class="code-tabs" data-runnable="rdd-3">
          <div class="tab-buttons">
            <button class="tab-button active" data-lang="python">Python</button>
            <button class="tab-button" data-lang="stata">Stata</button>
            <button class="tab-button" data-lang="r">R</button>
          </div>
          <div class="tab-content active" data-lang="python">
<pre><code><span class="code-comment"># Python: Fuzzy RDD</span>
<span class="code-keyword">from</span> rdrobust <span class="code-keyword">import</span> rdrobust

<span class="code-comment"># Fuzzy RDD: treatment is not perfectly determined by cutoff</span>
<span class="code-tooltip" data-tip="fuzzy parameter takes the actual treatment indicator">result = rdrobust(
    y=df[<span class="code-string">'outcome'</span>],
    x=df[<span class="code-string">'x_centered'</span>],
    c=0,
    fuzzy=df[<span class="code-string">'treatment'</span>]  <span class="code-comment"># actual treatment status</span>
)</span>
print(result)

<span class="code-comment"># First stage: check jump in treatment probability</span>
first_stage = rdrobust(
    y=df[<span class="code-string">'treatment'</span>],
    x=df[<span class="code-string">'x_centered'</span>],
    c=0
)
print(<span class="code-string">"First stage jump:"</span>, first_stage.coef[0])</code></pre>
            <button class="run-btn" data-lang="python">Run Code</button>
          </div>
          <div class="tab-content" data-lang="stata">
<pre><code><span class="code-comment">* Stata: Fuzzy RDD</span>

<span class="code-comment">* Fuzzy RDD with treatment indicator</span>
<span class="code-tooltip" data-tip="fuzzy() option specifies the endogenous treatment variable">rdrobust outcome x_centered, c(0) fuzzy(treatment)</span>

<span class="code-comment">* Check first stage</span>
rdrobust treatment x_centered, c(0)

<span class="code-comment">* Plot first stage discontinuity</span>
rdplot treatment x_centered, c(0) graph_options(title("First Stage"))</code></pre>
            <button class="run-btn" data-lang="stata">Run Code</button>
          </div>
          <div class="tab-content" data-lang="r">
<pre><code><span class="code-comment"># R: Fuzzy RDD</span>
<span class="code-keyword">library</span>(rdrobust)

<span class="code-comment"># Fuzzy RDD</span>
<span class="code-tooltip" data-tip="fuzzy parameter specifies the endogenous treatment">rd_fuzzy <- rdrobust(y = df$outcome,
                     x = df$x_centered,
                     c = 0,
                     fuzzy = df$treatment)</span>
summary(rd_fuzzy)

<span class="code-comment"># First stage: jump in treatment at cutoff</span>
first_stage <- rdrobust(y = df$treatment,
                        x = df$x_centered,
                        c = 0)
summary(first_stage)</code></pre>
            <button class="run-btn" data-lang="r">Run Code</button>
          </div>
        </div>

        <div class="output-simulation" data-output="rdd-3" data-lang="python">
          <div class="output-header">
            <span>Python Output</span>
            <button class="close-output">&times;</button>
          </div>
          <div class="output-body"><pre>Fuzzy RDD Estimates using Local Polynomial Regression
=====================================================

Number of Obs.                 2847
BW type                       mserd
Kernel                   Triangular
VCE method                       NN

Number of Obs.                 1423        1424
Eff. Number of Obs.             589         612
Order est. (p)                    1           1
Order bias (q)                    2           2
BW est. (h)                   7.892       7.892
BW bias (b)                  12.456      12.456
rho (h/b)                     0.634       0.634

=============================================================================
        Method     Coef. Std. Err.         z     P>|z|      [ 95% C.I. ]
=============================================================================
  Conventional     4.523     1.156     3.912     0.000     [2.257 , 6.789]
        Robust         -         -     3.421     0.001     [1.892 , 7.234]
=============================================================================

First stage jump: 0.628
(Treatment probability jumps by 62.8 percentage points at the cutoff)</pre></div>
        </div>

        <div class="output-simulation" data-output="rdd-3" data-lang="stata">
          <div class="output-header">
            <span>Stata Output</span>
            <button class="close-output">&times;</button>
          </div>
          <div class="output-body"><pre>Fuzzy RD estimates using local polynomial regression.

      Cutoff c = 0 | Left of c  Right of c       Number of obs =       2847
-------------------+----------------------       BW type       =      mserd
     Number of obs |      1423        1424       Kernel        = Triangular
Eff. Number of obs |       589         612       VCE method    =         NN
    Order est. (p) |         1           1
    Order bias (q) |         2           2
       BW est. (h) |     7.892       7.892
       BW bias (b) |    12.456      12.456
         rho (h/b) |     0.634       0.634

Outcome: outcome. Running variable: x_centered. Treatment: treatment
--------------------------------------------------------------------------------
            Method |   Coef.    Std. Err.    z      P>|z|    [95% Conf. Interval]
-------------------+------------------------------------------------------------
      Conventional |   4.523      1.156    3.912    0.000      2.257       6.789
            Robust |      -          -     3.421    0.001      1.892       7.234
--------------------------------------------------------------------------------

First Stage Estimate:
--------------------------------------------------------------------------------
      Conventional |   0.628      0.089    7.056    0.000      0.453       0.803
--------------------------------------------------------------------------------</pre></div>
        </div>

        <div class="output-simulation" data-output="rdd-3" data-lang="r">
          <div class="output-header">
            <span>R Output</span>
            <button class="close-output">&times;</button>
          </div>
          <div class="output-body"><pre>Fuzzy RD estimates using local polynomial regression.

Number of Obs.                 2847
BW type                       mserd
Kernel                   Triangular
VCE method                       NN

Number of Obs.                 1423         1424
Eff. Number of Obs.             589          612
Order est. (p)                    1            1
Order bias (q)                    2            2
BW est. (h)                   7.892        7.892
BW bias (b)                  12.456       12.456
rho (h/b)                     0.634        0.634

Fuzzy RD Estimates:
=============================================================================
        Method     Coef. Std. Err.         z     P>|z|      [ 95% C.I. ]
=============================================================================
  Conventional     4.523     1.156     3.912     0.000     [2.257 , 6.789]
        Robust         -         -     3.421     0.001     [1.892 , 7.234]
=============================================================================

First Stage Results:
Jump in treatment probability at cutoff: 0.628 (SE = 0.089)
First-stage F-statistic: 49.79</pre></div>
        </div>

        <h2 id="diagnostics">Diagnostics and Validity Tests</h2>

        <p>
          Key validity checks: (1) no manipulation of the running variable, (2) continuity of covariates at cutoff.
        </p>

        <div class="code-tabs" data-runnable="rdd-4">
          <div class="tab-buttons">
            <button class="tab-button active" data-lang="python">Python</button>
            <button class="tab-button" data-lang="stata">Stata</button>
            <button class="tab-button" data-lang="r">R</button>
          </div>
          <div class="tab-content active" data-lang="python">
<pre><code><span class="code-comment"># Python: RDD Diagnostics</span>
<span class="code-keyword">from</span> rddensity <span class="code-keyword">import</span> rddensity
<span class="code-keyword">from</span> rdrobust <span class="code-keyword">import</span> rdrobust

<span class="code-comment"># 1. McCrary density test (manipulation check)</span>
<span class="code-tooltip" data-tip="Tests for bunching at cutoff - indicates manipulation if density jumps">density_test = rddensity(X=df[<span class="code-string">'x_centered'</span>], c=0)
print(density_test)</span>

<span class="code-comment"># 2. Covariate balance at cutoff</span>
<span class="code-tooltip" data-tip="Test that predetermined covariates don't jump at cutoff">covariates = [<span class="code-string">'age'</span>, <span class="code-string">'gender'</span>, <span class="code-string">'prior_income'</span>]
<span class="code-keyword">for</span> cov <span class="code-keyword">in</span> covariates:
    result = rdrobust(y=df[cov], x=df[<span class="code-string">'x_centered'</span>], c=0)
    print(f<span class="code-string">"{cov}: coef={result.coef[0]:.3f}, p={result.pv[0]:.3f}"</span>)</span>

<span class="code-comment"># 3. Placebo cutoffs</span>
<span class="code-tooltip" data-tip="Test at fake cutoffs where there should be no effect">placebo_cutoffs = [-10, -5, 5, 10]  <span class="code-comment"># relative to true cutoff</span>
<span class="code-keyword">for</span> pc <span class="code-keyword">in</span> placebo_cutoffs:
    result = rdrobust(y=df[<span class="code-string">'outcome'</span>], x=df[<span class="code-string">'x_centered'</span>], c=pc)
    print(f<span class="code-string">"Placebo c={pc}: coef={result.coef[0]:.3f}"</span>)</span></code></pre>
            <button class="run-btn" data-lang="python">Run Code</button>
          </div>
          <div class="tab-content" data-lang="stata">
<pre><code><span class="code-comment">* Stata: RDD Diagnostics</span>
<span class="code-comment">* ssc install rddensity</span>

<span class="code-comment">* 1. McCrary density test</span>
<span class="code-tooltip" data-tip="Tests for manipulation - significant result suggests bunching at cutoff">rddensity x_centered, c(0) plot</span>

<span class="code-comment">* 2. Covariate balance tests</span>
<span class="code-tooltip" data-tip="Predetermined covariates should be continuous at cutoff">foreach var in age gender prior_income {
    rdrobust `var' x_centered, c(0)
}</span>

<span class="code-comment">* 3. Placebo cutoffs</span>
foreach c in -10 -5 5 10 {
    rdrobust outcome x_centered, c(`c')
}

<span class="code-comment">* 4. Donut hole test (exclude obs near cutoff)</span>
<span class="code-tooltip" data-tip="Drop observations very close to cutoff to check if manipulation drives results">rdrobust outcome x_centered if abs(x_centered) > 1, c(0)</span></code></pre>
            <button class="run-btn" data-lang="stata">Run Code</button>
          </div>
          <div class="tab-content" data-lang="r">
<pre><code><span class="code-comment"># R: RDD Diagnostics</span>
<span class="code-keyword">library</span>(rdrobust)
<span class="code-keyword">library</span>(rddensity)

<span class="code-comment"># 1. McCrary density test</span>
<span class="code-tooltip" data-tip="Tests for bunching/manipulation at the cutoff">dens_test <- rddensity(X = df$x_centered, c = 0)
summary(dens_test)</span>

<span class="code-comment"># Plot density</span>
rdplotdensity(rdd = dens_test, X = df$x_centered)

<span class="code-comment"># 2. Covariate balance tests</span>
covariates <- c("age", "gender", "prior_income")
lapply(covariates, function(var) {
  rdrobust(y = df[[var]], x = df$x_centered, c = 0)
})

<span class="code-comment"># 3. Placebo cutoffs</span>
placebo <- c(-10, -5, 5, 10)
lapply(placebo, function(c) {
  rdrobust(y = df$outcome, x = df$x_centered, c = c)
})</code></pre>
            <button class="run-btn" data-lang="r">Run Code</button>
          </div>
        </div>

        <div class="output-simulation" data-output="rdd-4" data-lang="python">
          <div class="output-header">
            <span>Python Output</span>
            <button class="close-output">&times;</button>
          </div>
          <div class="output-body"><pre>Manipulation Testing using Local Polynomial Density Estimation
==============================================================

Number of Obs.                 2847
Cutoff                            0
Model                        unrestricted
Kernel                       Triangular
BW method                    comb

Running Variable: x_centered
------------------------------------------
            Left of c    Right of c
------------------------------------------
Number of Obs.   1423         1424
Eff. Obs.         812          798
BW est.         9.234        8.921
------------------------------------------

Test                 Statistic    p-value
------------------------------------------
Binomial                 0.024      0.807
T-statistic             -0.412      0.680
------------------------------------------
Note: No evidence of manipulation at the cutoff.

Covariate Balance at Cutoff:
age: coef=0.234, p=0.672 (no discontinuity)
gender: coef=0.012, p=0.891 (no discontinuity)
prior_income: coef=-124.56, p=0.534 (no discontinuity)

Placebo Cutoff Tests:
Placebo c=-10: coef=0.234 (p=0.782)
Placebo c=-5: coef=-0.156 (p=0.856)
Placebo c=5: coef=0.089 (p=0.923)
Placebo c=10: coef=-0.312 (p=0.645)</pre></div>
        </div>

        <div class="output-simulation" data-output="rdd-4" data-lang="stata">
          <div class="output-header">
            <span>Stata Output</span>
            <button class="close-output">&times;</button>
          </div>
          <div class="output-body"><pre>Manipulation testing using local polynomial density estimation.

      Cutoff c = 0 | Left of c  Right of c       Number of obs =       2847
-------------------+----------------------       Model         = unrestricted
     Number of obs |      1423        1424       Kernel        =  Triangular
Eff. Number of obs |       812         798       BW method     =        comb
         BW est.   |     9.234       8.921
--------------------------------------------------------------------------------

Method              |       T          P>|T|
--------------------+---------------------------
Robust              |    -0.412        0.680
--------------------+---------------------------
Ho: no discontinuity in density at c = 0

Covariate Balance Tests:
--------------------------------------------------------------------------------
    Variable |   Coef.    Std. Err.    z      P>|z|
-------------+----------------------------------------------
         age |   0.234      0.552    0.424    0.672
      gender |   0.012      0.087    0.138    0.891
prior_income | -124.56    199.234   -0.625    0.534
--------------------------------------------------------------------------------

Placebo Cutoff Tests:
c=-10: Coef. = 0.234  (p = 0.782)
c=-5:  Coef. = -0.156 (p = 0.856)
c=5:   Coef. = 0.089  (p = 0.923)
c=10:  Coef. = -0.312 (p = 0.645)</pre></div>
        </div>

        <div class="output-simulation" data-output="rdd-4" data-lang="r">
          <div class="output-header">
            <span>R Output</span>
            <button class="close-output">&times;</button>
          </div>
          <div class="output-body"><pre>Manipulation test using local polynomial density estimation

Cutoff c = 0           Number of obs = 2847
Model = unrestricted   Kernel = Triangular

                   Left of c    Right of c
Number of Obs.          1423          1424
Eff. Obs.                812           798
BW est.                9.234         8.921

Test Results:
                 Statistic     p-value
T-statistic         -0.412       0.680
------------------------------------------
Conclusion: No evidence of manipulation (fail to reject null)

Covariate Balance Tests:
              Coef.    Std. Err.       z     Pr(>|z|)
age           0.234       0.552    0.424        0.672
gender        0.012       0.087    0.138        0.891
prior_income -124.56    199.234   -0.625        0.534

Placebo Cutoff Tests:
  Cutoff   Estimate   Std. Err.   p-value
     -10      0.234       0.845     0.782
      -5     -0.156       0.867     0.856
       5      0.089       0.912     0.923
      10     -0.312       0.678     0.645</pre></div>
        </div>

        <h2 id="visualization">Visualization</h2>

        <p>
          Always visualize the discontinuity. Good RDD plots show the raw data and fitted relationships on both sides of the cutoff.
        </p>

        <div class="code-tabs" data-runnable="rdd-5">
          <div class="tab-buttons">
            <button class="tab-button active" data-lang="python">Python</button>
            <button class="tab-button" data-lang="stata">Stata</button>
            <button class="tab-button" data-lang="r">R</button>
          </div>
          <div class="tab-content active" data-lang="python">
<pre><code><span class="code-comment"># Python: RDD Plot</span>
<span class="code-keyword">from</span> rdrobust <span class="code-keyword">import</span> rdplot
<span class="code-keyword">import</span> matplotlib.pyplot <span class="code-keyword">as</span> plt

<span class="code-comment"># rdplot creates binned scatter with polynomial fit</span>
<span class="code-tooltip" data-tip="rdplot bins data and fits separate polynomials on each side">rdplot(
    y=df[<span class="code-string">'outcome'</span>],
    x=df[<span class="code-string">'x_centered'</span>],
    c=0,
    nbins=[20, 20],  <span class="code-comment"># bins on each side</span>
    binselect=<span class="code-string">'es'</span>   <span class="code-comment"># evenly spaced</span>
)</span>

<span class="code-comment"># Custom plot</span>
fig, ax = plt.subplots(figsize=(10, 6))

<span class="code-comment"># Scatter with bins</span>
df[<span class="code-string">'bin'</span>] = pd.cut(df[<span class="code-string">'x_centered'</span>], bins=40)
binned = df.groupby(<span class="code-string">'bin'</span>).agg({
    <span class="code-string">'x_centered'</span>: <span class="code-string">'mean'</span>,
    <span class="code-string">'outcome'</span>: <span class="code-string">'mean'</span>
}).dropna()
ax.scatter(binned[<span class="code-string">'x_centered'</span>], binned[<span class="code-string">'outcome'</span>], alpha=0.7)

<span class="code-comment"># Fit lines on each side</span>
<span class="code-keyword">import</span> numpy <span class="code-keyword">as</span> np
<span class="code-keyword">for</span> side, data <span class="code-keyword">in</span> df.groupby(df[<span class="code-string">'x_centered'</span>] >= 0):
    z = np.polyfit(data[<span class="code-string">'x_centered'</span>], data[<span class="code-string">'outcome'</span>], 1)
    p = np.poly1d(z)
    x_range = np.linspace(data[<span class="code-string">'x_centered'</span>].min(), data[<span class="code-string">'x_centered'</span>].max(), 100)
    ax.plot(x_range, p(x_range), <span class="code-string">'r-'</span>, linewidth=2)

ax.axvline(x=0, color=<span class="code-string">'gray'</span>, linestyle=<span class="code-string">'--'</span>)
ax.set_xlabel(<span class="code-string">'Running Variable (centered)'</span>)
ax.set_ylabel(<span class="code-string">'Outcome'</span>)
plt.show()</code></pre>
            <button class="run-btn" data-lang="python">Run Code</button>
          </div>
          <div class="tab-content" data-lang="stata">
<pre><code><span class="code-comment">* Stata: RDD Plot</span>

<span class="code-comment">* rdplot creates optimal binned scatter plot</span>
<span class="code-tooltip" data-tip="rdplot bins data optimally and fits polynomials">rdplot outcome x_centered, c(0)</span>

<span class="code-comment">* With options</span>
rdplot outcome x_centered, c(0) ///
    nbins(20 20) ///
    graph_options(title("RDD: Effect of Scholarship") ///
                  xtitle("Test Score (centered)") ///
                  ytitle("College Enrollment"))

<span class="code-comment">* CI shade plot</span>
rdplot outcome x_centered, c(0) ci(95) shade</code></pre>
            <button class="run-btn" data-lang="stata">Run Code</button>
          </div>
          <div class="tab-content" data-lang="r">
<pre><code><span class="code-comment"># R: RDD Plot</span>
<span class="code-keyword">library</span>(rdrobust)

<span class="code-comment"># rdplot creates binned scatter with polynomial fit</span>
<span class="code-tooltip" data-tip="rdplot() creates publication-ready RDD visualization">rdplot(y = df$outcome,
       x = df$x_centered,
       c = 0,
       title = "RDD: Effect of Scholarship",
       x.label = "Test Score (centered)",
       y.label = "College Enrollment")</span>

<span class="code-comment"># Custom ggplot version</span>
<span class="code-keyword">library</span>(ggplot2)

ggplot(df, aes(x = x_centered, y = outcome)) +
  geom_point(alpha = 0.3) +
  geom_smooth(data = subset(df, x_centered < 0),
              method = "lm", se = TRUE, color = "blue") +
  geom_smooth(data = subset(df, x_centered >= 0),
              method = "lm", se = TRUE, color = "blue") +
  geom_vline(xintercept = 0, linetype = "dashed") +
  labs(x = "Running Variable (centered)", y = "Outcome")</code></pre>
            <button class="run-btn" data-lang="r">Run Code</button>
          </div>
        </div>

        <div class="output-simulation" data-output="rdd-5" data-lang="python">
          <div class="output-header">
            <span>Python Output</span>
            <button class="close-output">&times;</button>
          </div>
          <div class="output-body"><pre>RD Plot with evenly-spaced bins

Cutoff c = 0                         Number of Obs = 2847
Number of bins:  20 (left)  20 (right)
Bin selection:   Evenly spaced
Polynomial order: 4 (fit)  4 (CI)

                Left of c    Right of c
Number of Obs.       1423          1424
Eff. Obs.            1423          1424
Bin Length           2.50          2.50
IMSE-optimal bins      17            19

[Plot displayed: Binned scatter plot showing clear discontinuity at cutoff]

Left side mean (at cutoff):  45.23
Right side mean (at cutoff): 48.08
Visual gap at cutoff: ~2.85 points</pre></div>
        </div>

        <div class="output-simulation" data-output="rdd-5" data-lang="stata">
          <div class="output-header">
            <span>Stata Output</span>
            <button class="close-output">&times;</button>
          </div>
          <div class="output-body"><pre>RD Plot with evenly-spaced bins.

      Cutoff c = 0 | Left of c  Right of c       Number of obs =       2847
-------------------+----------------------       Kernel        =     Uniform
     Number of obs |      1423        1424
 Eff. Number of obs|      1423        1424
     Number of bins|        20          20
      Bin Length   |      2.50        2.50
Poly. Order (fit)  |         4           4
Poly. Order (CI)   |         4           4

[Graph saved as rdd_plot.gph]

Visual inspection shows clear discontinuity:
  - Left limit at cutoff:  45.23
  - Right limit at cutoff: 48.08
  - Estimated jump:         2.85</pre></div>
        </div>

        <div class="output-simulation" data-output="rdd-5" data-lang="r">
          <div class="output-header">
            <span>R Output</span>
            <button class="close-output">&times;</button>
          </div>
          <div class="output-body"><pre>RD Plot

Cutoff c = 0                      Number of Obs = 2847
Number of bins: 20 (left), 20 (right)
Bin selection: Evenly spaced
Polynomial order: 4 (fit), 4 (CI)

                  Left of c    Right of c
Number of Obs.         1423          1424
Eff. Obs.              1423          1424
Bin Length             2.50          2.50
IMSE-optimal bins        17            19

[Plot: Binned scatter with fitted polynomial on each side of cutoff]
Title: "RDD: Effect of Scholarship"
X-axis: Test Score (centered)
Y-axis: College Enrollment

Visual discontinuity estimate:
  Left limit:  0.452 (enrollment rate)
  Right limit: 0.481 (enrollment rate)
  Jump:        0.029 (2.9 percentage points)</pre></div>
        </div>

        <div class="info-box warning">
          <div class="info-box-title">Local Average Treatment Effect</div>
          <p style="margin-bottom: 0;">
            RDD identifies the effect only at the cutoff‚Äîthe Local Average Treatment Effect (LATE). This may not generalize to units far from the cutoff. Be careful about extrapolation.
          </p>
        </div>

        <div class="citation">
          <div class="citation-title">References</div>
          <ul>
            <li><strong>Calonico, S., Cattaneo, M., & Titiunik, R.</strong> (2014). "Robust Nonparametric Confidence Intervals for Regression-Discontinuity Designs." <em>Econometrica</em>.</li>
            <li><strong>Cattaneo, M., Idrobo, N., & Titiunik, R.</strong> (2020). <em>A Practical Introduction to Regression Discontinuity Designs</em>. Cambridge.</li>
            <li><strong>Lee, D. & Lemieux, T.</strong> (2010). "Regression Discontinuity Designs in Economics." <em>JEL</em>.</li>
          </ul>
        </div>

        <div class="nav-footer">
          <a href="06b-did.html" class="nav-link prev">6B: Difference-in-Differences</a>
          <a href="06d-iv.html" class="nav-link next">6D: Instrumental Variables</a>
        </div>
      </div>
    </main>
  </div>

  <button class="mobile-menu-toggle" aria-label="Toggle navigation menu">Menu</button>
  <script src="../js/main.js"></script>
  <script src="../js/password-protection.js"></script>
</body>
</html>
